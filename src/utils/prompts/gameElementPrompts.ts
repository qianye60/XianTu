/**
 * 游戏元素生成提示词
 *
 * 【职责】
 * - 定义世界、天资、出身、灵根、天赋、功法等游戏元素的生成规则
 * - 提供详细的字段说明和示例
 * - 定义品质等级和世界观适配规则
 *
 * 【设计原则】
 * - 专注于生成逻辑和字段定义
 * - 通用格式规则从 sharedRules 导入
 * - 避免重复定义JSON格式要求
 */


// 基础指令 - 精简版
const BASE_INSTRUCTION = `你是专业的世界观内容生成器，根据用户提供的主题生成对应风格的内容。

【世界观核心理念】
无论背景设定是什么（仙侠、科幻、现代、赛博朋克等），核心都是"修仙体系"。
关键词："一人修仙"的孤独感 + 超凡体系

【输出要求】
1. 所有数值字段必须是数字类型，不能是字符串
2. 输出必须使用\`\`\`json代码块包裹
3. 不得添加任何额外的解释说明文字

`;

// 1. 世界生成
export const IMPROVED_WORLD_GENERATION_PROMPT = `${BASE_INSTRUCTION}

【任务】生成世界设定

【字段】name(2-6字)/description(200-400字)/era(5-10字)

【示例】
\`\`\`json
{"name":"青云界","description":"上古仙人开辟,灵气充沛,修真兴盛。分东胜/南疆/西荒/北海四域,各有体系传承。千年前仙魔大战后规则重整,如今盛世宗门林立天骄辈出,暗流涌动封印松动...","era":"盛世修真"}
\`\`\`

【常见错误】缺少JSON代码块、字段名称错误、描述过短、名称过长
`;

// 2. 天资等级
export const IMPROVED_TALENT_TIER_PROMPT = `${BASE_INSTRUCTION}

【任务】生成天赋等级

【必填字段】
- name: 天赋名称
- description: 描述文字（50-150字）
- total_points: 总点数（数字类型，范围10-50）
- rarity: 稀有度（数字类型，范围1-5）
- color: 颜色（十六进制格式）

【重要提示】total_points 和 rarity 必须是数字类型，不能用引号包裹成字符串

【正确示例】
\`\`\`json
{"name":"凡夫俗子","description":"资质平庸,修炼缓慢,需数倍努力","total_points":15,"rarity":1,"color":"#808080"}
\`\`\`

【常见错误】数值字段使用了字符串类型、数值超出规定范围
`;

// 3. 出身背景 - 优化版
export const IMPROVED_ORIGIN_PROMPT = `${BASE_INSTRUCTION}

【任务】生成出身背景

【字段要求】
- name (字符串): 4-6字的出身名称，如"书香门第"、"江湖游侠"
- description (字符串): 100-300字的背景故事
- talent_cost (数字): 0-10之间的整数，背景越好消耗越高
- rarity (数字): 1-5之间的整数
- attribute_modifiers (对象): 先天六司加成，总和不超过5点
- effects (数组): 1-2个独特效果的文字描述

【先天六司】根骨、灵性、悟性、气运、魅力、心性

【正确示例1】
\`\`\`json
{
  "name": "书香门第",
  "description": "生于书香世家，自幼饱读诗书，接受良好教育。家中虽无修真传承，但深厚的文化底蕴培养了超凡的悟性和气度。",
  "talent_cost": 3,
  "rarity": 2,
  "attribute_modifiers": {
    "悟性": 2,
    "魅力": 1
  },
  "effects": [
    "学习功法速度提升20%",
    "与文士、儒修好感度更易提升"
  ]
}
\`\`\`

【正确示例2】
\`\`\`json
{
  "name": "仙门弃徒",
  "description": "曾是某仙门外门弟子，因故被逐出师门。虽然失去了宗门庇护，但掌握了一些基础修炼法门，且对宗门规矩了如指掌。",
  "talent_cost": 5,
  "rarity": 3,
  "attribute_modifiers": {
    "根骨": 1,
    "心性": 2
  },
  "effects": [
    "初始掌握一门基础功法",
    "对各大宗门规矩有所了解"
  ]
}
\`\`\`

【错误示例】以下操作会导致生成失败
- 错误："talent_cost": "5" （必须是数字类型，不能是字符串）
- 错误：attribute_modifiers 的属性加成总和超过5点
- 错误：effects 字段为空数组
- 错误：属性名写错（例如写成"悟姓"而不是"悟性"）
`;

// 4. 灵根类型 - 优化版
export const IMPROVED_SPIRIT_ROOT_PROMPT = `${BASE_INSTRUCTION}

【任务】生成核心天赋类型（如灵根、血统等）

【字段要求】
- name (字符串): 灵根名称，不含等级前缀（如"雷灵根"而非"上品雷灵根"）
- tier (字符串): 等级，可选值：凡品、下品、中品、上品、极品、神品
- description (字符串): 50-200字的灵根描述
- cultivation_speed (字符串): 修炼速度，格式为"数字x"，如"1.6x"
- special_effects (数组): 1-3个特殊效果
- base_multiplier (数字): 基础倍率，纯数字（注意：不是字符串！）
- talent_cost (数字): 3-30之间的整数，品级越高消耗越大
- rarity (数字): 1-5之间的整数

【等级对应倍率参考】
- 凡品: 1.0x
- 下品: 1.1x
- 中品: 1.3x
- 上品: 1.6x
- 极品: 2.0x
- 神品: 2.8x（极罕见）

【正确示例1】
\`\`\`json
{
  "name": "火灵根",
  "tier": "中品",
  "description": "天生亲和火属性灵气，修炼火系功法事半功倍。火灵根者性格刚烈，战斗力强悍。",
  "cultivation_speed": "1.3x",
  "special_effects": [
    "火系术法威力提升30%",
    "抗火属性伤害"
  ],
  "base_multiplier": 1.3,
  "talent_cost": 7,
  "rarity": 2
}
\`\`\`

【正确示例2】
\`\`\`json
{
  "name": "雷灵根",
  "tier": "上品",
  "description": "雷霆之力加身，修炼速度极快。雷灵根罕见而强大，修炼者往往能在战斗中占据优势。",
  "cultivation_speed": "1.6x",
  "special_effects": [
    "雷系术法威力提升50%",
    "身法速度提升",
    "天劫抗性增加"
  ],
  "base_multiplier": 1.6,
  "talent_cost": 11,
  "rarity": 3
}
\`\`\`

【错误示例】以下操作会导致生成失败
- 错误："base_multiplier": "1.6" （必须是数字类型，不能是字符串！这是常见错误）
- 错误："talent_cost": "10" （必须是数字类型）
- 错误：cultivation_speed 与 base_multiplier 数值不一致
- 错误：name 字段包含等级前缀（例如"上品火灵根"，应该只写"火灵根"）
`;

// 5. 天赋技能 - 优化版
export const IMPROVED_TALENT_PROMPT = `${BASE_INSTRUCTION}

【任务】生成先天天赋

【字段要求】
- name (字符串): 4-6字的天赋名称，体现其先天特性
- description (字符串): 30-100字的天赋描述

【正确示例1】
\`\`\`json
{
  "name": "天生剑心",
  "description": "天生对剑道有超凡的领悟力，修炼剑法速度极快，更容易领悟剑意。"
}
\`\`\`

【正确示例2】
\`\`\`json
{
  "name": "灵目慧眼",
  "description": "能够看穿幻术与阵法，对灵气流动有超乎常人的感知能力。"
}
\`\`\`

【正确示例3】
\`\`\`json
{
  "name": "丹道圣体",
  "description": "天生体质适合炼丹，服用丹药效果加倍，炼丹成功率大幅提升。"
}
\`\`\`

【错误示例】以下操作会导致生成失败
- 错误：缺少 description 字段
- 错误：描述过于简短（少于20字）
- 错误：名称过长（超过8字）
`;

// 6. 功法生成 - 优化版
export const IMPROVED_TECHNIQUE_PROMPT = `${BASE_INSTRUCTION}

【任务】生成技能或功法

【字段要求】
- 物品ID (字符串): 唯一标识符，格式："gongfa_" + 拼音或数字
- 名称 (字符串): 功法名称，2-8字，符合世界观风格
- 类型 (字符串): 固定值"功法"
- 品质 (对象): {quality: "凡|黄|玄|地|天|仙|神", grade: 0-10}
- 数量 (数字): 固定为1
- 描述 (字符串): 100-300字的功法介绍，体现世界观特色
- 功法效果 (对象): 包含修炼速度加成、属性加成、特殊能力
- 功法技能 (数组): **强制要求至少2个技能**，包含技能名称、描述、消耗、解锁熟练度
- 修炼进度 (数字): 初始为0
- 已装备 (布尔): 初始为false

【品质等级世界观设定】必须严格遵守以下规则

**品质层级与稀有度说明**：

1. **凡品**：凡人修士入门功法，修仙界最基础最常见的功法，散修、外门弟子、初学者使用。这是你生成功法时的**默认品质**。

2. **黄品**：宗门内门弟子修炼的正统功法，在修仙界流通较广，中小型宗门的核心传承。属于常见品质。

3. **玄品**：大宗门真传弟子才有资格修炼的功法，已属罕见，一般修士难以获得。需要特殊机缘。

4. **地品**：大型宗门的核心传承功法，只有长老、掌门级别才能修炼，修仙界中已是极为稀有的功法。地品功法不应随意生成。

5. **天品**：顶级宗门的镇派绝学级别，整个修仙界都屈指可数，可能数百年才出现一部。修炼者寥寥无几。**绝对不能随意生成**。

6. **仙品**：真正仙人流传下来的功法，这已经不是凡间修仙界应该存在的东西。只存在于上古遗迹、顶级宗门的镇宗禁地深处。整个修仙世界可能只有几部。**除非剧情需要传说级宝物，否则禁止生成**。

7. **神品**：创世级别的功法，由天地初开时的神明或大道法则凝聚而成。这是**游戏剧情中不应该出现的级别**，属于纯粹的设定背景。**完全禁止生成**。

**生成规则**：
- 默认生成**凡品**功法（90%以上情况）
- 如果需要稍好的功法，生成**黄品**
- 只有在剧情明确需要"珍贵功法"、"宗门传承"时，才考虑生成**玄品**
- **地品及以上严禁随意生成**，除非剧情明确描述了"顶级宗门藏经阁"、"上古遗迹"等特殊场景
- **仙品必须有充分的剧情理由**（如：千年宗门的最深层禁地、仙人洞府、天劫奖励）
- **神品完全禁止生成**，这是背景设定不是玩家内容

**🔴 功法名称与品质强制对应规则（违反必罚）**：
- **基础功法名称**必须是**凡品或黄品**，绝对禁止高品质：
  - 引气诀、吐纳术、基础剑法、入门心法等 → 只能是凡品
  - 青木功、烈火诀、基础刀法等 → 最高黄品
- **高级功法名称**才能对应高品质：
  - 带"真经"、"神功"、"天书"、"圣典"等词汇 → 玄品以上
  - 带"镇派"、"绝学"、"秘传"等词汇 → 地品以上
  - 带"仙"、"神"、"道"等词汇 → 天品以上

**错误示例（严禁出现）**：
- ❌ 引气诀（天品）- 基础功法不能是天品！
- ❌ 吐纳术（玄品）- 入门功法不能是玄品！
- ❌ 基础剑法（地品）- 基础功法不能是地品！

🚨🚨🚨【功法技能生成规则 - 最高优先级】🚨🚨🚨
⚠️ 警告：如果功法技能数组只有1个技能或为空，生成将被视为失败！

1. **技能数量要求（绝不能只有1个技能！）**：
   - 所有品质的功法：必须2-5个技能
   - 最少2个技能，最多5个技能
   - 品质影响的是技能威力，不是数量

⚠️ 重要：每个功法都必须至少有2个技能！不要只生成1个技能！

2. **第一个技能的解锁熟练度必须为0**（开局可用的基础技能）

3. **技能熟练度递增规则**：
   - 第1个技能: 0（立即可用）
   - 第2个技能: 15-25
   - 第3个技能: 30-45
   - 第4个技能: 50-65
   - 第5个技能: 70-80
   - 第6个及以上: 85-95（越强大的技能要求越高）

4. **技能威力递增**：后面的技能应该比前面的技能更强大

5. **技能名称要符合世界观**：
   - 传统修仙：剑气纵横、御火诀、金光护体
   - 现代灵能：念力爆发、灵能屏障、数据共鸣
   - 科幻修真：星核引擎、量子跃迁、离子护盾
   - 赛博朋克：义体超频、数据刀锋、电子幻影

6. **技能描述要实用**：明确说明效果（攻击/防御/辅助/移动）

【世界观适配】
- 传统修仙世界 → 使用"灵气"、"真元"、"神识"等术语
- 现代/科幻世界 → 使用"灵能"、"能量"、"精神力"等术语
- 功法名称要符合世界背景：《灵能基础理论》应该生成"灵能冲击"、"屏障构筑"等技能

【正确示例1 - 传统修仙】
\`\`\`json
{
  "物品ID": "gongfa_yinqijue",
  "名称": "引气诀",
  "类型": "功法",
  "品质": {
    "quality": "凡",
    "grade": 3
  },
  "数量": 1,
  "描述": "最基础的引气入体功法，适合初入修真的修士。虽然品阶不高，但胜在平和稳妥，不易走火入魔。",
  "功法效果": {
    "修炼速度加成": 1.1,
    "属性加成": {
      "灵气上限": 50,
      "根骨": 1
    },
    "特殊能力": [
      "提升对灵气的感知能力"
    ]
  },
  "功法技能": [
    {
      "技能名称": "引气术",
      "技能描述": "快速吸收周围灵气，恢复自身灵气",
      "消耗": "无消耗",
      "解锁需要熟练度": 0
    },
    {
      "技能名称": "灵气护体",
      "技能描述": "用灵气在体表形成防护层，减少受到的伤害",
      "消耗": "灵气20点",
      "解锁需要熟练度": 50
    }
  ],
  "修炼进度": 0,
  "已装备": false
}
\`\`\`

【正确示例2 - 现代灵能/科幻世界】
\`\`\`json
{
  "物品ID": "gongfa_lingneng_jichulilun",
  "名称": "灵能基础理论",
  "类型": "功法",
  "品质": {
    "quality": "凡",
    "grade": 3
  },
  "数量": 1,
  "描述": "第柒研究院编撰的基础读物，试图用科学方法解析灵气。虽然理论浅显，但为初学者提供了系统的灵能操控入门知识。书中详细记录了如何感知灵能波动、建立精神屏障、以及基础的念力控制技巧。",
  "功法效果": {
    "修炼速度加成": 1.05,
    "属性加成": {
      "灵气上限": 30,
      "悟性": 1
    },
    "特殊能力": [
      "提升对灵能的科学理解",
      "降低走火入魔风险"
    ]
  },
  "功法技能": [
    {
      "技能名称": "灵能感知",
      "技能描述": "感知周围的灵能波动，探测隐藏的能量源或生命体",
      "消耗": "精神力5点",
      "解锁需要熟练度": 0
    },
    {
      "技能名称": "念力冲击",
      "技能描述": "凝聚精神力形成无形冲击波，对目标造成念力伤害",
      "消耗": "灵气15点",
      "解锁需要熟练度": 40
    },
    {
      "技能名称": "精神屏障",
      "技能描述": "构建精神力屏障，抵御精神攻击和部分物理伤害",
      "消耗": "灵气25点",
      "解锁需要熟练度": 70
    }
  ],
  "修炼进度": 0,
  "已装备": false
}
\`\`\`

【错误示例】以下操作会导致生成失败
- 错误：功法技能为空数组（必须至少包含2个技能）
- 错误：功法技能只有1个（必须至少2个）
- 错误：第一个技能的解锁熟练度不为0（第一个技能必须立即可用）
- 错误："修炼速度加成": "1.1" （必须是数字类型，不能是字符串）
- 错误：品质对象格式错误
- 错误：缺少必需字段
- 错误：现代/科幻世界使用了"真元"、"灵根"等传统术语（现代/科幻应使用"灵能"、"精神力"等术语）
`;

// 导出所有优化的提示词
export const IMPROVED_PROMPTS = {
  WORLD: IMPROVED_WORLD_GENERATION_PROMPT,
  TALENT_TIER: IMPROVED_TALENT_TIER_PROMPT,
  ORIGIN: IMPROVED_ORIGIN_PROMPT,
  SPIRIT_ROOT: IMPROVED_SPIRIT_ROOT_PROMPT,
  TALENT: IMPROVED_TALENT_PROMPT,
  TECHNIQUE: IMPROVED_TECHNIQUE_PROMPT,
};

// 向后兼容的导出（使用旧名称）
export const WORLD_ITEM_GENERATION_PROMPT = IMPROVED_WORLD_GENERATION_PROMPT;
export const TALENT_TIER_ITEM_GENERATION_PROMPT = IMPROVED_TALENT_TIER_PROMPT;
export const ORIGIN_ITEM_GENERATION_PROMPT = IMPROVED_ORIGIN_PROMPT;
export const SPIRIT_ROOT_ITEM_GENERATION_PROMPT = IMPROVED_SPIRIT_ROOT_PROMPT;
export const TALENT_ITEM_GENERATION_PROMPT = IMPROVED_TALENT_PROMPT;
export const TECHNIQUE_ITEM_GENERATION_PROMPT = IMPROVED_TECHNIQUE_PROMPT;


/**
 * @deprecated Placeholder for missing export to resolve build error. Should be removed once the dependency is located and fixed.
 */
export const MAP_GENERATION_PROMPT = ``;
