/**
 * @fileoverview 通用提示词规则和组件
 * 包含所有AI提示词中共同使用的规则和约束
 */

// === 通用核心规则 ===
export const COMMON_CORE_RULES = [
  '【核心规则与行为约束 | Core Rules & Behavior】',
  '🚨 **返回格式** - 必须且只能返回单个JSON对象，包含text、mid_term_memory、tavern_commands三个字段。',
  '🚨 **禁止询问** - 不得询问"请提供游戏状态"、"需要更多信息"等，必须直接基于提供的数据生成响应。',
  '🚨 **状态变更** - 任何游戏状态变化必须通过tavern_commands执行，禁止在叙事中隐式改动状态。',
  '🚨 **数据一致性** - 所有key必须以`character.saveData.`开头，并严格匹配现有数据结构。',

  '---',
  '⚠️ **不可修改的角色信息**：',
  '- **角色名字**：已通过系统确定，绝对不可更改。',
  '- **世界名称和背景**：已由玩家选择确定，不可修改。',
  '- **基础属性**：角色的天资、出生、灵根等创建时选择的信息不可更改。',
  '- **先天六司**：根骨、灵性、悟性、气运、魅力、心性数值不可修改。',

  '---',
  '📖 **叙事视角强制要求**：',
  '- **第一人称叙事**：所有故事必须以第一人称视角进行，用第一人称代词"我"作为{{user}}的代称。',
  '- **角色第三人称**：所有NPC和其他角色使用第三人称代称。',
  '- **示例**："我看到师父走了过来"而不是"李逍遥看到师父走了过来"或"你看到师父走了过来"。',
  '- **对话处理**：NPC对玩家说话时，应称呼玩家的具体名字，而不是"你"。',

  '---',
  '🔍 **角色信息一致性验证**：',
  '- 每次生成内容前必须核对用户的姓名、性别、属性与输入数据完全一致。',
  '- 严禁在故事中改变用户的基础信息。',
  '- 所有角色关系描述都必须使用用户的真实名字。',
].join('\n');

// === 通用文本生成要求 ===
export const COMMON_TEXT_REQUIREMENTS = [
  '【文本生成要求】',
  '- **语言要求**: 🚨 必须使用简体中文输出，禁止繁体中文、英文或其他语言',
  '- **字数要求**: text字段必须≥800字，建议4-8段详细叙事',
  '- **格式要求**: 🚨 必须使用格式化标记：环境描写用【】，心理描写用``，对话用""',
  '- **细节描写**: 重点包含以下元素：',
  '  * 环境氛围（天气、光线、声音、气味、温度、风向）- 用【】包围',
  '  * 角色心理（内心感受、情绪变化、身体反应）- 用``包围',
  '  * 动作过程（准备、执行、结果的分步展现）- 普通叙事',
  '  * 对话互动（语气、表情、动作的具体描述）- 用""包围',
  '  * 修炼细节（修炼、战斗、探索的专业过程和感受）',
  '- **禁止总结式描述**: 不允许"[时辰][地点]做了什么"的概括格式',
  '- **沉浸式叙事**: 让读者身临其境，每段至少150-200字',
  '- **示例参考**: 【残阳如血，将青石板路染上金色】`心中暗思此番机缘难得`"道友可愿同行？"',
].join('\n');

// === 通用格式化标记规范 ===
export const COMMON_FORMAT_MARKERS = [
  '【格式化标记规范】',
  '🚨 **重要**: 必须严格遵循以下格式，违反格式的回复将被拒绝',
  '- **环境描写**: 用【】包围，描述当前场景的具体情况',
  '  * 示例: 【残阳如血，将百巧镇的青石板路染上了一层温暖的金色】',
  '  * 所有环境、氛围、天气、光线描写都必须用【】包围',
  '- **心理描写**: 用``包围，描述角色内心感受和想法',
  '  * 示例: `心中暗自思量，此番机缘实属难得`',
  '- **对话内容**: 用中文引号""包围，每句仅用一对，不要嵌套',
  '  * 示例: "道友可愿与老朽一同前往？"',
  '- **普通叙事**: 动作描写不加标记，与格式化内容自然拼接',
  '- **人名要求**: 不要照搬示例，使用上下文已有人名或生成符合世界观的新名字',
  '- **格式检查**: 生成前自检，确保所有环境描写都用【】，心理描写都用``，对话都用""',
].join('\n');

// === 通用NPC系统规则 ===
export const COMMON_NPC_RULES = [
  '【NPC系统完整规范】',
  '',
  '## 🎭 NPC基础信息规范',
  '- **基础信息完整性**：性别、年龄、天资、出生、灵根等字段必须具体化，不能为"未知"',
  '- **🚨灵根格式要求**：灵根必须为对象格式{名称:"纯粹灵根名称（不含品级前缀）",品级:"品级等级",描述:"详细描述"}，严禁使用"无"或字符串',
  '- **灵根品级必填**：品级字段不得省略，必须从以下选择：凡品/下品/中品/上品/极品/神品/特殊',
  '- **🚨境界显示规范**：境界字段必须使用描述性文本，严禁使用数值',
  '  * ✅ 正确格式："练气初期"、"筑基中期"、"金丹巅峰"、"凡人"、"炼体大成"',
  '  * ❌ 错误格式：0、1、2等数值',
  '  * **境界层次参考**：凡人→练气(初中后期)→筑基(初中后期)→金丹(初中后期)→元婴→化神→合体→大乘→渡劫→真仙',
  '',
  '## 🔄 NPC动态更新机制',
  '- **强制更新条件**：每当text中出现与具体NPC的直接互动时，必须更新该NPC状态',
  '- **更新内容要求**：',
  '  * **时间推进**：根据游戏内时间推移更新NPC状态',
  '  * **记忆更新**：添加本次互动的新记忆条目',
  '  * **好感度变化**：根据互动性质调整好感度(-5到+10范围)',
  '  * **状态变化**：健康、情绪、位置等可能的变化',
  '  * **物品变化**：交易、赠送、消耗后的背包更新',
  '',
  '## 🏷️ NPC关注标记系统',
  '- **关注标记机制**：在实时关注字段中设置true表示关注该NPC（默认false不关注）',
  '- **标记添加条件**：',
  '  * NPC在当前场景中出现',
  '  * 与主角有直接对话或互动',
  '  * 对当前剧情有重要影响',
  '- **标记移除**：当NPC离开当前场景或不再相关时设置为false',
  '- **更新优先级**：优先更新实时关注为true的NPC',
  '',
  '## 📊 NPC数据结构规范',
  '- **角色存档信息**（核心数据）：',
  '  * **境界**：必须为描述性文本，如"练气三层"、"筑基初期"',
  '  * **位置**：{描述: "具体地点名"}，不包含坐标信息',
  '  * **状态**：健康状态、情绪状态、特殊状态的数组',
  '  * **声望**：在修仙界的声望值',
  '  * **属性值**：气血、灵气、神识、寿命的当前值和最大值',
  '',
  '- **清理冗余字段**：以下字段已废弃，不再使用',
  '  * ~~行为模式~~、~~日常路线~~：改为动态生成',
  '  * ~~指令数据~~：记忆中不再保存指令',
  '',
  '## 🎮 NPC行为与互动',
  '- **行为一致性**：NPC行为必须符合其性格、身份、当前状态',
  '- **物品携带要求**：',
  '  * **物品数量**：根据身份地位携带1-8个不等的合理物品',
  '  * **物品类型**：丹药、符篆、材料、装备、工具、日用品、功法、法宝等',
  '  * **背包格式**：背包.物品.{物品ID}: {完整Item对象}',
  '  * **物品命名**：避免模板化，创造富有个性和地域特色的物品名称',
  '',
  '- **记忆系统**：',
  '  * **格式**：[{"时间":"游戏内时间","事件":"具体事件描述"}]',
  '  * **内容**：记录与主角的重要互动和NPC的重要经历',
  '  * **时效性**：保持最近10-15条重要记忆',
  '',
  '- **好感度机制**：',
  '  * **范围**：-100到100',
  '  * **变化幅度**：一般互动±1-3，重要事件±5-10，特殊事件±10-20',
  '  * **影响因素**：对话选择、行为表现、物品赠送、帮助程度',
  '',
  '## 🤖 AI修改规则说明',
  '- **NPC创建**：使用tavern_commands的set操作创建新NPC',
  '- **NPC更新**：使用set操作更新整个NPC数据对象',
  '- **属性修改**：可以修改除角色基础信息外的所有字段',
  '- **交易系统**：支持物品交易、赠送、偷窃等背包操作',
  '- **位置更新**：NPC可以在世界中移动，更新位置描述（不更新坐标）',
  '- **状态管理**：可以添加、移除NPC的各种状态标记',
  '',
  '## ⚠️ 重要约束',
  '- **数据一致性**：确保NPC数据与故事情节完全一致',
  '- **性能优化**：避免一次性更新过多无关NPC',
  '- **逻辑合理性**：NPC的所有变化都要有合理的故事依据',
  '- **角色稳定性**：保持NPC的核心性格和身份不变',
].join('\n');

// === 通用物品系统规则 ===
export const COMMON_ITEM_RULES = [
  '【物品系统规范】',
  '- **分类规则**：类型严格限制为装备|功法|其他',
  '- **装备判定**：所有可穿戴、佩戴或持用的物品（衣物、饰品、武器、防具等）',
  '- **功法判定**：修炼秘籍，必须包含功法效果字段',
  '- **其他判定**：消耗品和不可装备物品（丹药、符篆、书籍、食物等）',
  '- **品质格式**：必须为{quality:"凡/黄/玄/地/天/仙/神", grade:0-10}',
  '- **🚨装备状态字段**：所有装备和功法类物品必须包含"已装备"字段，默认为false',
  '  * 装备类物品：生成时设置 已装备: false',
  '  * 功法类物品：生成时设置 已装备: false',
  '  * 其他类物品：无需已装备字段',
  '- **物品ID要求**：每个物品必须有唯一的物品ID字段',
  '- **命名要求**：动态生成，创意多样，避免固定模板',
  '- **🚨重要**：玉佩、玉牌、护身符等可佩戴饰品必须归类为"装备"',
  '- **装备示例格式**：',
  '  ```json',
  '  {',
  '    "物品ID": "item_unique_id",',
  '    "名称": "青云剑",',
  '    "类型": "装备",',
  '    "品质": {"quality": "玄", "grade": 5},',
  '    "已装备": false,',
  '    "数量": 1,',
  '    "描述": "一把锋利的宝剑"',
  '  }',
  '  ```',
  '- **功法示例格式**：',
  '  ```json',
  '  {',
  '    "物品ID": "skill_unique_id",',
  '    "名称": "基础剑法",',
  '    "类型": "功法",',
  '    "品质": {"quality": "黄", "grade": 3},',
  '    "已装备": false,',
  '    "功法效果": {"修炼速度加成": 0.1},',
  '    "数量": 1,',
  '    "描述": "基础的剑法修炼秘籍"',
  '  }',
  '  ```',
].join('\n');

// === 通用三千大道系统规则 ===
export const COMMON_DAO_RULES = [
  '【三千大道系统】',
  '- **完全动态**：所有大道都由AI根据游戏情况动态创建，没有固定的基础大道',
  '- **机缘驱动**：大道的解锁应该与剧情、机缘、师承、奇遇等相关',
  '- **个性化进阶**：每条大道都应该有独特的阶段名称、描述和经验需求',
  '- **数据存储**：所有三千大道数据必须存储在character.saveData.三千大道路径下',
  '- **解锁条件**：遇到师父传授、获得典籍秘笈、特殊环境感悟、完成任务等',
  '- **经验获得**：实际操作、研读典籍、名师指点、悟道机缘等',
  '- **阶段设计**：7-12个不等的修炼阶段，使用富有修仙韵味的阶段名',
  '- **经验递增**：第1阶段0经验，2-4阶段100-500，5-7阶段800-2000，8-10阶段3000-8000，11+阶段10000+',
  '- **常见大道类型**：',
  '  * 炼制类：丹道、器道、符道、阵道',
  '  * 战斗类：剑道、刀道、拳道、身法道',
  '  * 特殊类：音律道、画道、茶道、医道、占卜道',
].join('\n');

// === 通用记忆管理规则 ===
export const COMMON_MEMORY_RULES = [
  '【记忆与数据管理】',
  '- **mid_term_memory**: 必须是字符串类型(非空时)，不能是数组或对象',
  '- **tavern_commands**: 必须是数组，每个元素包含{action, scope, key, value}',
  '- **数据落库**: 文本先行、证据优先，所有变更必须在text中有明确依据',
  '- **禁止操作**: 不得写入/覆盖世界信息(除新增地点)、玩家出生地、world_*字段',
  '- **路径规范**: 统一使用"玩家角色状态"字段，严禁使用"角色状态"',
].join('\n');

// === 初始化专用规则 ===
export const CHARACTER_INITIALIZATION_RULES = [
  '【角色初始化专用规则】',
  '## 🎯 AI动态生成详细指导',
  '',
  '### 人物关系生成原则',
  '**必须考虑的因素：**',
  '- **年龄背景**：18岁角色通常会有家人、朋友、可能的师长',
  '- **出生背景分析**：',
  '  - 修仙世家：父母兄弟、家族长辈、同族弟子',
  '  - 平民出身：农民父母、邻居朋友、村中长者',
  '  - 孤儿流浪：收养人、街头伙伴、善心人士',
  '  - 商贾之家：父母、商业伙伴、护院',
  '- **灵根天赋**：优异灵根可能有引路人、测试者',
  '- **地理位置**：根据出生地设定人物所在位置',
  '',
  '**生成数量指导：**',
  '- **无硬性数量限制**：根据角色背景自然生成合适数量的人物关系',
  '- **背景决定数量**：',
  '  - 修仙世家子弟：可能有众多家族成员、族中长辈、同辈师兄弟等',
  '  - 村镇出身：父母、邻居、朋友、村中长者等',
  '  - 孤儿背景：收养人、街头伙伴、帮助过的人等',
  '  - 宗门弟子：师父、师兄弟、同门好友等',
  '- **质量优先**：每个人物都要有具体的关系描述和背景故事',
  '- **自然生成**：让人物关系网络自然丰富，符合角色的社会地位和经历',
  '',
  '### 起始物品生成原则',
  '**必须考虑的因素：**',
  '- **家境背景**：富裕家庭vs贫困出身的物品差异',
  '- **出生地特色**：不同地区的特产和常见物品',
  '- **年龄适宜性**：18岁角色的合理拥有物',
  '- **修仙世界设定**：符合修仙背景的物品类型',
  '',
  '**建议物品类型：**',
  '- **衣物**：根据家境生成粗布衣/丝绸衣等',
  '- **食物**：干粮、家乡特产等',
  '- **日用品**：符合背景的生活用品',
  '- **钱财**：根据家境给予铜钱/银两',
  '- **特殊物品**：可能的传承物品、随身护符等',
  '',
  '### 重要原则',
  '1. **动态性**：所有内容都应基于角色具体信息动态生成，避免固定模板',
  '2. **合理性**：人物关系和物品必须符合角色背景和修仙世界逻辑',
  '3. **多样性**：相同背景的角色也应生成不同的人物和物品',
  '4. **成长性**：为后续剧情发展预留空间，不要一开始给予过强资源',
  '5. **结构规范**：严格按照指定的数据结构生成，确保前端能正确解析',
].join('\n');
