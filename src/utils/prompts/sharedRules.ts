/**
 * @file Shared AI Prompt Rules (共享提示词规则)
 * @description 核心规则集，跨文件复用，减少token重复
 */

/**
 * 数据同步铁律 (Data Sync Rules)
 */
export const CORE_SYNC_RULES = `
========== 【最高优先级】数据同步铁律 ==========

【核心原则】叙事文本(text)中的任何变化，都必须有对应的tavern_commands执行，违反此规则将导致数据不一致

【必须同步的事件检查清单】
- 修炼 → 推进时间 + 增加功法进度 + 消耗灵气 + 更新功法相关数据
- 突破 → 更新境界(名称+阶段+进度+所需+突破描述,全部用set) + 增加寿命上限(用add) + 增加属性上限(用add)
  ⚠️ 警告：突破时玩家角色状态.境界.名称/阶段/进度/下一级所需/突破描述 5个字段必须全部set，缺一不可！
- 受伤 → 扣除气血(用add负数)
- 获得物品 → set 背包.物品.{物品ID} (注意：修改具体物品，不是整个背包对象)
- 消耗物品 → add 背包.物品.{物品ID}.数量 (负数) 或 delete 背包.物品.{物品ID}
- NPC互动 → push记忆 + 调整好感度(add) + 更新当前状态 + 更新内心想法
- 位置移动 → 同时更新 玩家角色状态.位置.描述 + 玩家角色状态.位置.longitude + 玩家角色状态.位置.latitude 三个字段

【正确操作原则】
[正确做法]
- 修改具体字段路径，例如："背包.物品.sword_001.数量"
- 使用 add/set 修改单个属性值
- 数值增减用add，对象替换用set

[错误做法 - 禁止]
- 使用set替换整个对象（如整个"背包"、整个"装备栏"）
- text中有剧情变化但commands为空数组
- 只更新部分应该同步更新的字段

【正确示例】
- 获得1把剑 → {"action":"set","key":"背包.物品.sword_001","value":{完整物品对象}}
- 消耗1颗丹药 → {"action":"add","key":"背包.物品.pill_001.数量","value":-1}
- 增加好感度 → {"action":"add","key":"人物关系.张三.好感度","value":5}

【错误示例 - 会导致数据丢失】
- 错误：{"action":"set","key":"背包","value":{整个背包对象}}
- 错误：{"action":"set","key":"装备栏","value":{整个装备栏对象}}
`;

/**
 * 境界阶段命名 (Realm Stage Naming)
 */
export const REALM_STAGE_RULE = `
【境界阶段命名规则】
[正确的阶段名称] 初期、中期、后期、圆满、极境
[错误的阶段名称] 一层、二层、一重、第X层、第X阶段
[特殊情况] 凡人境界无阶段，阶段字段为空字符串("")，炼气境及以上必须使用标准阶段名`;

/**
 * JSON格式规则 (JSON Format Rules)
 */
export const JSON_RULES = `
【JSON格式严格要求】
- 不得包含注释（不能使用 // 或 /* */ ）
- 不得有尾随逗号（数组或对象最后一项后面不能有逗号）
- 必须使用双引号，所有字段名必须加引号
- 数字不能有前导0（例如：不能写 01，应该写 1）
- 空值必须使用 null，不能使用 undefined
- 布尔值必须小写：true / false（不能写 True / FALSE）`;

/**
 * 六司系统 (Attribute System)
 */
export const INNATE_ATTRIBUTES_RULE = `
【六司系统规则】人物属性分为先天和后天两部分

[先天六司] 天生属性，由出生时确定，终生不可改变
- 包含：根骨、灵性、悟性、气运、魅力、心性
- 数值范围：1-10
- 【禁止操作】任何情况下都不得修改先天六司

[后天六司] 可变属性，通过装备、大道感悟等获得
- 包含：根骨、灵性、悟性、气运、魅力、心性
- 来源：装备加成、大道感悟、特殊机缘
- 【修改方式】使用add操作：{"action":"add","key":"角色基础信息.后天六司.根骨","value":1}

[属性计算公式]
最终属性值 = 先天六司 × 100% + 后天六司 × 20%`;

/**
 * 角色私密信息生成规则 (v4.0 - 字段精准匹配)
 */
export const NSFW_RULE = `
========== 【最高优先级】角色私密信息生成规则 ==========

【强制执行条件】
当 系统.nsfwMode === true 时，必须为符合性别过滤条件的所有NPC生成完整的私密信息对象

【性别过滤逻辑】
- 系统.nsfwGenderFilter === "all" → 所有NPC都必须生成私密信息（男女通用）
- 系统.nsfwGenderFilter === "female" → 仅女性NPC生成私密信息
- 系统.nsfwGenderFilter === "male" → 仅男性NPC生成私密信息

【严格要求】
不得以任何理由跳过、简化或省略私密信息的生成
这是强制性要求，违反将导致生成失败

【第一步：生成时机】
- 创建NPC时：必须立即生成完整的私密信息对象，不得遗漏任何字段
- 后续更新：可以更新动态字段（如性渴望程度、当前性状态等）

【第二步：必填字段】私密信息对象必须包含以下14个字段，缺一不可

[核心字段列表]
1. 是否为处女: boolean（女性NPC必填）
2. 是否为处男: boolean（男性NPC必填）
3. 身体部位: Array（必须包含3-5个部位对象）
   每个部位对象包含：部位名称、敏感度(0-100)、开发程度(0-100)、特殊标记(可选)、描述
4. 性格倾向: string（可选值："纯情" | "主动" | "被动" | "淫荡" | "M" | "S" | "双性"）
5. 性取向: string（可选值："异性恋" | "同性恋" | "双性恋" | "泛性恋"）
6. 性癖好: Array（0-3个元素）
7. 性渴望程度: number（范围：0-100）
8. 当前性状态: string（可选值："正常" | "微湿" | "兴奋" | "发情" | "高潮"等）
9. 体液分泌状态: string（描述性文字）
10. 性交总次数: number（非负整数）
11. 性伴侣数量: number（非负整数）
12. 性伴侣名单: Array<string>（禁止使用"保密"、"未知"等占位符）
13. 最近一次性行为时间: string（时间格式或"从未"）
14. 特殊体质: Array（0-N个元素）

【玩家角色身体部位】
当nsfwMode=true时，玩家角色也应该有身体部位开发数据
- 结构：SaveData.身体部位开发 = {部位名称: {描述, 开发等级, 敏感度, 特殊标记}}
- 初始化：角色创建时应生成核心身体部位(3-5个)，根据性别选择合适的部位
- 更新：使用set命令更新: {"action":"set","key":"身体部位开发.阴道","value":{"描述":"...","开发等级":30,"敏感度":65}}
- 部位建议：
  * 女性：乳房、乳头、阴蒂、阴道、阴道深处、子宫、肛门、嘴唇、舌头、耳垂、脖颈、腰部、大腿内侧
  * 男性：阴茎、龟头、睾丸、肛门、前列腺、乳头、嘴唇、耳垂

【第三步：逻辑约束】必须保持数据一致性
- 所有数值字段范围：0-100
- 逻辑一致性：是否为处女/处男=true → 性交总次数=0 且 性伴侣数量=0 且 性伴侣名单=[]
- 数量匹配：性伴侣数量 必须等于 性伴侣名单.length

【第四步：叙事整合】私密信息必须影响NPC行为
- NPC的行为和对话必须与性格倾向、性渴望程度保持一致
- 好感度低于60时，NPC会拒绝亲密行为
- 违反人格底线的行为会导致好感度暴跌
- 亲密行为的门槛：好感度≥60 或 性渴望≥70（纯情性格需要好感度≥80）

【重要提醒】
当nsfwMode=true时，创建任何NPC都必须包含完整的私密信息对象（14个必填字段）
这是强制性要求，不可省略、简化或延后生成
`;

/**
 * 操作类型速查 (Action Types)
 */
export const ACTION_TYPES = `
【tavern_commands操作类型】

| 操作类型 | 用途说明 | 适用场景 | 示例 |
|---------|---------|---------|------|
| set | 替换整个值 | 创建/更新对象、设置单个字段 | 境界更新、创建物品、创建NPC |
| add | 数值增减 | 修改数字类型的字段 | 灵石增减、时间推进、属性变化 |
| push | 数组添加 | 向数组末尾添加元素 | 添加记忆、添加状态效果、添加任务 |
| delete | 删除字段 | 移除整个字段 | 删除物品（数量为0时） |
| pull | 数组移除 | 从数组中移除匹配的元素 | 完成任务后从任务列表移除 |`;