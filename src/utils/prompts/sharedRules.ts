/**
 * @file Shared AI Prompt Rules (共享提示词规则)
 * @description 核心规则集，跨文件复用，减少token重复
 */

/**
 * 数据同步铁律 (Data Sync Rules)
 */
export const CORE_SYNC_RULES = `
========== 【最高优先级】数据同步铁律 ==========

【核心原则】
叙事文本(text)中的任何数据变化，都必须有对应的tavern_commands执行。
违反此规则将导致数据不一致，甚至程序崩溃。

【必须同步的事件检查清单】

**修炼**:
   - 推进时间（add游戏时间.分钟）
   - 增加境界进度（add玩家角色状态.境界.当前进度）
   - 增加功法进度（add背包.物品.{功法ID}.修炼进度）
   - 消耗灵气（set玩家角色状态.灵气.当前）

**突破**（5个境界字段+属性+寿命，缺一不可）:
   - 推进时间（add游戏时间.分钟）
   - 更新境界名称（set玩家角色状态.境界.名称）
   - 更新境界阶段（set玩家角色状态.境界.阶段）
   - 重置当前进度（set玩家角色状态.境界.当前进度，通常为0）
   - 更新下一级所需（set玩家角色状态.境界.下一级所需）
   - 更新突破描述（set玩家角色状态.境界.突破描述）**必须根据剧情动态生成**
   - 增加气血上限（add玩家角色状态.气血.上限）
   - 增加灵气上限（add玩家角色状态.灵气.上限）
   - 增加寿命上限（add玩家角色状态.寿命.上限）**必须用add不能用set**

**受伤**:
   - 推进时间（add游戏时间.分钟）
   - 扣除气血（add玩家角色状态.气血.当前，负数）**不要set整个气血对象**

**获得物品**:
   - 推进时间（add游戏时间.分钟）
   - 添加物品到背包（set背包.物品.{物品ID}，提供完整物品结构）
   - 必填字段：物品ID、名称、类型、品质、数量、描述

**消耗物品**:
   - 推进时间（add游戏时间.分钟）
   - 数量>1: 减少数量（add背包.物品.{物品ID}.数量，负数）
   - 数量=1: 删除整个物品（delete背包.物品.{物品ID}）

**NPC互动**:
   - 推进时间（add游戏时间.分钟）
   - 添加记忆（push人物关系.{NPC名字}.记忆）
   - 调整好感度（add人物关系.{NPC名字}.好感度）
   - 更新当前状态（set人物关系.{NPC名字}.当前外貌状态）
   - 更新内心想法（set人物关系.{NPC名字}.当前内心想法）

**位置移动**（三个字段必须同时更新）:
   - 推进时间（add游戏时间.分钟）
   - 更新位置描述（set玩家角色状态.位置.描述，格式"大陆名·地点名"）
   - 更新经度（set玩家角色状态.位置.longitude）
   - 更新纬度（set玩家角色状态.位置.latitude）

**创建NPC**:
   - 推进时间（add游戏时间.分钟）
   - 创建NPC档案（set人物关系.{NPC名字}，提供完整结构）
   - 必填字段：名字、性别、年龄、出生日期、种族、出生、外貌、性格、境界、灵根、天赋、六司、关系、好感度、位置、背包等
   - **NPC境界只有2个字段（名称、阶段），不要添加"当前进度"等玩家专属字段**
   - **如果nsfwMode=true且性别符合过滤条件，必须包含完整的私密信息（14个必填字段）**

【正确操作原则】

**正确做法**:
   - 修改具体字段路径，例如："背包.物品.sword_001.数量"
   - 数值增减用add，对象替换用set
   - 使用完整的点号路径：如"玩家角色状态.境界.名称"

**错误做法（禁止）**:
   - 使用set替换整个对象（如set整个"背包"、整个"装备栏"）
   - text中有剧情变化但commands为空数组
   - 只更新部分应该同步更新的字段（如突破时只更新境界名称）
   - 寿命上限使用set而不是add

【正确示例】

获得1把剑:
\`\`\`json
[
  {"action":"add","scope":"chat","key":"游戏时间.分钟","value":1},
  {"action":"set","scope":"chat","key":"背包.物品.sword_001","value":{"物品ID":"sword_001","名称":"青锋剑","类型":"武器","品质":{"quality":"玄","grade":3},"数量":1,"描述":"锋利的玄品长剑"}}
]
\`\`\`

消耗1颗丹药:
\`\`\`json
[
  {"action":"add","scope":"chat","key":"游戏时间.分钟","value":1},
  {"action":"add","scope":"chat","key":"背包.物品.pill_001.数量","value":-1}
]
\`\`\`

增加NPC好感度:
\`\`\`json
[
  {"action":"add","scope":"chat","key":"游戏时间.分钟","value":5},
  {"action":"add","scope":"chat","key":"人物关系.张三.好感度","value":5}
]
\`\`\`

炼气圆满突破到筑基初期:
\`\`\`json
[
  {"action":"add","scope":"chat","key":"游戏时间.分钟","value":60},
  {"action":"set","scope":"chat","key":"玩家角色状态.境界.名称","value":"筑基"},
  {"action":"set","scope":"chat","key":"玩家角色状态.境界.阶段","value":"初期"},
  {"action":"set","scope":"chat","key":"玩家角色状态.境界.当前进度","value":0},
  {"action":"set","scope":"chat","key":"玩家角色状态.境界.下一级所需","value":200},
  {"action":"set","scope":"chat","key":"玩家角色状态.境界.突破描述","value":"借筑基丹之力凝聚道台，灵气化液如江河"},
  {"action":"add","scope":"chat","key":"玩家角色状态.气血.上限","value":1200},
  {"action":"add","scope":"chat","key":"玩家角色状态.灵气.上限","value":1300},
  {"action":"add","scope":"chat","key":"玩家角色状态.寿命.上限","value":130}
]
\`\`\`

【错误示例（会导致数据丢失）】

错误：{"action":"set","key":"背包","value":{整个背包对象}}
   → 会覆盖整个背包，丢失其他已有物品

错误：{"action":"set","key":"装备栏","value":{整个装备栏对象}}
   → 会覆盖整个装备栏，丢失其他装备

错误：突破时只更新境界名称
   → 缺少阶段、进度、所需、突破描述，以及属性上限、寿命上限

错误：{"action":"set","key":"玩家角色状态.寿命.上限","value":230}
   → 寿命上限必须用add递增，不能用set直接设置
`;

/**
 * 境界阶段命名 (Realm Stage Naming)
 */
export const REALM_STAGE_RULE = `
========== 【境界阶段命名规则】 ==========

【正确的阶段名称】
- 初期
- 中期
- 后期
- 圆满
- 极境

【错误的阶段名称（禁止使用）】
- 一层、二层、三层...
- 一重、二重、三重...
- 第X层、第X阶段
- 大圆满（应使用"圆满"）
- 巅峰（应使用"圆满"或"极境"）

【特殊情况】
- 凡人境界: 没有阶段划分，阶段字段为空字符串（""）
- 炼气境及以上: 必须使用标准阶段名称（初期/中期/后期/圆满/极境）

【境界示例】
正确:
- {"名称":"炼气","阶段":"初期"}
- {"名称":"筑基","阶段":"圆满"}
- {"名称":"金丹","阶段":"极境"}
- {"名称":"凡人","阶段":""}

错误:
- {"名称":"炼气","阶段":"一层"}
- {"名称":"筑基","阶段":"第五层"}
- {"名称":"金丹","阶段":"三重"}
`;

/**
 * JSON格式规则 (JSON Format Rules)
 */
export const JSON_RULES = `
========== 【JSON格式严格要求】 ==========

【格式规范】
不得包含注释:
   - 禁止使用 // 单行注释
   - 禁止使用 /* */ 多行注释

不得有尾随逗号:
   - 错误: {"a":1,"b":2,}
   - 正确: {"a":1,"b":2}
   - 错误: [1,2,3,]
   - 正确: [1,2,3]

必须使用双引号:
   - 错误: {'name':'张三'}
   - 正确: {"name":"张三"}
   - 所有字段名必须加双引号
   - 所有字符串值必须用双引号

数字格式要求:
   - 禁止前导0: 不能写 01、001
   - 正确写法: 1、100
   - 数字不能有单位: {"age":18}，不是{"age":"18岁"}

空值处理:
   - 使用null: {"value":null}
   - 禁止undefined: {"value":undefined}
   - 空数组用[]: {"list":[]}，不是{"list":null}

布尔值:
   - 必须小写: true、false
   - 禁止大写: True、FALSE、TRUE

【字段类型要求】
- 数字字段必须是数字类型，不能是字符串
  - 正确: {"年龄":18,"好感度":50}
  - 错误: {"年龄":"18","好感度":"50"}

- 数组字段应该是空数组，不是null
  - 正确: {"记忆":[]}
  - 错误: {"记忆":null}

【完整示例】
正确的JSON:
\`\`\`json
{
  "text": "玩家修炼三天，境界进度增加10点。",
  "mid_term_memory": "玩家闭关修炼三日，境界进度略有提升。",
  "tavern_commands": [
    {"action":"add","scope":"chat","key":"游戏时间.分钟","value":4320},
    {"action":"add","scope":"chat","key":"玩家角色状态.境界.当前进度","value":10}
  ]
}
\`\`\`

错误的JSON:
\`\`\`json
{
  "text": "玩家修炼三天，境界进度增加10点。",
  "mid_term_memory": "玩家闭关修炼三日，境界进度略有提升。",
  "tavern_commands": [
    // 这是注释（禁止）
    {"action":"add","scope":"chat","key":"游戏时间.分钟","value":4320},
    {"action":"add","scope":"chat","key":"玩家角色状态.境界.当前进度","value":"10"}, // 错误：value应该是数字不是字符串
  ] // 错误：数组末尾有尾随逗号
}
\`\`\`
`;

/**
 * 六司系统 (Attribute System)
 */
export const INNATE_ATTRIBUTES_RULE = `
========== 【六司系统规则】 ==========

【核心概念】
人物属性分为先天六司和后天六司两部分，共同决定角色的最终属性。

【先天六司】天生属性，终生不可改变

**包含属性**:
- 根骨: 影响气血、体质、肉身强度
- 灵性: 影响灵气、灵觉、法术威力
- 悟性: 影响修炼速度、技能领悟
- 气运: 影响机缘、宝物获取、渡劫成功率
- 魅力: 影响人际关系、魅惑类技能
- 心性: 影响神识、抗压能力、心魔抵抗

**数值范围**: 1-10（普通人5，天才8-10，废材1-3）

**重要提醒**:
先天六司由出生时确定，任何情况下都不得修改
禁止操作: 任何试图修改先天六司的commands都是错误的

【后天六司】可变属性，通过外部手段获得

**来源**:
- 装备加成: 穿戴法宝、灵器等装备
- 大道感悟: 领悟三千大道（剑道、刀道、阵法之道等）
- 特殊机缘: 服用天材地宝、获得血脉传承
- 功法加成: 部分特殊功法提供属性加成

**修改方式**:
\`\`\`json
{"action":"add","scope":"chat","key":"角色基础信息.后天六司.根骨","value":1}
{"action":"add","scope":"chat","key":"角色基础信息.后天六司.灵性","value":2}
\`\`\`

使用add操作而不是set，因为后天六司是累加的

【属性计算公式】

**最终属性值 = 先天六司 × 100% + 后天六司 × 20%**

**示例计算**:
- 先天根骨: 6
- 后天根骨: 10（来自装备+5，大道+5）
- 最终根骨 = 6 × 100% + 10 × 20% = 6 + 2 = 8

**说明**:
- 先天属性是基础，占据主导地位（100%）
- 后天属性是辅助，只有20%的效果
- 这确保了天赋的重要性，同时也给后天努力留下了空间

【实际应用】

在判定、战斗、修炼等场景中，使用最终属性值进行计算:
- 修炼速度 = (灵性 × 2 + 悟性 × 5 + 根骨 + 心性) × 境界加成
- 战斗攻击 = (根骨 × 3 + 灵性 × 4 + 当前灵气 × 0.5) × 境界加成
- 探索机缘 = (气运 × 3 + 灵性 × 3 + 悟性 × 2) × 境界加成
`;

/**
 * 角色私密信息生成规则 (v4.0 - 字段精准匹配)
 */
export const NSFW_RULE = `
========== 【最高优先级】角色私密信息生成规则 ==========

【强制执行条件】
当 系统.nsfwMode === true 时，必须为符合性别过滤条件的所有NPC生成完整的私密信息对象

【性别过滤逻辑】
- 系统.nsfwGenderFilter === "all" → 所有NPC都必须生成私密信息（男女通用）
- 系统.nsfwGenderFilter === "female" → 仅女性NPC生成私密信息
- 系统.nsfwGenderFilter === "male" → 仅男性NPC生成私密信息

【严格要求】
不得以任何理由跳过、简化或省略私密信息的生成
这是强制性要求，违反将导致生成失败

【第一步：生成时机】
- 创建NPC时：必须立即生成完整的私密信息对象，不得遗漏任何字段
- 后续更新：可以更新动态字段（如性渴望程度、当前性状态等）

【第二步：必填字段】私密信息对象必须包含以下14个字段，缺一不可

[核心字段列表]
1. 是否为处女: boolean（女性NPC必填）
2. 是否为处男: boolean（男性NPC必填）
3. 身体部位: Array（必须包含3-5个部位对象）
   每个部位对象包含：部位名称、敏感度(0-100)、开发程度(0-100)、特殊标记(可选)、描述
4. 性格倾向: string（可选值："纯情" | "主动" | "被动" | "淫荡" | "M" | "S" | "双性"）
5. 性取向: string（可选值："异性恋" | "同性恋" | "双性恋" | "泛性恋"）
6. 性癖好: Array（0-3个元素）
7. 性渴望程度: number（范围：0-100）
8. 当前性状态: string（可选值："正常" | "微湿" | "兴奋" | "发情" | "高潮"等）
9. 体液分泌状态: string（描述性文字）
10. 性交总次数: number（非负整数）
11. 性伴侣数量: number（非负整数）
12. 性伴侣名单: Array<string>（禁止使用"保密"、"未知"等占位符）
13. 最近一次性行为时间: string（时间格式或"从未"）
14. 特殊体质: Array（0-N个元素）

【玩家角色身体部位】
当nsfwMode=true时，玩家角色也应该有身体部位开发数据
- 结构：SaveData.身体部位开发 = {部位名称: {描述, 开发等级, 敏感度, 特殊标记}}
- 初始化：角色创建时应生成核心身体部位(3-5个)，根据性别选择合适的部位
- 更新：使用set命令更新: {"action":"set","key":"身体部位开发.阴道","value":{"描述":"...","开发等级":30,"敏感度":65}}
- 部位建议：
  * 女性：乳房、乳头、阴蒂、阴道、阴道深处、子宫、肛门、嘴唇、舌头、耳垂、脖颈、腰部、大腿内侧
  * 男性：阴茎、龟头、睾丸、肛门、前列腺、乳头、嘴唇、耳垂

【第三步：逻辑约束】必须保持数据一致性
- 所有数值字段范围：0-100
- 逻辑一致性：是否为处女/处男=true → 性交总次数=0 且 性伴侣数量=0 且 性伴侣名单=[]
- 数量匹配：性伴侣数量 必须等于 性伴侣名单.length

【第四步：叙事整合】私密信息必须影响NPC行为
- NPC的行为和对话必须与性格倾向、性渴望程度保持一致
- 好感度低于60时，NPC会拒绝亲密行为
- 违反人格底线的行为会导致好感度暴跌
- 亲密行为的门槛：好感度≥60 或 性渴望≥70（纯情性格需要好感度≥80）

【重要提醒】
当nsfwMode=true时，创建任何NPC都必须包含完整的私密信息对象（14个必填字段）
这是强制性要求，不可省略、简化或延后生成
`;

/**
 * 操作类型速查 (Action Types)
 */
export const ACTION_TYPES = `
【tavern_commands操作类型】

| 操作类型 | 用途说明 | 适用场景 | 示例 |
|---------|---------|---------|------|
| set | 替换整个值 | 创建/更新对象、设置单个字段 | 境界更新、创建物品、创建NPC |
| add | 数值增减 | 修改数字类型的字段 | 灵石增减、时间推进、属性变化 |
| push | 数组添加 | 向数组末尾添加元素 | 添加记忆、添加状态效果、添加任务 |
| delete | 删除字段 | 移除整个字段 | 删除物品（数量为0时） |
| pull | 数组移除 | 从数组中移除匹配的元素 | 完成任务后从任务列表移除 |`;