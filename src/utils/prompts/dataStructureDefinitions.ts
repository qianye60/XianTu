import { ROLE_PLAY_INSTRUCTION } from './gameElementPrompts';
/**
 * 数据结构定义（仅结构，不含操作说明）
 */

// 核心同步规则（被其他提示词引用）
export const CORE_SYNC_RULES = `
# 🔴 叙事-数据同步规则

**原则**: text写什么 → tavern_commands执行什么

## 对应表
| 文本 | 指令 |
|------|------|
| 修炼X天 | add游戏时间.分钟 |
| 境界提升 | set境界(名称/阶段/进度/上限) |
| 消耗灵气 | set属性.灵气.当前 |
| 受伤 | set属性.气血.当前 |
| 获得物品 | set背包_物品 |
| 学会技能 | set掌握技能 |
| 好感变化 | add人物关系.NPC名.好感度 |

## 错误示例

❌ text:"修炼三天" + commands:[]
✅ text:"修炼三天" + commands:[add时间, add进度, set灵气]

❌ text:"突破练气二层" + commands:[add进度]
✅ text:"突破练气二层" + commands:[set境界.阶段, set进度=0, set上限]

❌ text:"重伤" + commands:[]
✅ text:"重伤" + commands:[set气血.当前]

## 修炼流程
1. add游戏时间.分钟
2. add境界.当前进度
3. set属性.灵气.当前
4. add背包_物品.功法ID.修炼进度（更新背包中的本体，不更新修炼功法分片）
5. text写明判定+数据

## 自检
- [ ] text有变化？commands有对应？
- [ ] commands为空？text无变化？
`;

export const DATA_STRUCTURE_DEFINITIONS = `
# 数据结构

## JSON规则
- 禁止注释 (//, /**/)
- 禁止尾随逗号
- 字符串用双引号
- 严格语法

## 坐标系统
经度:100-130, 纬度:25-45, 精度:2-4位小数

## 品质
{"quality":"凡|黄|玄|地|天|仙|神","grade":0-10}
开局限制:≤玄品

## 六司
{"根骨":0-10,"灵性":0-10,"悟性":0-10,"气运":0-10,"魅力":0-10,"心性":0-10}

## 境界
{"名称":"string","阶段":"初期|中期|后期|圆满","当前进度":number,"下一级所需":number}

## NPC物品规则
- 每个NPC必须3-8件物品
- 品质匹配境界(炼气:凡, 筑基:黄, 金丹:玄)
- 灵石:散修100-500下品, 弟子500-2000, 长老1000+

## 角色基础
\`\`\`json
{
  "名字":"string","性别":"男|女|其他","年龄":number,
  "出生日期":{"年":number,"月":number,"日":number},
  "世界":"string","种族":"string(默认人族)",
  "灵根":{"名称":"string","品级":"string"},
  "天赋":[{"名称":"string","描述":"string"}],
  "先天六司":{"根骨":5,"灵性":5,"悟性":5,"气运":5,"魅力":5,"心性":5}
}
\`\`\`

⚠️ 年龄系统: 年龄=当前时间.年-出生日期.年 (自动计算,禁止修改)

## NPC档案
\`\`\`json
{"名字":"string","性别":"男|女|其他","年龄":number,"出生日期":{"年":number,"月":number,"日":number},"种族":"string(默认人族)","出生":"string","外貌描述":"string","性格特征":["string"],"境界":{"名称":"练气|筑基|金丹","阶段":"初期|中期|后期|圆满|极境"},"灵根":{"名称":"string","品级":"string"},"天赋":[{"名称":"string","描述":"string"}],"先天六司":{"根骨":5,"灵性":5,"悟性":5,"气运":5,"魅力":5,"心性":5},"与玩家关系":"道侣|师徒|朋友|敌人|陌生人","好感度":number(-100到100),"人格底线":["string(0-5个)"],"记忆":[{"时间":"具体日期","事件":"事件描述"}],"记忆总结":["string"],"当前位置":{"描述":"大陆名·具体位置","longitude":number(100-130),"latitude":number(25-45)},"势力归属":"string","当前外貌状态":"string(实时用set替换)","当前内心想法":"string(实时用set替换)","背包":{"灵石":{"下品":number,"中品":number,"上品":number,"极品":number},"物品":{"物品ID":{"名称":"string","类型":"丹药|装备|功法|材料|其他","品质":{...},"描述":"string"}}},"私密信息":{"是否为处女":boolean,"是否为处男":boolean,"身体部位":[{"部位名称":"string","敏感度":number(0-100),"开发程度":number(0-100),"特殊标记":"string","描述":"string"}],"性格倾向":"纯情|主动|被动|淫荡|M|S|双性","性取向":"异性恋|同性恋|双性恋|泛性恋","性癖好":["string"],"性渴望程度":number(0-100),"当前性状态":"正常|微湿|兴奋|发情|潮吹|高潮|连续高潮|贤者时间","体液分泌状态":"string","性交总次数":number,"性伴侣数量":number,"性伴侣名单":["string"],"最近一次性行为时间":"string","特殊体质":["易潮吹|多重高潮|性爱成瘾|淫纹"]},"实时关注":boolean(默认false)}
\`\`\`

⚠️ 年龄=当前游戏时间.年-出生日期.年，生成NPC时出生日期.年=当前年-年龄，永远不要修改年龄和出生日期
⚠️ 私密信息仅nsfwMode=true且性别符合nsfwGenderFilter时生成

## 游戏时间
\`\`\`json
{"年":number,"月":number(1-12),"日":number(1-30),"小时":number(0-23),"分钟":number(0-59)}
\`\`\`
⚠️ 字段名必须："小时""分钟"，禁止"时""分"简写，禁止添加"纪元"等额外字段
⚠️ 时间推进：{"action":"add","key":"游戏时间.分钟","value":推进分钟数}，自动进位(60分钟=1小时，24小时=1日，30日=1月，12月=1年)

## 位置
\`\`\`json
{"描述":"大陆名·地点名","longitude":number(100-130),"latitude":number(25-45)}
\`\`\`
⚠️ 更新位置铁律：
1. 获取地图：世界信息.地图
2. 查询坐标所在大陆(continents)、势力(factions)、地点(features)
3. 生成描述："大陆名·地点名"(基于查询结果，禁止编造)
4. 同时更新描述+longitude+latitude三个字段
❌ 禁止：描述与坐标不匹配、只更新部分字段、沿用旧描述不查地图

⚠️ NSFW生成：首次创建NPC时立即生成，身体部位含敏感度(20-80)、开发程度(0-30)、描述
⚠️ NPC独立人格：好感<60拒绝物化，触犯底线好感断崖下跌
⚠️ 性关系门槛：好感≥60或性渴望≥70，纯情需好感≥80

## 三千大道
\`\`\`json
{"大道列表":{"剑道":{"道名":"剑道","描述":"string","阶段列表":[{"名称":"剑意入门","描述":"string","突破经验":1000}],"是否解锁":true,"当前阶段":0,"当前经验":500,"总经验":500}}}
\`\`\`

## 世界信息
\`\`\`json
{"世界名称":"string","世界背景":"string","世界纪元":"string","特殊设定":["string"],"版本":"string","生成时间":"string","大陆信息":[{"名称":"string","描述":"string","范围":"string","特色":"string"}],"势力信息":[{"名称":"string","类型":"修仙宗门|魔道宗门","等级":"超级|一流|二流|三流","所在大洲":"string","位置":"string","势力范围":["string"],"描述":"string","特色":"string","与玩家关系":"敌对|中立|友好|盟友","leadership":{"宗主":"string","宗主修为":"string","副宗主":"string","太上长老":"string","太上长老修为":"string","长老数量":number,"最强修为":"string","综合战力":number,"核心弟子数":number,"内门弟子数":number,"外门弟子数":number}}],"地点信息":[{"名称":"string","类型":"城池|宗门|秘境|险地|商会|坊市|洞府","位置":"string","coordinates":{"longitude":number,"latitude":number},"描述":"string","特色":"string","安全等级":"安全|较安全|危险|极危险","开放状态":"开放|限制|封闭|未发现","相关势力":["string"]}]}
\`\`\`

## 天赋
\`\`\`json
{"名称":"string","描述":"string","效果":"string",
"稀有度":"普通|稀有|史诗|传说"}
\`\`\`

## 灵根
\`\`\`json
{"名称":"string","品级":"下品|中品|上品|极品|天品|神品","描述":"string","属性":["string"],"修炼加成":number}
\`\`\`

## 出生背景
\`\`\`json
{"名称":"string","描述":"string","初始资源":{"灵石":{"下品":number,"中品":number,"上品":number,"极品":number},"物品":["string"],"关系":["string"]}}
\`\`\`

## 功法
\`\`\`json
{"名称":"string","类型":"功法","品质":{"quality":"凡|黄|玄|地|天|仙|神","grade":0-10},"描述":"string","功法效果":{"修炼速度加成":1.35,"属性加成":{"根骨":1,"灵气上限":50},"特殊能力":["string"]},"功法技能":{"技能名":{"名称":"string","描述":"string","消耗":"string"}}}
\`\`\`

## 宗门系统
\`\`\`json
{"sectName":"string","sectType":"正道宗门|魔道宗门|中立宗门|商会|世家|散修联盟","position":"散修|外门弟子|内门弟子|核心弟子|传承弟子|执事|长老|太上长老|副掌门|掌门","contribution":0,"relationship":"仇敌|敌对|冷淡|中立|友好|盟友|附庸","reputation":0,"joinDate":"string","description":"string","师父":"string","同门关系":["string"],"宗门职务":["string"]}
\`\`\`

## 装备系统
⚠️ **装备栏和"已装备"字段都是只读的（由程序/玩家操作管理）**

### 装备栏结构（只读 - 禁止修改）
\`\`\`json
{"装备栏":{"装备1":null,"装备2":null,"装备3":null,"装备4":null,"装备5":null,"装备6":null}}
\`\`\`

⚠️ **装备管理原则（最高优先级）**：
- ❌ **禁止通过 tavern_commands 操作任何与装备相关的内容**
- ❌ 禁止操作 装备栏.*
- ❌ 禁止操作 背包_物品.*.已装备 字段
- 装备和卸下装备完全由玩家在UI界面操作，AI无需也不能干预
- AI只需要负责创建物品到背包，装备由玩家自行决定

### AI的职责
✅ **AI只负责创建物品**：
\`\`\`json
{"action":"set","key":"背包_物品.天蚕羽衣","value":{"物品ID":"天蚕羽衣","名称":"天蚕羽衣","类型":"装备","品质":{"quality":"玄","grade":5},"描述":"...","已装备":false}}
\`\`\`
- 创建物品时，已装备字段默认为 false
- **之后不要再碰这个字段**，由程序管理

### 玩家的职责
- 玩家在UI界面点击"装备"按钮
- 程序自动调用 equipItem() 函数
- 程序更新已装备字段和装备栏分片

## 修炼功法系统
⚠️ **三层架构**：
  - **背包_物品.功法ID**：功法本体，存储所有数据和进度（❗唯一可修改，修炼进度在这里更新）
  - **修炼功法**：只读引用（装备时自动复制，卸下时自动清空，❌禁止通过命令直接修改）
  - **掌握技能**：自动计算数组（根据功法修炼进度自动解锁技能，❌禁止通过命令直接修改）

⚠️ **重要**：AI只能操作背包中的功法本体，不能直接修改"修炼功法"和"掌握技能"分片

### 背包中的功法物品（本体 - 可修改）
\`\`\`json
{"物品ID":"string","名称":"string","类型":"功法","品质":{"quality":"玄","grade":5},"描述":"string","功法效果":{"修炼速度加成":1.4,"属性加成":{"根骨":2,"灵气上限":100},"特殊能力":["string"]},"功法技能":{"技能名":{"技能名称":"string","技能描述":"string","消耗":"string","解锁需要熟练度":100}},"修炼进度":0,"修炼中":false}
\`\`\`
⚠️ 修炼进度更新：{"action":"add","key":"背包_物品.功法ID.修炼进度","value":增量}
⚠️ 技能解锁条件：功法技能可定义"解锁需要熟练度"阈值，达到后自动加入掌握技能

### 修炼功法分片（只读引用 - 禁止修改）
\`\`\`json
{"物品ID":"string","名称":"string","类型":"功法","品质":{"quality":"玄","grade":5},"描述":"string","功法效果":{"修炼速度加成":1.4,"属性加成":{"根骨":2,"灵气上限":100},"特殊能力":["string"]},"功法技能":{"技能名":{"技能名称":"string","技能描述":"string","消耗":"string"}},"熟练度":0,"已解锁技能":[],"修炼时间":0,"突破次数":0,"正在修炼":true,"修炼进度":0}
\`\`\`
⚠️ 装备功法：由程序从背包复制完整数据到此分片（包含当前进度）
⚠️ 卸下功法：由程序清空此分片，背包中的本体保留进度
⚠️ 日常修炼：❌禁止更新此分片，只更新背包中的本体
⚠️ 此分片仅用于UI显示，不接受tavern_commands操作

### 掌握技能数组（自动计算 - 禁止修改）
\`\`\`json
[{"技能名称":"string","技能描述":"string","来源":"功法名称","消耗":"string","熟练度":0,"使用次数":0}]
\`\`\`
⚠️ 自动计算：程序根据背包中功法的修炼进度，自动判断解锁了哪些技能
⚠️ 解锁规则：功法技能定义"解锁需要熟练度"，达到阈值自动添加到此数组
⚠️ ❌禁止通过tavern_commands直接操作此数组

## 系统设置
⚠️ **系统分片是只读的（由前端管理，存储用户设置）**

### 系统分片结构（只读 - 禁止修改）
\`\`\`json
{"nsfwMode":boolean,"nsfwGenderFilter":"all"|"female"|"male"}
\`\`\`

⚠️ **禁止操作**：
- ❌ 禁止通过 tavern_commands 修改 \`系统.*\`
- 这些是用户在设置界面配置的选项，由前端程序管理
- AI只能读取这些设置来决定是否生成NSFW内容，但不能修改它们

`.trim();

// 功法生成
export const TECHNIQUE_ITEM_GENERATION_PROMPT = `${ROLE_PLAY_INSTRUCTION}
# 任务：生成功法秘籍
品质加成：凡(1.05-1.15)、黄(1.2-1.35)、玄(1.4-1.6)、地(1.7-1.9)、天(2.0-2.3)、仙(2.5-3.0)、神(3.5-5.0)
技能要求：凡/黄(可无)、玄(≥1个)、地(≥2个)、天(≥3个)、仙(≥4个)

## JSON输出格式
\`\`\`json
{"名称":"功法名称","类型":"功法","品质":{"quality":"品质","grade":5},"描述":"功法描述","功法效果":{"修炼速度加成":1.35,"属性加成":{"根骨":1,"灵气上限":50},"特殊能力":["特殊能力描述"]},"功法技能":{"技能1名称":{"名称":"技能1名称","描述":"技能1效果描述","消耗":"消耗描述"}}}
\`\`\`
`;
