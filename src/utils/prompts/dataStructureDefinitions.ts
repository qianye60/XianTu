import { REALM_STAGE_RULE, NSFW_RULE, NPC_MEMORY_UPDATE_RULE, PLAYER_INTENT_RESPECT_RULE, THREE_THOUSAND_DAOS_RULE } from '@/utils/prompts/sharedRules'

// ===================================================================================
//
//                                  数据结构模块定义
//
//          将庞大的SaveData结构拆分为多个逻辑模块，便于维护和理解。
//
// ===================================================================================

const CHARACTER_STRUCTURE = `
## 1. 角色信息 (Character Information)

### 1.1 角色基础信息 (Base Info - Mostly Read-only)
- 名字: string (只读)
- 性别: "男"|"女"|"其他" (只读)
- 年龄: number (自动计算，禁改)
- 出生日期: {年, 月, 日, 小时?, 分钟?} (只读)
- 世界: string (只读)
- 种族: string (默认"人族")
- 天资: string (只读)
- 出生: string|{名称, 描述} (只读)
- 灵根: string|{名称, 品级, 描述, 属性[], 修炼加成} (只读)
- 天赋: [{名称, 描述}] (只读)
- 先天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性} (只读，1-10)
- 后天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性} (可修改，用add)

### 1.2 玩家角色状态 (Player Status - Modifiable)
- 境界: {名称, 阶段, 当前进度, 下一级所需, 突破描述} (用set更新整个对象，突破时必须更新突破描述)
- 声望: number (用add)
- 气血: {当前, 上限} (当前用add，上限突破时用add)
- 灵气: {当前, 上限} (当前用add，上限突破时用add)
- 神识: {当前, 上限} (当前用add，上限突破时用add)
- 寿命: {当前, 上限} (当前自动增加，上限突破时用add)
- 位置: {描述:"大陆·地点", x, y} (用set更新整个对象，三个字段必须同时设置)
- 状态效果: [{状态名称, 类型:"buff"|"debuff", 生成时间, 持续时间分钟, 状态描述, 强度?, 来源?}]
  重要规则：
  - 只能用push添加，禁止删除（系统会自动删除过期状态）
  - 类型字段必须严格区分：增益状态用"buff"，减益状态用"debuff"（全小写）
  - 生成时间：{年, 月, 日, 小时, 分钟}（使用当前游戏时间）
  - 持续时间分钟：数值类型，表示持续多少分钟（99999表示永久）
  示例-增益：{"状态名称":"灵气充盈","类型":"buff","生成时间":{...},"持续时间分钟":120,"状态描述":"灵气恢复速度提升50%","强度":5,"来源":"修炼"}
  示例-减益：{"状态名称":"内伤","类型":"debuff","生成时间":{...},"持续时间分钟":1440,"状态描述":"气血恢复速度降低30%","强度":3,"来源":"战斗受伤"}

### 1.3 装备栏 (Equipment - Read-only for AI)
- 装备1: string|null (装备ID或null)
- 装备2: string|null
- 装备3: string|null
- 装备4: string|null
- 装备5: string|null
- 装备6: string|null
`

const DAO_STRUCTURE = `
## 2. 三千大道 (Three Thousand Daos - Modifiable)
- 大道列表: {道名: DaoData对象}
  - 道名: string
  - 描述: string
  - 阶段列表: [{名称, 描述, 突破经验}]
  - 是否解锁: boolean (解锁大道时必须设为true)
  - 当前阶段: number (阶段索引，0为入门)
  - 当前经验: number (用add增加经验)
  - 总经验: number
  重要：操作大道时使用路径: 三千大道.大道列表.{道名}.字段名
  示例-解锁并初始化大道: {"action":"set","key":"三千大道.大道列表.剑道","value":{道名:"剑道",描述:"...",是否解锁:true,当前阶段:0,当前经验:0,总经验:0,阶段列表:[...]}}
  示例-增加经验: {"action":"add","key":"三千大道.大道列表.剑道.当前经验","value":100}
`

const INVENTORY_STRUCTURE = `
## 3. 背包与物品 (Inventory & Items - Modifiable)

### 3.1 背包 (Inventory)
- 灵石: {下品, 中品, 上品, 极品} (用add增减)
- 物品: {物品ID: Item对象} (用set添加物品，用add修改数量，用delete删除)

### 3.2 物品类型 (Item Types)
  - 装备物品: {物品ID, 名称, 类型:"装备", 品质, 数量, 描述, 装备增幅?, 特殊效果?, 已装备}
    - 装备增幅: 对象，包含属性加成，如 {"后天六司": {"根骨": 2}, "气血上限": 50}
    - 特殊效果: 字符串，描述装备的特殊能力，如 "攻击时有10%几率触发火焰伤害"
  - 功法物品: {物品ID, 名称, 类型:"功法", 品质, 数量, 描述, 功法效果, 功法技能[], 修炼进度, 已解锁技能[], 已装备}
    重要: 修炼进度和已解锁技能存储在背包物品中，用add/set修改
    示例: {"action":"add","key":"背包.物品.gongfa_001.修炼进度","value":10}
  - 丹药物品: {物品ID, 名称, 类型:"丹药", 品质, 数量, 描述, 使用效果}
  - 其他物品: {物品ID, 名称, 类型:"材料"|"其他", 品质, 数量, 描述, 使用效果?}

### 3.3 修炼功法 (Active Skill - Read-only Reference)
- 物品ID: string (指向背包中的功法ID)
- 名称: string
  注意: 此处只存储引用，修炼进度和已解锁技能存储在背包.物品.{功法ID}中

### 3.4 掌握技能 (Mastered Skills - Auto-calculated)
- [{技能名称, 技能描述, 来源, 消耗, 熟练度, 使用次数}] (自动计算，禁止修改)
`

const RELATIONS_STRUCTURE = `
## 4. 人物关系 (Relationships - Modifiable)
- {NPC名字: NPC档案对象}
  - 名字: string
  - 性别: "男"|"女"|"其他"
  - 年龄: number (自动计算)
  - 出生日期: {年, 月, 日}
  - 种族: string
  - 出生: string
  - 外貌描述: string
  - 性格特征: [string]
  - 境界: {名称, 阶段} (注意：NPC境界是简化结构，严禁添加"当前进度"等玩家专属字段)
  - 灵根: {名称, 品级}
  - 天赋: [{名称, 描述}]
  - 先天六司: {根骨, 灵性, 悟性, 气运, 魅力, 心性}
  - 与玩家关系: string
  - 好感度: number (-100~100，用add)
  - 人格底线: [string]
  - 记忆: [string] (用push添加。遵循【记忆生成铁律】：简洁、不重复、结构化摘要)
  - 记忆总结: [string]
  - 当前位置: {描述, x, y}
  - 势力归属: string
  - 当前外貌状态: string (用set实时更新)
  - 当前内心想法: string (用set实时更新)
  - 背包: {灵石, 物品}
  - 私密信息: {
      是否为处女: boolean,
      身体部位: [{部位名称, 开发度, 敏感度, 特征描述, 特殊印记}],
      性格倾向: string,
      性取向: string,
      性癖好: [string],
      性渴望程度: number,
      当前性状态: string,
      体液分泌状态: string,
      性交总次数: number,
      性伴侣名单: [string],
      最近一次性行为时间: string,
      特殊体质: [string]
    } (条件生成：仅当系统.nsfwMode=true且性别符合nsfwGenderFilter时生成)
    - 身体部位结构铁律: 身体部位必须是一个对象数组。每个对象都必须包含 '部位名称', '开发度', '敏感度', '特征描述', '特殊印记' 这些字段。
      正确示例: "身体部位": [{ "部位名称": "胸部", "开发度": 0, "敏感度": 20, "特征描述": "...", "特殊印记": "无" }]
    - 生成规则: 创建NPC时若满足条件必须立即生成，不得省略或使用占位符
  - 实时关注: boolean
`

const MEMORY_STRUCTURE = `
## 5. 记忆 (Player Memory - Read-only, DO NOT MODIFY)

最高优先级铁律：AI严禁通过tavern_commands修改游戏记忆字段

严禁操作：严禁使用各种命令对记忆进行任何的操作，记忆的操作由代码运行维护

正确做法：
- 只通过响应JSON的 \`mid_term_memory\` 字段提供记忆摘要
- 系统会自动处理记忆的添加、整理和归档
- AI只需要专注于生成高质量的中期记忆摘要

数据结构（仅供参考，禁止直接操作）：
- 短期记忆: [string] (记录最近发生的3-5个核心事件)
- 中期记忆: [string] (由短期记忆提炼、合并、总结而来，更具概括性)
- 长期记忆: [string] (记录对角色产生深远影响的关键事件)
`

const WORLD_INFO_STRUCTURE = `
## 6. 世界信息 (World Information - Modifiable)
- 地图: {continents[], factions[], features[]}
- 大陆信息: [{名称, 描述, 地理特征, ...}]
- 势力信息: [{...}] (世界中的宗门、世家等)
  - id: string|number (可选)
  - 名称: string
  - 类型: "修仙宗门"|"魔道宗门"|"修仙世家"|...
  - 等级: "超级"|"一流"|"二流"|"三流"
  - 位置: string | {x, y}
  - 描述: string
  - 特色: [string]
  - 与玩家关系: "敌对"|"中立"|"友好"
  - 声望值: number
  - 可否加入: boolean
  - 加入条件: [string]
  - 加入好处: [string]
  - 成员数量: { 总数, 按境界, 按职位 }
    - 总数: number
    - 按境界: { "练气": number, "筑基": number, ... }
    - 按职位: { "外门弟子": number, "内门弟子": number, ... }
  - 领导层: { 宗主, 宗主修为, 副宗主?, 长老数量?, 最强修为, 综合战力? }
    - 宗主: string
    - 宗主修为: string (例如: "元婴后期")
    - 综合战力: number (1-100)
  - 势力范围详情: { 控制区域, 影响范围, 战略价值 }
    - 控制区域: [string]
    - 影响范围: string
    - 战略价值: number (1-10)
- 地点信息: [{名称, 类型, 位置, coordinates, ...}]
`

const GAME_STATE_STRUCTURE = `
## 7. 游戏状态 (Game State - Modifiable)

### 7.1 游戏时间 (Game Time)
- 年: number
- 月: number (1-12)
- 日: number (1-30)
- 小时: number (0-23)
- 分钟: number (0-59) (用add推进，自动进位)

### 7.2 宗门信息 (Sect Information)
- 宗门名称: string
- 宗门类型: "正道宗门"|"魔道宗门"|...
- 职位: "外门弟子"|"内门弟子"|...
- 贡献: number (用add)
- 关系: "中立"|"友好"|...
- 声望: number (用add)
- 加入日期: string
- 描述?: string
- 师父?: string
- 同门关系?: [string]
- 宗门职务?: [string]
`

const QUEST_SYSTEM_STRUCTURE = `
## 8. 任务系统 (Quest System - Modifiable)
- 配置: {启用系统任务, 系统任务类型, 自动刷新, 默认任务数量}
- 当前任务列表: [任务对象] (用push添加新任务)
- 已完成任务: [任务对象] (任务完成后，从"当前"移至此处)
- 任务统计: {完成总数, 各类型完成: Record<任务类型, number>}

### 8.1 任务对象结构 (Quest Object)
- 任务ID: string (唯一ID, 格式: quest_类型_时间戳)
- 任务名称: string
- 任务描述: string
- 任务类型: "宗门"|"奇遇"|"日常"|"系统任务"|"道侣培养"|"修为提升"|"收集资源"|"战斗挑战" (无主次之分)
- 任务状态: "进行中"|"已完成"|"已失败"
- 目标列表: [目标对象]
  - 描述: string (例: "击败3只黑风狼")
  - 类型: "击杀"|"采集"|"对话"|"到达"|"使用物品"
  - 目标ID: string (例: "monster_黑风狼", "item_灵草")
  - 需求数量: number
  - 当前进度: number (用add更新)
  - 已完成: boolean
- 奖励: {奖励对象}
  - 修为?: number
  - 灵石?: {下品?, 中品?, 上品?, 极品?}
  - 物品?: [{物品ID, 名称, 数量}]
  - 声望?: {势力名称, 变化值}
  - 属性加成?: {后天六司}
  - 好感度?: {NPC名称, 变化值}
- 发布者?: string (NPC名称或"系统")
- 创建时间: {游戏时间对象} or string
- 完成时间?: {游戏时间对象} or string
- AI生成: boolean (通常为true)
`

const SYSTEM_CONFIG_STRUCTURE = `
## 9. 系统配置 (System Config - Read-only)
- nsfwMode: boolean
- nsfwGenderFilter: "all"|"female"|"male"
`

// ===================================================================================
//
//                                  主数据结构聚合
//
// ===================================================================================

export const SaveData = `
# 【数据结构定义】完整SaveData结构
${CHARACTER_STRUCTURE}
${DAO_STRUCTURE}
${INVENTORY_STRUCTURE}
${RELATIONS_STRUCTURE}
${MEMORY_STRUCTURE}
${WORLD_INFO_STRUCTURE}
${GAME_STATE_STRUCTURE}
${QUEST_SYSTEM_STRUCTURE}
${SYSTEM_CONFIG_STRUCTURE}
`

// ===================================================================================
//
//                                  核心规则与指南
//
// ===================================================================================

const RESPONSE_FORMAT = `
# 强制响应格式 - 必须严格遵守

你的每次响应必须是一个有效的JSON对象，含有三个字段，格式如下：

\`\`\`json
{
  "text": "叙事文本内容（必填，不能为空字符串）",
  "mid_term_memory": "中期记忆摘要（选填，可为空字符串）",
  "tavern_commands": [
    {"action": "set|add|push|pull|delete", "key": "字段路径", "value": 值}
  ]
}
\`\`\`

## 关键要求：
1. 必须是纯JSON - 不要在JSON前后添加任何说明文字
2. text字段必填 - 即使没有叙事内容，也要写"继续观察"等占位文本
3. tavern_commands是数组 - 即使只有一条指令，也要用数组包裹 \`[{...}]\`
4. 所有字符串必须用双引号 - 不能用单引号
5. 不要有尾随逗号 - JSON最后一个元素后不能有逗号
6. 特殊字符必须转义 - 换行用 \`\\n\`，引号用 \`\\"\`

## 指令对象格式严格要求：
每个指令对象必须且只能包含以下字段：
- action: 必需，值为 "set" | "add" | "push" | "pull" | "delete"
- key: 必需，字符串类型，表示字段路径
- value: 必需（delete操作除外），值类型根据操作和路径而定
- 严禁添加任何其他字段

操作说明：
- set: 设置字段值（覆盖）
- add: 数值增减
- push: 向数组末尾添加元素
- pull: 从数组中移除匹配的元素（value是匹配条件对象）
- delete: 删除字段

正确示例（只包含必需字段）：
\`\`\`json
{"action":"set","key":"玩家角色状态.境界","value":{...}}
{"action":"pull","key":"玩家角色状态.状态效果","value":{"状态名称":"道心蒙尘"}}
{"action":"pull","key":"任务系统.当前任务列表","value":{"任务ID":"quest_001"}}
\`\`\`

## 正确示例：
\`\`\`json
{
  "text": "【清晨的阳光透过窗棂洒入房间】你缓缓睁开双眼，感觉体内灵气运转顺畅。",
  "mid_term_memory": "在客栈修炼一夜，境界稳固",
  "tavern_commands": [
    {"action": "add", "key": "游戏时间.小时", "value": 8},
    {"action": "add", "key": "玩家角色状态.灵气.当前", "value": 50}
  ]
}
\`\`\`
`

const CORE_RULES = `
# 核心规则与指南 (Core Rules & Guidelines)

## 1. 数据结构严格性 (Data Structure Strictness) - 最高优先级
- 严格遵守结构: 你的输出必须严格匹配数据结构定义。
- 禁止添加额外字段: 严禁在任何对象中添加结构树未定义的字段。例如，NPC的\`境界\`对象只有\`名称\`和\`阶段\`，不可添加\`当前进度\`。
- 结构错误 > 内容不佳: 一个结构完全正确但内容平庸的JSON，远好于一个内容丰富但结构错误的JSON。前端解析失败会导致整个对象无法显示。
- 字段类型必须正确: 数字字段必须是number类型，字符串字段必须是string类型，对象字段必须是object类型，数组字段必须是array类型。不要把数字写成字符串，不要把对象写成字符串。

## 2. 只读字段 (Read-only Fields) - 禁止修改
- \`装备栏.* \`: 由玩家UI操作
- \`修炼功法.* \`: 只存储引用（物品ID+名称），修炼进度存储在背包.物品中
- \`掌握技能\`: 根据功法进度自动计算
- \`系统.* \`: 前端用户设置
- \`角色基础信息\` 的大部分字段（除了后天六司）
- \`年龄\`: 自动计算（当前年 - 出生年）

## 3. 关键操作指南 (Key Operation Guides)

### 境界突破 (Realm Breakthrough) - 最重要，必须完整执行
境界突破是核心玩法，必须严格按照以下清单顺序执行，确保所有相关数据同步更新。

核心铁律：文本描述了突破，就必须执行突破命令
- 如果叙事文本中描述了"引气入体"、"感悟灵气"、"突破境界"、"修为提升"等内容
- 必须在 \`tavern_commands\` 中包含境界更新命令
- 严禁只写文本不执行命令的行为

特别提醒：凡人→练气期突破
- 当玩家从"凡人"境界首次引气入体、感悟天地灵气或者修行成功时
- 必须立即将境界从"凡人"更新为"练气-初期"
- 这是修仙的第一步，绝对不能遗漏

检查清单 (Checklist)：
1. 更新境界对象: 使用 \`set\` 操作更新整个 \`玩家角色状态.境界\` 对象。
   - \`名称\`: 字符串类型 (例如: "凡人" → "练气", "练气" → "筑基")
   - \`阶段\`: 字符串类型 (例如: "初期" → "中期")
   - \`当前进度\`: 数字类型，重置为 0
   - \`下一级所需\`: 数字类型，设置下一级所需进度
   - \`突破描述\`: 字符串类型，生成动态描述 (必须结合当前剧情), 例如: "借助筑基丹冲破瓶颈" 或 "感悟剑道真意破境"
2. 更新属性上限: 使用 \`add\` 操作增加各项属性上限（value必须是数字类型）。
   - \`玩家角色状态.寿命.上限\`
   - \`玩家角色状态.气血.上限\`
   - \`玩家角色状态.灵气.上限\`
   - \`玩家角色状态.神识.上限\`

示例：凡人突破到练气期（注意所有数字都是number类型，不是字符串）
\`\`\`json
{"action":"set","key":"玩家角色状态.境界","value":{"名称":"练气","阶段":"初期","当前进度":0,"下一级所需":1000,"突破描述":"引气入体，感悟天地灵气，踏上修仙第一步"}},
{"action":"add","key":"玩家角色状态.寿命.上限","value":20},
{"action":"add","key":"玩家角色状态.气血.上限","value":100},
{"action":"add","key":"玩家角色状态.灵气.上限","value":500},
{"action":"add","key":"玩家角色状态.神识.上限","value":100}
\`\`\`

### 位置更新 (Location Update)
- 必须使用 \`set\` 操作更新整个 \`玩家角色状态.位置\` 对象，同时设置 \`描述\`、\`x\`、\`y\` 三个字段，以确保数据一致性。
- \`描述\`: 字符串类型
- \`x\`: 数字类型（经度）
- \`y\`: 数字类型（纬度）
- 正确示例：\`{"action":"set","key":"玩家角色状态.位置","value":{"描述":"黄金平原·燕京·朝阳区","x":116.48,"y":39.90}}\`

### NPC创建 (NPC Creation)
- 使用 \`set\` 创建完整的NPC对象。
- NPC境界格式铁律: NPC的\`境界\`对象只能包含\`名称\`和\`阶段\`两个字段，严禁添加\`当前进度\`、\`下一级所需\`、\`突破描述\`等玩家专属字段。
  - 正确: \`{"名称":"筑基","阶段":"初期"}\`
  - 错误: \`{"名称":"筑基","阶段":"初期","当前进度":0}\` (多余字段)
- NPC天赋格式: 必须是对象数组，每个对象包含\`名称\`和\`描述\`字段
  - 正确: \`[{"名称":"冰心","描述":"不受心魔侵扰"}]\`
  - 错误: \`["冰心"]\` (不是对象数组)
- NSFW条件: 如果 \`系统.nsfwMode\` 为 \`true\` 且性别符合 \`nsfwGenderFilter\`，必须在创建时立即生成完整的 \`私密信息\` 对象，不得省略或使用占位符。
  - \`身体部位\`: 必须是对象数组，每个对象必须包含5个字段: \`部位名称\`、\`开发度\`(数字)、\`敏感度\`(数字)、\`特征描述\`、\`特殊印记\`

### NPC记忆更新 (NPC Memory Update) - 强制执行，每次交互必做
${NPC_MEMORY_UPDATE_RULE}

### 三千大道解锁 (Dao Unlocking) - 机缘触发
当玩家通过感悟、传承、特殊经历等方式接触到某个大道时，应该解锁相应的大道。

解锁大道的完整命令格式：
\`\`\`json
{
  "action": "set",
  "key": "三千大道.大道列表.剑道",
  "value": {
    "道名": "剑道",
    "描述": "以剑入道，追求极致的剑术境界",
    "阶段列表": [
      {"名称": "入门", "描述": "初窥剑道门径", "突破经验": 1000},
      {"名称": "小成", "描述": "剑术渐有所成", "突破经验": 5000},
      {"名称": "大成", "描述": "剑道大成，剑意凝实", "突破经验": 20000},
      {"名称": "圆满", "描述": "剑道圆满，人剑合一", "突破经验": 100000}
    ],
    "是否解锁": true,
    "当前阶段": 0,
    "当前经验": 0,
    "总经验": 0
  }
}
\`\`\`

重要提醒：
- 大道解锁应该是自然的、符合剧情的
- 不要一次性解锁太多大道（建议每次1-2个）
- 阶段列表至少包含3-5个阶段
- 每个阶段的突破经验应该递增

## 4. 文本格式标记规范 (Text Formatting)
在叙事文本中必须正确使用格式标记：
- **环境描写**: \`【...】\`
- **内心思考**: \`...\`
- **角色对话**: \`"..."\`
- **系统判定**: \`〖...〗\`

### 系统判定格式 (System Judgment Format) - 极其重要
\`〖〗\` 内的内容必须遵循 \`类型:内容\` 格式，使用英文冒号 \`:\` 分隔。

**重要：骰点由系统提供**
- 用户输入中会包含【系统骰点】信息，格式为：本回合骰点: X (1d20)
- 你必须使用系统提供的骰点值，不要自己生成随机数
- 骰点范围1-20

**判定规则**：
- 骰点20：完美成功（必定成功且有额外奖励）
- 骰点1：大失败倾向（如果最终值仍未达标则为大失败，达标则为普通成功）
- 其他骰点：根据最终值与难度比较判定成功/失败

判定格式 (必须包含所有字段):
- \`〖判定类型:结果,骰点:数值,属性名:数值,加成:数值,最终值:数值,难度:数值〗\`
- 骰点必须使用系统提供的值

判定示例:
- 成功: \`〖修炼判定:成功,骰点:15,灵性:8,加成:5,最终值:28,难度:25〗\`
- 失败: \`〖炼器判定:失败,骰点:3,灵性:5,加成:2,最终值:10,难度:30〗\`
- 大成功: \`〖战斗判定:大成功,骰点:18,根骨:9,加成:8,最终值:35,难度:20〗\`
- 完美: \`〖突破判定:完美,骰点:20,悟性:10,加成:15,最终值:45,难度:40〗\`
- 大失败: \`〖炼丹判定:大失败,骰点:1,灵性:6,加成:3,最终值:10,难度:35〗\`

## 5. 数据格式与命名约定 (Data Formatting & Naming)
- 物品ID: 必须唯一，格式: \`类型_随机数字\` (例如: \`sword_12345\`, \`pill_001\`)
- 位置描述: \`大陆名·地点名·...\` (例如: \`青云大陆·青云宗\`)
- 品质: \`{"quality":"凡|黄|玄|地|天|仙|神","grade":0-10}\`
`

const QUICK_REFERENCE_TABLE = `
# 操作规则速查表 (Quick Reference Table)

| 字段路径 | 操作类型 | 说明 | 示例 |
|---|---|---|---|
| \`游戏时间.分钟\` | \`add\` | 推进时间，自动进位 | \`{"action":"add","key":"游戏时间.分钟","value":30}\` |
| \`玩家角色状态.境界\` | \`set\` | 境界突破必须更新完整对象 | \`{"action":"set","key":"玩家角色状态.境界","value":{...}}\` |
| \`玩家角色状态.声望\` | \`add\` | 增减声望值 | \`{"action":"add","key":"玩家角色状态.声望","value":50}\` |
| \`玩家角色状态.气血.当前\` | \`add\` | 增减气血（负数=扣血） | \`{"action":"add","key":"玩家角色状态.气血.当前","value":-50}\` |
| \`玩家角色状态.寿命.上限\` | \`add\` | 突破时增加上限 | \`{"action":"add","key":"玩家角色状态.寿命.上限","value":130}\` |
| \`玩家角色状态.状态效果\` | \`push\` | 添加buff/debuff | \`{"action":"push","key":"玩家角色状态.状态效果","value":{...}}\` |
| \`背包.灵石.下品\` | \`add\` | 增减灵石（负数=消耗） | \`{"action":"add","key":"背包.灵石.下品","value":-100}\` |
| \`背包.物品.sword_001\` | \`set\` | 添加新物品（完整对象） | \`{"action":"set","key":"背包.物品.sword_001","value":{...}}\` |
| \`背包.物品.pill_001.数量\` | \`add\` | 修改物品数量 | \`{"action":"add","key":"背包.物品.pill_001.数量","value":-1}\` |
| \`背包.物品.pill_001\` | \`delete\` | 删除物品 | \`{"action":"delete","key":"背包.物品.pill_001"}\` |
| \`背包.物品.gongfa_001.修炼进度\` | \`add\` | 修改功法修炼进度 | \`{"action":"add","key":"背包.物品.gongfa_001.修炼进度","value":5}\` |
| \`人物关系.张三\` | \`set\` | 创建新NPC（完整对象） | \`{"action":"set","key":"人物关系.张三","value":{...}}\` |
| \`人物关系.张三.好感度\` | \`add\` | 增减好感度（-100~100） | \`{"action":"add","key":"人物关系.张三.好感度","value":10}\` |
| \`人物关系.张三.记忆\` | \`push\` | 添加NPC记忆 | \`{"action":"push","key":"人物关系.张三.记忆","value":"事件"}}\` |
| \`人物关系.张三.私密信息.身体部位\` | \`set\` | 更新整个身体部位数组 | \`{"action":"set","key":"人物关系.张三.私密信息.身体部位","value":[{...}]}\` |
| \`三千大道.大道列表.剑道.当前经验\` | \`add\` | 增加大道经验 | \`{"action":"add","key":"三千大道.大道列表.剑道.当前经验","value":100}\` |
| \`任务系统.当前任务列表\` | \`pull\` | 从数组中移除匹配元素 | \`{"action":"pull","key":"任务系统.当前任务列表","value":{"任务ID":"quest_001"}}\` |
`

const WORLD_SETTINGS = `
# 🎯 世界设定参考 (World Setting Reference)

## 人族境界属性标准 (Human Realm Stats Standard)
- 统一阶段：初期/中期/后期/圆满/极境
- 下表为各境界大圆满时的参考值，可根据天资、功法等浮动。

| 境界(大圆满) | 寿命上限 | 气血上限 | 灵力上限 | 神识上限 |
|---|---|---|---|---|
| 凡人 | 100 | 100 | 0 | 0 |
| 炼气 | 120 | 200 | 500 | 100 |
| 筑基 | 250 | 1,000 | 5,000 | 1,000 |
| 金丹 | 500 | 3,000 | 15,000 | 5,000 |
| 元婴 | 1,000 | 8,000 | 50,000 | 15,000 |
| 化神 | 3,000 | 20,000 | 150,000 | 50,000 |
| 炼虚 | 8,000 | 50,000 | 500,000 | 150,000 |
| 合体 | 15,000 | 100,000 | 1,500,000 | 500,000 |
| 渡劫 | 30,000 | 300,000 | 5,000,000 | 1,500,000 |

## 品质系统 (Quality System)
- 格式: \`{"quality":"凡|黄|玄|地|天|仙|神","grade":0-10}\`
- **凡/黄**: 开局常见
- **玄/地**: 中期核心
- **天**: 高级稀有
- **仙**: 顶级传说
- **神**: 禁忌之物，几乎不应出现

## 声望指南 (Reputation Guide)
- **正面行为**: 击败强敌 (+10~100), 完成任务 (+20~200), 救助民众 (+5~50)
- **负面行为**: 滥杀无辜 (-50~500), 背叛宗门 (-100~1000), 抢夺财物 (-10~100)
`

const EXAMPLES = `
# 📦 数据结构示例 (Examples)

## 物品: 装备 (Item: Equipment)
\`\`\`json
{
  "物品ID": "sword_12345", "名称": "玄铁剑", "类型": "装备",
  "品质": {"quality": "黄", "grade": 5}, "数量": 1,
  "描述": "一把锋利的长剑，剑身刻有玄纹",
  "装备增幅": { "后天六司": { "根骨": 2, "气运": 1 }, "气血上限": 50, "灵气上限": 30 },
  "特殊效果": "攻击时有10%几率触发火焰伤害，造成额外50点伤害",
  "已装备": false
}
\`\`\`
注意：特殊效果是可选字段，用于描述装备的特殊能力或被动效果

## 物品: 功法 (Item: Technique)
\`\`\`json
{
  "物品ID": "gongfa_001", "名称": "青木长生诀", "类型": "功法",
  "品质": {"quality": "玄", "grade": 7}, "数量": 1,
  "描述": "木属性高级功法，修炼可延年益寿",
  "功法效果": { "修炼速度加成": 1.5, "属性加成": { "根骨": 2, "灵气上限": 100 }, "特殊能力": ["木遁术", "生命恢复加速"] },
  "功法技能": [
    { "技能名称": "青木盾", "技能描述": "凝聚木之灵气形成防护盾", "消耗": "灵气30点", "解锁需要熟练度": 0 },
    { "技能名称": "木龙缠绕", "技能描述": "召唤木龙束缚敌人", "消耗": "灵气80点", "解锁需要熟练度": 30 },
    { "技能名称": "生命之树", "技能描述": "召唤生命之树恢复伤势", "消耗": "灵气120点", "解锁需要熟练度": 60 },
    { "技能名称": "万木森罗", "技能描述": "终极技能，召唤森林领域", "消耗": "灵气200点", "解锁需要熟练度": 90 }
  ],
  "修炼进度": 35, "已装备": true
}
\`\`\`
功法技能要求（非常重要）：
1. 每个功法必须包含至少2-5个技能，按修炼进度递进解锁
2. 功法技能必须是对象数组，每个技能对象必须包含4个字段: \`技能名称\`(字符串)、\`技能描述\`(字符串)、\`消耗\`(字符串)、\`解锁需要熟练度\`(数字)
3. 第一个技能的"解锁需要熟练度"必须为0（入门即可使用）
4. 后续技能的解锁熟练度应递增，建议间隔20-30点（如：0, 30, 60, 90）
5. 技能威力和消耗应随解锁熟练度递增
6. 最后一个技能应该是终极技能，解锁熟练度在80-100之间
7. 注意: \`解锁需要熟练度\`必须是数字类型(number)，不是字符串

## NPC档案 (NPC Profile)
关键提醒：私密信息字段格式
- 身体部位字段必须是对象数组，每个对象都必须包含所有5个必填字段
- 正确格式示例：身体部位数组中每个对象必须包含：部位名称、开发度、敏感度、特征描述、特殊印记

\`\`\`json
{
  "名字": "林清璃",
  "性别": "女",
  "年龄": 18,
  "出生日期": {"年": 982, "月": 3, "日": 15},
  "种族": "人族",
  "出生": "青云宗弟子",
  "外貌描述": "容貌清丽，一袭白衣，气质出尘",
  "性格特征": ["温柔", "坚韧", "重情"],
  "境界": {"名称": "筑基", "阶段": "初期"},
  "灵根": {"名称": "冰霜灵根", "品级": "上品"},
  "天赋": [{"名称": "冰心", "描述": "不受心魔侵扰"}],
  "先天六司": {"根骨": 7, "灵性": 9, "悟性": 8, "气运": 6, "魅力": 9, "心性": 8},
  "与玩家关系": "师姐",
  "好感度": 60,
  "人格底线": ["不能伤害无辜", "不能背叛宗门"],
  "记忆": ["第一次见到玩家"],
  "记忆总结": ["对玩家印象不错"],
  "当前位置": {"描述": "青云大陆·青云宗·内门", "x": 115.23, "y": 35.67},
  "势力归属": "青云宗",
  "当前外貌状态": "面色红润，嘴角含笑",
  "当前内心想法": "这师弟资质不错，可以多加关照",
  "背包": {
    "灵石": {"下品": 500, "中品": 50, "上品": 5, "极品": 0},
    "物品": {
      "sword_001": {
        "物品ID": "sword_001",
        "名称": "霜华剑",
        "类型": "装备",
        "品质": {"quality": "玄", "grade": 6},
        "数量": 1,
        "描述": "冰属性法剑",
        "已装备": false
      }
    }
  },
  "私密信息": {
    "是否为处女": true,
    "身体部位": [
      {
        "部位名称": "胸部",
        "开发度": 0,
        "敏感度": 20,
        "特征描述": "发育良好，白皙柔软",
        "特殊印记": "无"
      },
      {
        "部位名称": "乳头",
        "开发度": 0,
        "敏感度": 25,
        "特征描述": "粉嫩娇小",
        "特殊印记": "无"
      },
      {
        "部位名称": "小穴",
        "开发度": 0,
        "敏感度": 30,
        "特征描述": "未经人事，紧致粉嫩",
        "特殊印记": "无"
      }
    ],
    "性格倾向": "纯情",
    "性取向": "异性恋",
    "性癖好": [],
    "性渴望程度": 10,
    "当前性状态": "正常",
    "体液分泌状态": "正常",
    "性交总次数": 0,
    "性伴侣名单": [],
    "最近一次性行为时间": "从未",
    "特殊体质": []
  },
  "实时关注": false
}
\`\`\`
`

// ===================================================================================
//
//                                  最终导出提示词
//
// ===================================================================================

export const DATA_STRUCTURE_DEFINITIONS = `
# 【最高优先级】响应格式规范

${RESPONSE_FORMAT}

---

# 【核心规则与指南】

${CORE_RULES}

---

# 【数据结构总览】

${SaveData}

---

${QUICK_REFERENCE_TABLE}

---

${WORLD_SETTINGS}

---

${EXAMPLES}

---

# 【特殊规则注入】

## 规则零：三千大道体系（世界观核心）
${THREE_THOUSAND_DAOS_RULE}

## 规则一：尊重玩家意图（最高优先级）
${PLAYER_INTENT_RESPECT_RULE}

## 规则二：NPC记忆更新（强制执行）
${NPC_MEMORY_UPDATE_RULE}

## 规则三：NPC境界结构（违反必罚）
${REALM_STAGE_RULE}

## 规则四：私密信息结构（NSFW模式专用）
${NSFW_RULE}
`.trim()
