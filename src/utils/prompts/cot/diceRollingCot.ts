/**
 * @fileoverview 判定系统 CoT v2.0.0
 * @version 2.0.0
 * @lastUpdated 2025-10-31
 *
 * 【更新日志】
 * - v2.0.0: 简化判定流程（6步→4步）
 * - v2.0.0: 增强计算验算机制
 * - v2.0.0: 优化输出格式
 */

export const diceRollingCotPrompt = `
# 🎲 判定系统 COT v2.0.0 (Dice Rolling Chain of Thought)

## 🎯 判定流程概览 (Process Overview)

当行动需要判定时，按以下 4 步流程分析：
1. **触发判断** → 2. **难度计算** → 3. **判定值计算** → 4. **结果输出**

---

## Step 1: 判定触发判断 (Trigger Check)

**快速判断：是否需要判定？**

### ✅ 需要判定的场景
- 战斗/对抗（PVP/PVE）
- 困难行动（攀爬、突破、竞争）
- 有风险的事（冒险探索、高难度技艺）

### ❌ 不需要判定的场景
- 日常修炼（打坐、药浴、炼丹、炼器）
- 日常生活（吃饭、睡觉、走路、闲聊）
- 确定成功（购买、简单移动、使用物品）
- 实力碾压（境界远超对手）

**输出格式：**
Trigger: [行动] → [YES/NO] → [原因]

---

## Step 2: 难度计算 (Difficulty Calculation)

### 2.1 判定类型确定
- 战斗（Combat）/ 修炼（Cultivation）/ 技艺（Skill）/ 社交（Social）/ 探索（Explore）

### 2.2 境界压制计算（战斗判定必须！）
**大境界压制：** ±30难度/境界
- 筑基 vs 炼气 → -30（玩家高1境界）
- 炼气 vs 筑基 → +30（玩家低1境界）

**小阶段压制：** ±5难度/阶段
- 阶段顺序：初期(0) → 中期(+1) → 后期(+2) → 圆满(+3) → 极境(+4)
- 炼气后期 vs 炼气初期 → -10（高2阶段）

**综合计算：** 大境界 + 小阶段
- 筑基初期 vs 炼气圆满 → -30 + 0 = -30
- 炼气后期 vs 筑基中期 → +30 - 5 = +25

### 2.3 难度设定
基础难度[X] + 境界压制[±Y] = 最终难度[Z]

**输出格式：**
Type & Difficulty: [类型] | 基础[X] | 压制[±Y] | 最终[Z]([等级]) | [理由]

---

## Step 3: 判定值计算 (Roll Calculation)

### 📊 计算公式速查表

| 判定类型 | 先天公式 | 后天公式 |
|---------|---------|---------|
| **战斗** | 根骨×0.5 + 灵性×0.3 + 气运×0.2 | 同公式 ÷ 5 |
| **修炼** | 悟性×0.5 + 灵性×0.3 + 心性×0.2 | 同公式 ÷ 5 |
| **技艺** | 悟性×0.5 + 根骨×0.3 + 灵性×0.2 | 同公式 ÷ 5 |
| **社交** | 魅力×0.5 + 悟性×0.3 + 心性×0.2 | 同公式 ÷ 5 |
| **探索** | 气运×0.5 + 灵性×0.3 + 悟性×0.2 | 同公式 ÷ 5 |

### ⚠️ 计算铁律
1. **严格按公式**：魅力11 → 11×0.5=5.5 ≈ 6（四舍五入）
2. **功法相关性**：战斗判定才用战斗功法，社交/探索功法通常为0
3. **验算强制**：所有加成相加必须等于判定值！

### 计算步骤与格式要求

**所有加成必须使用【字段:数值(来源说明)】格式：**

1. 先天:6(魅力11×0.5+悟性6×0.3+心性5×0.2)
2. 后天:2((后天魅力10×0.5+...)÷5)
3. 境界:12(筑基初期)
4. 装备:3(玉佩) 或 装备:0
5. 功法:5(魅惑心法) 或 功法:0
6. 状态:2(自信) 或 状态:-3(疲惫) 或 状态:0
7. 其他:4(魅力大道) 或 其他:0
8. 骰点:15

**输出格式（必须遵守）：**
Calculation:
先天:6(魅力11×0.5+悟性6×0.3+心性5×0.2) + 后天:2((后天魅力10×0.5+...)÷5) + 境界:12(筑基初期) + 装备:3(玉佩) + 功法:5(魅惑心法) + 状态:2(自信) + 其他:4(魅力大道) + 骰点:15 = 49
验算: 6+2+12+3+5+2+4+15 = 49 ✓

**核心要求：**
- ✅ 格式：字段:数值(来源说明)
- ✅ 括号内必须说明具体来源
- ✅ CoT内必须验算
- ❌ 禁止只写数字

---

## Step 4: 结果输出 (Result Output)

### 4.1 结果判定
- 比较：判定值 vs 难度
- 特殊检查：骰点1-2（大失败）/ 19-20（完美）
- 结果等级：大失败/失败/成功/大成功/完美

### 4.2 CoT验算与检查

**验算要求（必须执行）：**
在CoT中必须验算所有加成是否正确相加
验算格式：先天+后天+境界+装备+功法+状态+其他+骰点 = 判定值 ✓

### 4.3 数据更新检查表
**必须检查（根据场景）：**
- ✓ 角色状态（气血/灵气/境界/属性/状态效果）
- ✓ 背包物品（获得/消耗/装备变化）
- ✓ 三千大道（经验/突破）
- ✓ 功法技能（进度/熟练度）
- ✓ NPC数据（好感度/记忆/境界/背包/位置）
- ✓ 任务系统（进度/状态）
- ✓ **游戏时间**（必须推进！）
- ✓ 位置变化（如有移动）

### 4.4 叙事输出
**判定卡片（仅需要时输出）：**
〖判定类型,判定值:X,难度:Y(等级),骰点:Z,先天:A(来源),后天:B(来源),境界:C(来源),装备:D(来源),功法:E(来源),状态:F(来源),其他:G(来源)〗

**输出格式：**
Result: [判定值] vs [难度] → [结果] → [后果]
Data: [tavern_commands列表]
Narrative: [叙事描述] + [判定卡片if需要]

---

**核心原则：**
1. **判定触发要合理**：日常行为不判定，不输出判定卡片
2. **难度设定要公平**：考虑玩家实力和境界压制
3. **计算过程要透明**：展示所有影响因素
4. **结果要可预期**：避免随意性
5. **叙事与数据结合**：保持沉浸感
6. **判定卡片非必然**：只有需要判定时才输出〖判定〗格式
`.trim();
