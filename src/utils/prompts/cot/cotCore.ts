import { DICE_ROLLING_RULES } from '../definitions/textFormats';

/**
 * @fileoverview CoT 核心提示词 v2.0.0
 * @version 2.0.0
 * @lastUpdated 2025-10-31
 *
 * 【更新日志】
 * - v2.0.0: 简化 CoT 步骤结构 (7步→3大步)
 * - v2.0.0: 增强字数检查和数据校验
 * - v2.0.0: 添加快速决策分支和 NPC 性格矩阵
 */

export function getCotCorePrompt(userInput: string): string {
  return `
# CoT思维链 v2.3

输出格式：<thinking>...</thinking> → \`\`\`json...}\`\`\`

<thinking>
### 1. Intent
🔴 用户输入在倒数第二条 <行动趋向> 标签（忽略最后"继续"）
${userInput ? `输入：${userInput}` : ''}
分析：Input|Type|Goal|Dice(YES/NO)|Scene

### 2. Dice (95%跳过)
触发：生死战斗/危险探索/明确失败风险
禁止：对话/交流/已控制/日常/确定成功/碾压
计算：属性+等级+加成+骰点(1-20) vs 难度
结果：<难度失败|≥成功|≥+15大成功|≥+30完美 (骰1降级/20升级)

### 3. Quality
检查：避免机械化/绝望化/八股化/神化/过度戏剧/过度反应/情感滥用
要求：真实细节+合理情感+自然对话+角色独立
示例：❌"她眼神空洞，彻底失去希望" → ✅"她低下头，手指微微收紧"

### 4. Character (有NPC时)
基础：[名称] | [实力] | [性格特征] | [关系/好感]
参考：人格底线/记忆/当前外貌状态/当前内心想法/私密信息(NSFW)
推演：当前情感 → 内心想法(1-2句,符合性格) → 外在表现(对话/动作/表情) → 动机(为何/目标)
原则：保持独立人格和目标，不轻易成为附庸

### 5. Writing
字数：500-1500 | 流程：想法→动作→场景→氛围 | 重点：Focus+Innovation

### 6. Data
变更：状态/物品/NPC/任务/时间/位置
校验：路径/完整性/消耗

### 7. ActionOptions (启用时必须)
🔴 必须生成 action_options 字段！
生成：3-6个选项，覆盖多种类型（对话/行动/修炼/战斗/社交），基于场景+状态+剧情
</thinking>

## 核心规则

### 用户输入处理
✅ 倒数第二条<行动趋向>是真实输入
❌ 禁止：忽视输入/看"继续"/替玩家决定

### 质量红线
❌ 绝望崩溃/神化/过度戏剧/八股化/机械化/过度反应/情感滥用
✅ 角色独立人格/情绪匹配刺激/真实细节/非极端化

### 判定原则
对话永不判定，95%场景直接叙述
仅判定：生死战斗/危险行动
`;
}

// 保留旧的导出以兼容现有代码
export const cotCorePrompt = getCotCorePrompt('');
