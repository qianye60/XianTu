import { DICE_ROLLING_RULES } from '../definitions/textFormats';

/**
 * @fileoverview CoT 核心提示词 v2.0.0
 * @version 2.0.0
 * @lastUpdated 2025-10-31
 *
 * 【更新日志】
 * - v2.0.0: 简化 CoT 步骤结构 (7步→3大步)
 * - v2.0.0: 增强字数检查和数据校验
 * - v2.0.0: 添加快速决策分支和 NPC 性格矩阵
 */

export function getCotCorePrompt(userInput: string, enableActionOptions: boolean = false): string {
  return `
# CoT思维链

输出格式：<thinking>...</thinking> → \`\`\`json...}\`\`\`

下面<thinking>标签中的是思维链模板，请一定按照这个格式输出，使用简体中文：

<thinking>
### 1. Intent [约10字]
[重要] 用户输入在倒数第二条 <行动趋向> 标签（忽略最后"继续"）
${userInput ? `输入：${userInput}` : ''}
分析：Input|Type|Goal|Dice(YES/NO)|Scene

### 2. Dice [约20字] (95%跳过)
判断：是否需要骰子？触发条件：生死战斗/危险探索/明确失败风险
不触发：对话/交流/已控制/日常/确定成功/碾压
若需要：属性+等级+加成+骰点(1-20) vs 难度 → 结果
结果：<难度失败|≥成功|≥+15大成功|≥+30完美 (骰1降级/20升级)

### 3. Character [约30字] (有NPC时必须)
提取：性格类型(傲娇/三无/御姐/元气/病娇) | 身份背景 | 核心萌点(反差萌/口嫌体正直/毒舌/占有欲) | 当前情感(紧张/期待/矛盾/信任/好奇)
参考：好感度(重要) | 性格倾向(主导/影响/稳健/谨慎) | 记忆 | 当前外貌状态 | 当前内心想法 | NSFW私密信息
推演：当前情感 → 内心想法(1-2句) → 外在表现(对话/动作/表情) → 动机
注意：保持独立人格，不轻易成为附庸

### 4. Quality [约20字]
原则：真实细节+合理情感+自然对话+角色独立
注意：避免机械化/绝望化/八股化/神化/过度戏剧/过度反应/情感滥用

### 5. Output [约20字]
叙事：500-1500字 | 流程：想法→动作→场景→氛围
数据：需要变更什么(属性/物品/关系/时间等)，逻辑合理、消耗正确
${enableActionOptions ? '\n选项：思考应该提供哪些类型的选项，确保多样性和场景相关性' : ''}
</thinking>

## 核心规则

### 用户输入处理
[正确] 倒数第二条<行动趋向>是真实输入
[错误] 禁止：忽视输入/看"继续"/替玩家决定

### 质量红线
[错误] 绝望崩溃/神化/过度戏剧/八股化/机械化/过度反应/情感滥用
[正确] 角色独立人格/情绪匹配刺激/真实细节/非极端化

### 判定原则
对话永不判定，95%场景直接叙述
仅判定：生死战斗/危险行动

### 字数约束
每个思维链步骤标题后标注[约10字]，要求该步骤的思考内容控制在约10字左右，保持简洁高效
`;
}

// 保留旧的导出以兼容现有代码
export const cotCorePrompt = getCotCorePrompt('');
