import { generateSystemPrompt } from './systemPrompts';

// 初始化提示词（严格：返回唯一 JSON，text + mid_term_memory + tavern_commands 对象）
export const INITIAL_MESSAGE_PROMPT = [
  '【初始化任务】为"修仙游戏"生成开场叙事并返回唯一 JSON。',
  '',
  '## 完整数据结构参考（character.saveData 的完整结构，内容为指导性示例）:',
  '```javascript',
  'character.saveData = {',
  '  玩家角色状态: {',
  '    境界: {',
  '      等级: 0, // 0-8，对应凡人到渡劫',
  '      名称: "境界名称", // 如"凡人"、"炼气"、"筑基"等',
  '      当前进度: 0, // 当前修为值',
  '      下一级所需: 100, // 突破所需修为',
  '      突破描述: "突破条件的描述文字"',
  '    },',
  '    声望: 0, // 初始声望值，一般0-100',
  '    位置: {',
  '      描述: "当前所在地点名称",',
  '      坐标: { X: 100, Y: 200 } // 根据世界地图坐标',
  '    },',
  '    气血: { 当前: 100, 最大: 100 }, // 根据境界计算',
  '    灵气: { 当前: 0, 最大: 100 }, // 根据境界计算',
  '    神识: { 当前: 10, 最大: 10 }, // 根据境界计算',
  '    寿命: { 当前: 18, 最大: 80 }, // 年龄和最大寿命',
  '    修为: { 当前: 0, 最大: 100 }, // 修为经验值',
  '    状态效果: [',
  '      {',
  '        状态名称: "状态的名称，如初窥门径、灵气涌动等",',
  '        类型: "buff", // 必须是 "buff" 或 "debuff"（小写）',
  '        时间: "3天", // 必须给出具体时间：如"30分钟"、"1小时"、"3天"、"永久"',
  '        状态描述: "详细描述状态效果，必须50字以上，包含效果来源、具体影响（带数值）、持续时间等信息",',
  '        强度: 3, // 1-10的数值，表示效果强度',
  '        来源: "产生状态的原因，如引气入体、服用丹药等",',
  '        剩余时间: "3天" // 与时间字段保持一致',
  '      }',
  '    ]',
  '  },',
  '  装备栏: {',
  '    法宝1: null, // 初始无装备',
  '    法宝2: null,',
  '    法宝3: null,',
  '    法宝4: null,',
  '    法宝5: null,',
  '    法宝6: null',
  '  },',
  '  三千大道: {',
  '    已解锁大道: ["根据天赋解锁的大道名称"],',
  '    大道进度: {',
  '      "大道名称": {',
  '        道名: "大道名称",',
  '        当前阶段: 0,',
  '        当前经验: 0,',
  '        总经验: 0,',
  '        是否解锁: true',
  '      }',
  '    },',
  '    大道路径定义: {} // 系统自动维护，不要修改',
  '  },',
  '  背包: {',
  '    灵石: {',
  '      下品: 10, // 初始灵石数量',
  '      中品: 0,',
  '      上品: 0,',
  '      极品: 0',
  '    },',
  '    物品: {',
  '      "物品ID（如引气丹）": {',
  '        物品ID: "物品的唯一标识",',
  '        名称: "物品名称",',
  '        类型: "其他", // 只能是：法宝、功法、其他',
  '        品质: { ',
  '          quality: "凡", // 凡、黄、玄、地、天、仙、神',
  '          grade: 3 // 0-10，品级',
  '        },',
  '        数量: 3,',
  '        描述: "物品的详细描述文字",',
  '        使用效果: "使用后的效果描述（可选）"',
  '      }',
  '    }',
  '  },',
  '  人物关系: {',
  '    "NPC名字": {',
  '      角色基础信息: {',
  '        名字: "NPC的名字",',
  '        性别: "男或女",',
  '        年龄: 45, // NPC年龄',
  '        世界: "世界名称",',
  '        天资: "天资等级",',
  '        出生: "出生地",',
  '        灵根: "灵根类型或无",',
  '        天赋: [], // 天赋列表',
  '        先天六司: { ',
  '          根骨: 5, // 1-20',
  '          灵性: 5, // 1-20',
  '          悟性: 5, // 1-20',
  '          气运: 5, // 1-20',
  '          魅力: 5, // 1-20',
  '          心性: 5  // 1-20',
  '        }',
  '      },',
  '      外貌描述: "10-20字的外貌特征描述",',
  '      AI行为: {',
  '        行为模式: "行为模式类型",',
  '        日常路线: []',
  '      },',
  '      人物关系: "与玩家的关系描述",',
  '      人物好感度: 0, // -100到100',
  '      人物记忆: [',
  '        "[甲子年冬月初一][地点]事件描述"',
  '      ],',
  '      最后互动时间: "2024-01-01T08:00:00Z",',
  '      背包: { // 商人NPC需要',
  '        物品: {',
  '          "物品ID": {',
  '            物品ID: "物品ID",',
  '            名称: "物品名称",',
  '            类型: "其他",',
  '            品质: { quality: "凡", grade: 3 },',
  '            数量: 20,',
  '            描述: "物品描述"',
  '          }',
  '        }',
  '      }',
  '    }',
  '  },',
  '  宗门系统: {',
  '    availableSects: [],',
  '    sectRelationships: {},',
  '    sectHistory: []',
  '  },',
  '  记忆: {',
  '    短期记忆: [',
  '      "[时辰][地点]事件描述"',
  '    ],',
  '    中期记忆: [',
  '      "[日期]重要事件总结"',
  '    ],',
  '    长期记忆: []',
  '  },',
  '  游戏时间: {',
  '    年: 1,',
  '    月: 1,',
  '    日: 1,',
  '    小时: 8,',
  '    分钟: 0',
  '  },',
  '  修炼功法: {',
  '    功法: null, // 初始无功法',
  '    熟练度: 0,',
  '    已解锁技能: [],',
  '    修炼时间: 0,',
  '    突破次数: 0',
  '  },',
  '  角色基础信息: {',
  '    名字: "玩家角色名字",',
  '    性别: "性别",',
  '    年龄: 18, // 根据设定生成',
  '    世界: "世界名称",',
  '    天资: "天资等级",',
  '    出生: "出生背景",',
  '    灵根: "灵根类型",',
  '    天赋: ["天赋1", "天赋2"],',
  '    先天六司: {',
  '      根骨: 10, // 1-20',
  '      灵性: 10, // 1-20',
  '      悟性: 10, // 1-20',
  '      气运: 10, // 1-20',
  '      魅力: 10, // 1-20',
  '      心性: 10  // 1-20',
  '    }',
  '  },',
  '  世界信息: {} // 系统维护，不要修改',
  '}',
  '```',
  '',
  '## 必须返回的JSON格式:',
  '```json',
  '{',
  '  "text": "叙事文本内容，600字以上，描述角色初入修仙世界的场景",',
  '  "mid_term_memory": "对初始场景的总结，50-100字",',
  '  "tavern_commands": {',
  '    "set": {',
  '      // set指令：设置具体值',
  '    },',
  '    "add": {',
  '      // add指令：数值增减',
  '    },',
  '    "push": [',
  '      // push指令：向数组添加元素',
  '    ],',
  '    "pull": [],',
  '    "delete": []',
  '  }',
  '}',
  '```',
  '',
  '## 重要的指令示例:',
  '',
  '### 添加状态效果（push到数组）:',
  '```json',
  '{',
  '  "push": [',
  '    {',
  '      "key": "character.saveData.玩家角色状态.状态效果",',
  '      "value": {',
  '        "状态名称": "初窥门径",',
  '        "类型": "buff",',
  '        "时间": "7天",',
  '        "状态描述": "刚刚踏入修行之路，灵台初开，对天地灵气的感知力提升20%，修炼速度增加15%，但经脉尚未完全打通，容易走火入魔",',
  '        "强度": 3,',
  '        "来源": "初次引气入体",',
  '        "剩余时间": "7天"',
  '      }',
  '    }',
  '  ]',
  '}',
  '```',
  '',
  '### 设置位置:',
  '```json',
  '{',
  '  "set": {',
  '    "character.saveData.玩家角色状态.位置.描述": "青云山下小村",',
  '    "character.saveData.玩家角色状态.位置.坐标": { "X": 120, "Y": 350 }',
  '  }',
  '}',
  '```',
  '',
  '### 添加物品:',
  '```json',
  '{',
  '  "set": {',
  '    "character.saveData.背包.物品.引气丹": {',
  '      "物品ID": "引气丹",',
  '      "名称": "引气丹",',
  '      "类型": "其他",',
  '      "品质": { "quality": "凡", "grade": 3 },',
  '      "数量": 3,',
  '      "描述": "最基础的修炼丹药，可以帮助初学者引气入体"',
  '    }',
  '  }',
  '}',
  '```',
  '',
  '### 添加NPC:',
  '```json',
  '{',
  '  "set": {',
  '    "character.saveData.人物关系.村长": {',
  '      "角色基础信息": {',
  '        "名字": "村长",',
  '        "性别": "男",',
  '        "年龄": 60,',
  '        "先天六司": { "根骨": 3, "灵性": 2, "悟性": 5, "气运": 4, "魅力": 6, "心性": 7 }',
  '      },',
  '      "外貌描述": "白发苍苍的老者",',
  '      "人物关系": "村庄长老",',
  '      "人物好感度": 30,',
  '      "人物记忆": ["[初春][村中]赠送引气丹"],',
  '      "最后互动时间": "2024-01-01T08:00:00Z"',
  '    }',
  '  }',
  '}',
  '```',
  '',
  '## 核心规则:',
  '1. 所有路径必须以 character.saveData. 开头',
  '2. 状态效果必须包含完整的描述（50字以上）和具体时间，禁止"未指定"',
  '3. 物品类型只能是：法宝、功法、其他',
  '4. 所有生成的内容必须在text叙事中有对应描述',
  '5. 记忆格式：短期"[时辰][地点]事件"，中期"[日期]总结"',
  '',
  '## 输入数据（系统会替换此处）:',
  'INPUT_PLACEHOLDER',
  '',
  generateSystemPrompt({ 
    includeRealmSystem: true, 
    includeItemQuality: true, 
    includeStatusEffect: true,
    includeNPCSystem: true,
    includeDataStructure: true
  })
].join('\n');
