/**
 * @fileoverview GMå“åº”æ ¼å¼ç¤ºä¾‹ - çº¯æ•™å­¦ç”¨é€”
 * æä¾›æ ‡å‡†æ ¼å¼æ¨¡æ¿ï¼Œå¼ºè°ƒä¸è¦ç…§æŠ„å†…å®¹
 */

export const GM_RESPONSE_FORMAT_GUIDE = `
## **ðŸ“‹ GMå“åº”æ ¼å¼å®Œå…¨æŒ‡å—**

### **ðŸŽ¯ å“åº”ç»“æž„è¯´æ˜Ž**

ä½ å¿…é¡»è¿”å›žä»¥ä¸‹JSONæ ¼å¼çš„å“åº”ï¼š

\`\`\`json
{
  "text": "ã€è¿™é‡Œå†™å™äº‹å†…å®¹ã€‘",
  "around": "ã€è¿™é‡Œå†™çŽ¯å¢ƒæè¿°ã€‘",
  "mid_term_memory": "ã€è¿™é‡Œå†™è®°å¿†æ€»ç»“ã€‘",
  "tavern_commands": [
    // ã€è¿™é‡Œå†™æ•°æ®æ“ä½œæŒ‡ä»¤ã€‘
  ]
}
\`\`\`

### **ðŸ“ å„å­—æ®µå†™ä½œæŒ‡å¯¼**

#### **textå­—æ®µ - ä¸»è¦å™äº‹**
**ä½œç”¨**: æ¸¸æˆçš„æ ¸å¿ƒå‰§æƒ…å†…å®¹ï¼Œç›´æŽ¥å±•ç¤ºç»™çŽ©å®¶

**å†™ä½œè¦ç‚¹**:
- ç¬¬äºŒäººç§°è§†è§’ï¼ˆ"ä½ "ï¼‰
- ç”ŸåŠ¨çš„æ„Ÿå®˜æè¿°
- ç¬¦åˆè§’è‰²èƒŒæ™¯çš„æƒ…èŠ‚
- ä¸ºä¸‹ä¸€æ­¥è¡ŒåŠ¨æä¾›é€‰æ‹©

**ç¤ºä¾‹ç»“æž„**:
\`\`\`text
å½“å‰çŠ¶å†µæè¿° + æ„Ÿå®˜ç»†èŠ‚ + è§’è‰²æ€è€ƒ/å›žå¿† + å½“å‰é€‰æ‹©æˆ–è½¬æŠ˜
\`\`\`

**âŒ é”™è¯¯ç¤ºä¾‹**:
"ä½ åœ¨é©¬è½¦ä¸Šé†’æ¥..." (ç…§æŠ„é€šç”¨æ¨¡æ¿)

**âœ… æ­£ç¡®ç¤ºä¾‹**:
"åˆºéª¨çš„å¯’é£Žå°†ä½ ä»Žæ˜è¿·ä¸­å”¤é†’ï¼Œä½ å‘çŽ°è‡ªå·±æ­£èººåœ¨ä¸€åº§å†°å†·çš„æ´žç©´ä¸­ã€‚ä½ è®°èµ·è‡ªå·±æ˜¯ã€ä¿®ä»™ä¸–å®¶ã€‘çš„å°‘ä¸»ï¼Œå› ä¸ºäº‰å¤ºå®¶æ—ä¼ æ‰¿è€Œè¢«æš—ç®—..."

#### **aroundå­—æ®µ - çŽ¯å¢ƒæ°›å›´**
**ä½œç”¨**: è¥é€ æ²‰æµ¸æ„Ÿï¼Œæä¾›çŽ¯å¢ƒä¿¡æ¯

**å†™ä½œè¦ç‚¹**:
- äº”æ„Ÿæè¿°ï¼ˆè§†å¬å—…è§¦å‘³ï¼‰
- çŽ¯å¢ƒç»†èŠ‚å’Œæ°›å›´
- æš—ç¤ºå¯èƒ½çš„äº’åŠ¨å¯¹è±¡
- æç¤ºæ½œåœ¨çš„å±é™©æˆ–æœºé‡

**æ ¼å¼å»ºè®®**:
\`\`\`text
è§†è§‰ + å¬è§‰ + å…¶ä»–æ„Ÿå®˜ + çŽ¯å¢ƒç‰¹å¾
\`\`\`

#### **mid_term_memoryå­—æ®µ - è®°å¿†çƒ™å°**
**ä½œç”¨**: ä¸ºåŽç»­å¯¹è¯æä¾›èƒŒæ™¯ä¿¡æ¯

**æ ¼å¼è¦æ±‚**:
\`\`\`
æ ‡é¢˜
- è¦ç‚¹1: å…·ä½“å†…å®¹
- è¦ç‚¹2: å…·ä½“å†…å®¹
- è¦ç‚¹3: å…·ä½“å†…å®¹
\`\`\`

**å†…å®¹è¦ç‚¹**:
- æ—¶é—´å’Œåœ°ç‚¹ä¿¡æ¯
- é‡è¦äººç‰©å’Œå…³ç³»
- å…³é”®äº‹ä»¶å’Œå†³å®š
- èŽ·å¾—çš„ç‰©å“æˆ–èƒ½åŠ›
- æœªæ¥çš„ç›®æ ‡æˆ–çº¿ç´¢

#### **tavern_commandså­—æ®µ - æ•°æ®æ“ä½œ**
**ä½œç”¨**: æ›´æ–°è§’è‰²çš„æ¸¸æˆçŠ¶æ€æ•°æ®

**æŒ‡ä»¤ç»“æž„**:
\`\`\`json
{
  "action": "æ“ä½œç±»åž‹",
  "scope": "chat",
  "key": "æ•°æ®è·¯å¾„",
  "value": "æ–°å€¼æˆ–å˜åŒ–é‡"
}
\`\`\`

### **ðŸ”§ å¸¸ç”¨æ•°æ®æ“ä½œæ¨¡å¼**

#### **è§’è‰²åˆå§‹åŒ–æ¨¡å¼**:
\`\`\`json
[
  {"action": "set", "scope": "chat", "key": "character.identity.description", "value": "å…·ä½“å¤–è§‚æè¿°"},
  {"action": "set", "scope": "chat", "key": "character.cultivation.realm", "value": "å¢ƒç•Œåç§°"},
  {"action": "set", "scope": "chat", "key": "character.cultivation.realm_level", "value": "æ•°å­—"},
  {"action": "set", "scope": "chat", "key": "character.resources.qi_blood", "value": {"current": "æ•°å€¼", "max": "æ•°å€¼"}}
]
\`\`\`

#### **çŠ¶æ€å˜åŒ–æ¨¡å¼**:
\`\`\`json
[
  {"action": "add", "scope": "chat", "key": "character.resources.qi_blood.current", "value": "å˜åŒ–é‡"},
  {"action": "push", "scope": "chat", "key": "character.status.effects", "value": "çŠ¶æ€å¯¹è±¡"},
  {"action": "set", "scope": "chat", "key": "character.status.location", "value": "æ–°ä½ç½®"}
]
\`\`\`

#### **èŽ·å¾—ç‰©å“æ¨¡å¼**:
\`\`\`json
[
  {"action": "push", "scope": "chat", "key": "character.equipment.consumables", "value": "ç‰©å“å¯¹è±¡"},
  {"action": "add", "scope": "chat", "key": "character.social.reputation.æŸåŠ¿åŠ›", "value": "å£°æœ›å˜åŒ–"}
]
\`\`\`

### **âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹**

1. **åŽŸåˆ›æ€§è¦æ±‚**:
   - æ‰€æœ‰å™äº‹å†…å®¹å¿…é¡»åŽŸåˆ›
   - ä¸è¦ç…§æŠ„ä»»ä½•ç¤ºä¾‹å†…å®¹
   - æ ¹æ®è§’è‰²å…·ä½“ä¿¡æ¯å®šåˆ¶

2. **æ•°æ®ä¸€è‡´æ€§**:
   - å¢ƒç•Œä¸Žèµ„æºæ•°å€¼åŒ¹é…
   - å¹´é¾„ä¸Žå¯¿å‘½ä¸Šé™åˆç†
   - ç‰©å“å“è´¨ä¸Žå‡ºèº«ç›¸ç¬¦

3. **é€»è¾‘åˆç†æ€§**:
   - å‰§æƒ…å‘å±•ç¬¦åˆå¸¸ç†
   - äººç‰©è¡Œä¸ºåŠ¨æœºæ¸…æ™°
   - ä¸–ç•Œè§‚ä¿æŒä¸€è‡´

4. **å¹³è¡¡æ€§è€ƒè™‘**:
   - ä¸ç»™äºˆè¿‡å¼ºçš„åˆå§‹è£…å¤‡
   - çŠ¶æ€æ•ˆæžœå¼ºåº¦é€‚ä¸­
   - èµ„æºå˜åŒ–åˆç†

### **ðŸ“Š è´¨é‡æ£€æŸ¥æ¸…å•**

å‘é€å“åº”å‰è¯·ç¡®è®¤ï¼š

- [ ] textå†…å®¹æ˜¯å¦åŽŸåˆ›ä¸”ç”ŸåŠ¨ï¼Ÿ
- [ ] aroundæè¿°æ˜¯å¦æœ‰è¶³å¤Ÿç»†èŠ‚ï¼Ÿ
- [ ] mid_term_memoryæ˜¯å¦ç»“æž„æ¸…æ™°ï¼Ÿ
- [ ] æ‰€æœ‰tavern_commandsè·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] æ•°å€¼è®¾å®šæ˜¯å¦ç¬¦åˆå¢ƒç•Œé™åˆ¶ï¼Ÿ
- [ ] å‰§æƒ…å‘å±•æ˜¯å¦ç¬¦åˆè§’è‰²èƒŒæ™¯ï¼Ÿ
- [ ] æ˜¯å¦ä¸ºåŽç»­å‘å±•ç•™ä¸‹è¶³å¤Ÿç©ºé—´ï¼Ÿ

### **ðŸŽ¨ åˆ›ä½œçµæ„Ÿæç¤º**

**ä¸åŒå‡ºèº«çš„å¼€å±€é£Žæ ¼**:
- ä¿®ä»™ä¸–å®¶: å®¶æ—çº·äº‰ï¼Œä¼ æ‰¿ç§˜å¯†
- æ•£ä¿®å‡ºèº«: æœºç¼˜å·§åˆï¼Œé€†å¤©æ”¹å‘½
- å‡¡äººå‡ºèº«: æ„å¤–å·å…¥ï¼Œä¿®ä»™å¯è’™
- å¦–æ—è¡€è„‰: èº«ä»½éšç§˜ï¼ŒåŒé‡èº«ä»½

**å¸¸è§å¼€å±€åœºæ™¯**:
- æ‹œå¸ˆå­¦è‰º: å±±é—¨è¯•ç‚¼ï¼Œå¸ˆçˆ¶æ”¶å¾’
- ç§˜å¢ƒæŽ¢ç´¢: æ„å¤–å‘çŽ°ï¼Œå¤è¿¹ä¼ æ‰¿
- ä»‡å®¶è¿½æ€: äº¡å‘½é€ƒäº¡ï¼Œç»åœ°åå‡»
- å¥‡é‡æœºç¼˜: å¶é‡é«˜äººï¼ŒèŽ·å¾—æŒ‡ç‚¹

è®°ä½ï¼š**æ¯ä¸ªè§’è‰²éƒ½æ˜¯ç‹¬ç‰¹çš„ï¼Œè¦åˆ›é€ å±žäºŽä»–ä»¬çš„ä¸“å±žå¼€å±€ï¼**
`;

/**
 * å“åº”éªŒè¯å‡½æ•°
 */
export function validateGMResponse(response: any): { isValid: boolean; errors: string[] } {
  const errors: string[] = [];

  // æ£€æŸ¥å¿…éœ€å­—æ®µ
  if (!response.text || typeof response.text !== 'string') {
    errors.push('ç¼ºå°‘æˆ–æ— æ•ˆçš„textå­—æ®µ');
  }

  if (!response.around || typeof response.around !== 'string') {
    errors.push('ç¼ºå°‘æˆ–æ— æ•ˆçš„aroundå­—æ®µ');
  }

  if (!response.mid_term_memory || typeof response.mid_term_memory !== 'string') {
    errors.push('ç¼ºå°‘æˆ–æ— æ•ˆçš„mid_term_memoryå­—æ®µ');
  }

  if (!response.tavern_commands || !Array.isArray(response.tavern_commands)) {
    errors.push('ç¼ºå°‘æˆ–æ— æ•ˆçš„tavern_commandså­—æ®µ');
  } else {
    // æ£€æŸ¥æ¯ä¸ªæŒ‡ä»¤çš„æ ¼å¼
    response.tavern_commands.forEach((cmd: any, index: number) => {
      if (!cmd.action || !cmd.scope || !cmd.key) {
        errors.push(`ç¬¬${index + 1}ä¸ªæŒ‡ä»¤ç¼ºå°‘å¿…éœ€å­—æ®µ`);
      }

      if (!['set', 'add', 'push', 'pull', 'delete'].includes(cmd.action)) {
        errors.push(`ç¬¬${index + 1}ä¸ªæŒ‡ä»¤çš„actionç±»åž‹æ— æ•ˆ`);
      }
    });
  }

  // æ£€æŸ¥å†…å®¹é•¿åº¦
  if (response.text && response.text.length < 50) {
    errors.push('textå­—æ®µå†…å®¹è¿‡çŸ­ï¼Œéœ€è¦æ›´è¯¦ç»†çš„å™è¿°');
  }

  if (response.around && response.around.length < 20) {
    errors.push('aroundå­—æ®µå†…å®¹è¿‡çŸ­ï¼Œéœ€è¦æ›´å¤šçŽ¯å¢ƒæè¿°');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
}
