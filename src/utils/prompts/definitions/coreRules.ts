/**
 * @fileoverview 核心输出规则
 *
 * 【职责】
 * - JSON输出格式规范
 * - 响应格式要求
 * - 数据结构严格性规则
 *
 * 【设计原则】
 * - 最高优先级规则
 * - 技术性约束
 * - 确保系统正常运行
 */

export const JSON_OUTPUT_RULES = `
# 规则：JSON输出格式 (最高优先级)

1.  **必须输出纯JSON对象**：你的最终输出必须是一个完整的、语法正确的JSON对象。
2.  **禁止Markdown代码块**：严禁使用 \`\`\`json ... \`\`\` 包裹JSON输出。
    - [正确] 正确: {"key": "value"}
3.  **双引号规则**：所有的键(key)和字符串值(string value)都必须使用双引号 " "。
4.  **禁止尾随逗号**：在对象或数组的最后一项后面，绝对不能有逗号。
`.trim()

export const RESPONSE_FORMAT_RULES = `
# JSON强制响应格式 - 必须严格遵守

## 1. JSON输出格式
你的每次响应必须是一个有效的JSON对象，格式如下：
\`\`\`json
{
  "text": "叙事文本内容（必填，不能为空字符串）",
  "mid_term_memory": "中期记忆摘要（选填，可为空字符串）",
  "tavern_commands": [
    {"action": "set|add|push|pull|delete", "key": "字段路径", "value": "值"}
  ],
  "action_options": ["选项1", "选项2", "选项3"]
}
\`\`\`

注意：\`action_options\` 字段仅在启用行动选项功能时需要返回

## 2. 关键要求
1. **必须是纯JSON** - 不要在JSON前后添加任何说明文字。
2. **text字段必填** - 即使没有叙事内容，也要提供占位文本。
3. **tavern_commands是数组** - 即使只有一条指令，也要用 \`[{...}]\` 包裹。
4. **所有字符串必须用双引号**。
5. **不要有尾随逗号**。
6. **特殊字符必须转义** (如 \`\\n\`, \`\\"\`)。

## 3. mid_term_memory 记忆摘要规则
- **严格区分主角和NPC**：必须明确标注"{{user}}"或NPC名称，禁止混淆
- **只记录已发生事件**：严禁编造、推测或添加未在text中出现的情节
- **客观记录**：用第三人称客观描述，不添加主观解读
- **示例**：
  - [正确] 正确："{{user}}与青梅竹马林婉儿一同前往仙门"
  - [错误] 错误："逃婚后与林婉儿一同前往仙门"（编造情节）
  - [错误] 错误："我与林婉儿一同前往仙门"（混淆主角身份）

## 3. 指令对象格式
每个指令对象必须且只能包含以下字段：
- \`action\`: 必需，值为 "set" | "add" | "push" | "pull" | "delete"。
- \`key\`: 必需，字符串类型，表示字段路径。
- \`value\`: 必需（delete操作除外）。
- **严禁添加任何其他字段**。
`.trim()

export const DATA_STRUCTURE_STRICTNESS = `
# 核心规则：数据结构严格性 - 最高优先级

## 1. 数据结构严格性
- **严格匹配定义**：输出必须严格匹配数据结构，禁止添加未定义字段
- **类型正确**：数字用number，字符串用string，不要混用
- **结构优先**：结构正确的平庸JSON > 结构错误的丰富JSON（前端解析失败会导致无法显示）
- **NPC境界铁律**：只有\`名称\`和\`阶段\`，严禁添加\`当前进度\`等玩家专属字段

## 2. 只读字段 - 禁止修改
\`装备栏.*\` | \`修炼功法.*\` | \`掌握技能\` | \`系统.*\` | \`角色基础信息\`(除后天六司) | \`年龄\`
`.trim()

