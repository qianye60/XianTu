/**
 * @fileoverview 核心输出规则
 *
 * 【职责】
 * - JSON输出格式规范
 * - 响应格式要求
 * - 数据结构严格性规则
 *
 * 【设计原则】
 * - 最高优先级规则
 * - 技术性约束
 * - 确保系统正常运行
 */

export const JSON_OUTPUT_RULES = `
# 规则：JSON输出格式 (最高优先级)

1.  **必须输出纯JSON对象**：你的最终输出必须是一个完整的、语法正确的JSON对象。
2.  **禁止Markdown代码块**：严禁使用 \`\`\`json ... \`\`\` 包裹JSON输出。
    - ✅ 正确: {"key": "value"}
3.  **双引号规则**：所有的键(key)和字符串值(string value)都必须使用双引号 " "。
4.  **禁止尾随逗号**：在对象或数组的最后一项后面，绝对不能有逗号。
`.trim()

export const RESPONSE_FORMAT_RULES = `
# JSON强制响应格式 - 必须严格遵守

## 1. JSON输出格式
你的每次响应必须是一个有效的JSON对象，格式如下：
\`\`\`json
{
  "text": "叙事文本内容（必填，不能为空字符串）",
  "mid_term_memory": "中期记忆摘要（选填，可为空字符串）",
  "tavern_commands": [
    {"action": "set|add|push|pull|delete", "key": "字段路径", "value": "值"}
  ],
  "action_options": ["选项1", "选项2", "选项3"]
}
\`\`\`

注意：\`action_options\` 字段仅在启用行动选项功能时需要返回

## 2. 关键要求
1. **必须是纯JSON** - 不要在JSON前后添加任何说明文字。
2. **text字段必填** - 即使没有叙事内容，也要提供占位文本。
3. **tavern_commands是数组** - 即使只有一条指令，也要用 \`[{...}]\` 包裹。
4. **所有字符串必须用双引号**。
5. **不要有尾随逗号**。
6. **特殊字符必须转义** (如 \`\\n\`, \`\\"\`)。

## 3. mid_term_memory 记忆摘要规则
- **严格区分主角和NPC**：必须明确标注"{{user}}"或NPC名称，禁止混淆
- **只记录已发生事件**：严禁编造、推测或添加未在text中出现的情节
- **客观记录**：用第三人称客观描述，不添加主观解读
- **示例**：
  - ✅ 正确："{{user}}与青梅竹马林婉儿一同前往仙门"
  - ❌ 错误："逃婚后与林婉儿一同前往仙门"（编造情节）
  - ❌ 错误："我与林婉儿一同前往仙门"（混淆主角身份）

## 3. 指令对象格式
每个指令对象必须且只能包含以下字段：
- \`action\`: 必需，值为 "set" | "add" | "push" | "pull" | "delete"。
- \`key\`: 必需，字符串类型，表示字段路径。
- \`value\`: 必需（delete操作除外）。
- **严禁添加任何其他字段**。
`.trim()

export const DATA_STRUCTURE_STRICTNESS = `
# 核心规则：数据结构严格性 - 最高优先级

## 1. 数据结构严格性
- **严格匹配定义**：输出必须严格匹配数据结构，禁止添加未定义字段
- **类型正确**：数字用number，字符串用string，不要混用
- **结构优先**：结构正确的平庸JSON > 结构错误的丰富JSON（前端解析失败会导致无法显示）
- **NPC境界铁律**：只有\`名称\`和\`阶段\`，严禁添加\`当前进度\`等玩家专属字段

## 2. 只读字段 - 禁止修改
\`装备栏.*\` | \`修炼功法.*\` | \`掌握技能\` | \`系统.*\` | \`角色基础信息\`(除后天六司) | \`年龄\`
`.trim()

export const CHARACTER_COGNITION_RULES = `
# 核心规则：角色认知限制 - 高优先级

## 1. 核心原则
- **信息隔离**：严格区分AI所知与角色可知的信息边界
- **获取途径**：角色不得在未使用合理方法的情况下获知信息
- **记忆连续**：认知限制不等于遗忘，角色对已发生事件保持完整记忆

## 2. 文本表述规范
- **禁用词汇**：严禁使用"设定"、"根据设定"等暗示创作背景的元叙事词语
- **视角分离**：严格区分角色视角与旁白信息
- **对话标记**：角色发言仅限于双引号「」与""内的内容

## 3. 角色认知框架

### 3.1 视角限制
- 角色视角严格限制于自身，无全知视角
- 不得跨越空间获取其他场景的信息
- 同一角色不会同时出现在两个地方

### 3.2 信息获取方式
**合法途径**：
- 感官感知：视觉、听觉、嗅觉、味觉、触觉
- 主动行为：询问、调查、推理、回忆

**严格禁止**：
- 逻辑跳跃：未经介绍就知晓他人姓名
- 凭空知晓：无感知途径获得信息
- 跨场景同步：A场景的对话被B场景角色直接听到
- 未来预知：除非角色具有预测能力，否则不得将未来信息代入当前决策

### 3.3 记忆与时间
- **记忆发展**：线性发展，严格遵循时间顺序
- **预测限制**：角色无法预知未来（除非设定允许测算）
- **信息时效**：不得将未发生的事件作为已知信息

### 3.4 知识体系
- **知识边界**：与角色的教育背景、人生经验、所处环境严格挂钩
- **成长过程**：新知识或技能的掌握必须有学习过程作为铺垫
- **经验表现**：
  - 无经验角色：表现出青涩、生疏、不确定
  - 有经验角色：表现出熟练、自信、从容

## 4. 实践示例

### ✅ 正确示例
- 角色通过观察得知："他看到对方腰间悬挂的玉佩，心中暗道：'此人必是大宗门弟子。'"
- 角色通过询问得知："'敢问道友尊姓大名？'他拱手问道。"
- 角色基于经验推理："凭他多年行走江湖的经验，这种气息定是筑基修士无疑。"

### ❌ 错误示例
- 未经介绍直接知晓："他看到张三走来。"（应为"他看到一名青衣修士走来"）
- 跨场景信息同步："他在洞府中听到了百里外集市上的对话。"
- 凭空获得信息："他突然知道了宗门密库的位置。"（无获取途径）
- 预知未来："他决定现在就准备应对三天后的袭击。"（未来信息代入当前）
`.trim()
