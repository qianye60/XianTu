/**
 * @fileoverview 游戏业务逻辑规则
 *
 * 【职责】
 * - 境界系统规则
 * - 三千大道体系规则
 * - 玩家意图与判定系统
 * - NPC相关规则
 * - NSFW内容生成规则
 *
 * 【设计原则】
 * - 游戏玩法相关
 * - 业务逻辑约束
 * - 内容生成规范
 */

export const REALM_SYSTEM_RULES = `
# 境界体系规则

## 1. 境界层级
**顺序**: 凡人 > 炼气 > 筑基 > 金丹 > 元婴 > 化神 > 炼虚 > 合体 > 渡劫
**阶段**: 初期 > 中期 > 后期 > 圆满 > 极境(罕见)

## 2. 突破机制
- **小阶段**: 进度满后自动突破，进度重置。
- **大境界**: 需满足特定条件(丹药/机缘)，突破后属性大幅提升。
- **极境**: 需特殊机缘，战力远超同阶。

## 3. 境界压制 (铁律)
- **大境界差距**: 绝对碾压 (如筑基秒杀炼气)。
- **小阶段差距**:
  - 差2+阶段: 压倒性优势。
  - 差1阶段: 可通过功法/法宝/体质弥补。
- **禁止**: 唯心爆发逆袭 (如"信念之力"战胜高境界)。
- **允许**: 战术/环境/道具造成的以弱胜强 (仅限小差距)。
`.trim()

export const REALM_SUPPRESSION_RULES = `
`.trim()

export const THREE_THOUSAND_DAOS_RULES = `
# 规则：三千大道体系

## 核心概念
- "三千大道"是辅助修炼体系，记录玩家领悟的各种道路（如剑道、丹道、武道等）。
- "境界"（炼气、筑基等）是主修的仙道进度。
- 境界是主修，大道是辅修感悟，两者相辅相成。

## 数据结构与指令规则
- **解锁大道**: 必须使用 \`set\` 指令，并设置 \`"是否解锁": true\`。
- **阶段列表**: \`阶段列表\` 必须是包含至少2个阶段对象的数组。
- **阶段对象**: 每个阶段对象必须包含 \`名称\`, \`描述\`, \`突破经验\` 字段。
- **进度更新**: 使用 \`add\` 指令增加 \`当前经验\`。
- **示例结构**:
  \`\`\`json
  "剑道": {
    "道名": "剑道",
    "描述": "以剑入道，追求剑之极致",
    "是否解锁": true,
    "当前阶段": 0,
    "当前经验": 0,
    "总经验": 0,
    "阶段列表": [
      {"名称": "初窥门径", "描述": "...", "突破经验": 100},
      {"名称": "小有所成", "描述": "...", "突破经验": 500},
      ...
    ]
  }
  \`\`\`
`.trim()

export const NPC_RULES = `
# NPC 行为准则

## 1. 独立人格 (核心)
- **拒绝工具化**: NPC有自己的目标、尊严和底线，不是玩家的附庸。
- **好感反馈**:
  - 低好感: 冷漠/警惕/拒绝。
  - 高好感: 信任/依赖/撒娇，但仍有底线。
  - 触底线: 愤怒/敌对，极难修复。
- **禁止**: 无理由倒贴、奴性表现、眼神空洞。

## 2. 认知局限
- **信息隔离**: 仅知晓感官/经历/推理所得信息。
- **概念类比**: 用修仙概念理解未知事物 (如: 手机->传音法宝)。
- **禁止**: 上帝视角、预知未来、元叙事。

## 3. 行为逻辑
- **利益驱动**: 优先考虑修为、生存、资源、重要之人。
- **实力反应**:
  - 对低阶: 无视/俯视/利用。
  - 对同阶: 谨慎/结交/竞争。
  - 对高阶: 敬畏/讨好/避让。
- **动态交互**:
  - 记忆回响: 对话中自然提及过往互动。
  - 情感惯性: 情绪变化需有铺垫和过渡。

## 4. 数据规范
- **境界**: 仅记录 [名称, 阶段]，无进度条。
- **记忆**: 每次交互 push "【时间】事件摘要"。
- **关系**: 实时更新好感度与关系状态。
`.trim()

export const GRAND_CONCEPT_CONSTRAINTS = `
# 规则：宏大概念约束

## 境界权限
- **化神以下**：禁用"道/天道/法则/规则"，允许"玄妙/精深/威能/灵气/术法/神通"
- **飞升以下**：能力描述禁涉"法则"，限于灵气操控/阵法运用
- **低阶修士**：禁察觉"道韵"，只能感受威压/气势

## 核心要求
- **禁止玄学归因**：功法原理必须基于灵气运转/经脉理论/阵法构造解释，禁用"掌控法则/天道加持"
- **判定合理化**："天道之眷"仅作修辞，必须归因于技巧/环境/破绽/多因素叠加
- **评价务实化**：禁用"道之显现/法则共鸣/悟道"，使用"术法精妙/威力不凡/手法高明"
- **能力具体化**：禁用"操控法则/法则之力/道的处刑"，必须详述灵力路径/施法过程/资源消耗/限制条件

错误示例："这是道的处刑！他掌控了火之法则"
正确示例："他将灵力凝聚于剑尖，一剑斩出三丈剑气"
`.trim()

export const SKILL_AND_SPELL_USAGE_RULES = `
# 规则：技能使用与消耗

核心：使用技能/法术/神通必须消耗对应资源

必须消耗：技能/法术/神通/法宝能力/阵法/符咒
无需消耗：普通攻击/日常行为/被动天赋/装备常驻加成
`.trim()

export const CULTIVATION_DETAIL_RULES = `
# 规则：功法运转与修炼细节描写

## 1. 灵力运转路径
禁止："运转周天"、"灵力流转"
必须：丹田起→经脉(任/督/手三阳)→穴位(膻中/百会/劳宫)→终点(掌心/剑尖/释放)
示例："灵力自丹田涌出，沿任脉上行，过膻中穴，分流至双臂，经手三阳经至劳宫穴，凝聚成掌"

## 2. 法诀过程
禁止："一掌拍出"、"法术施展"
必须：手印变化(起式→终式) + 口诀吟诵 + 灵力凝聚过程
示例："双手结印，从莲花印变换至剑指，口中低喝：'疾！'，灵力在指尖凝聚成三寸剑芒"

## 3. 时间标注
禁止："瞬间完成"、"立刻施展"
必须：使用修真时间单位(息≈1-2秒 | 盏茶≈10分钟 | 一炷香≈30分钟)，明确各阶段耗时
示例："深吸一口气(一息)，双手结印(两息)，灵力运转全身(五息)，猛然一掌拍出(一息)"

## 4. 修炼过程
禁止："入定修炼"、"闭关修行"
必须：调整呼吸→意守丹田→感知灵气→引导入体→炼化灵气(详述每步)

## 5. 突破过程
禁止："突破成功"、"境界提升"
必须：经脉阻塞位置 + 冲关身体反应(疼痛/发热/颤抖) + 突破后变化(灵力增加/感知提升)

## 6. 功法副作用
必须体现：灵力消耗(X%) + 经脉负荷(胀痛/损伤) + 肉身极限(气血下降/体力透支)

## 7. 斗法拆解
禁止："交手数百回合"、"激战正酣"、"威力惊人"
必须：
- 回合拆解：出手→感知→应对→碰撞→结果(每回合详述)
- 威力量化：破坏范围(X丈/里) + 破坏深度(X尺/丈) + 余波影响
- 完整过程：蓄力→成型→轨迹→命中→余波(不跳过任何环节)

核心：拒绝抽象/跳跃/模糊/省略，追求具体/连贯/量化/细节
`.trim()

export const STATUS_EFFECT_RULES = `
# 规则：状态效果操作

核心：状态效果可修改，禁止删除（系统自动清理过期状态）

允许添加：push到状态效果数组
允许修改：set修改状态名称/描述/强度/持续时间
禁止删除：delete删除状态

常见场景：受伤→服药→改为轻伤+降低强度+缩短时间
`.trim();

export const COMMAND_PATH_CONSTRUCTION_RULES = `
# 规则：命令路径构建

## 三大原则
1. **逐层连接**：\`顶层字段.子字段.目标字段\`（如\`玩家角色状态.境界.当前进度\`）
2. **动态拼接**：\`人物关系.[NPC名].好感度\` → \`人物关系.张三.好感度\`
3. **数组访问**：索引访问\`状态效果[0].持续时间分钟\`或push添加新元素

## 顶层字段速查
玩家角色状态、背包、人物关系、三千大道.大道列表、游戏时间、任务系统、世界信息
只读字段：装备栏、修炼功法、掌握技能、记忆、系统、叙事历史

## 常用操作速查

**重要：删除物品必须使用 "delete" 而不是 "remove"！**

| 操作场景 | action | key | value |
|---------|--------|-----|-------|
| 增加修为 | add | 玩家角色状态.境界.当前进度 | 100 |
| 扣除气血 | add | 玩家角色状态.气血.当前 | -50 |
| 增加灵石 | add | 背包.灵石.下品 | 500 |
| 获得物品 | set | 背包.物品.[物品ID] | {完整对象} |
| 删除物品 | **delete** | 背包.物品.[物品ID] | - |
| 推进时间 | add | 游戏时间.分钟 | 30 |
| 添加状态 | push | 玩家角色状态.状态效果 | {完整对象} |
| 修改状态 | set | 玩家角色状态.状态效果[索引].字段名 | 新值 |
| NPC好感 | add | 人物关系.[NPC名].好感度 | ±10 |
| NPC记忆 | push | 人物关系.[NPC名].记忆 | "事件" |
| 功法进度 | add | 背包.物品.[功法ID].修炼进度 | 10 |
| 解锁技能 | push | 背包.物品.[功法ID].已解锁技能 | "技能名" |
| 大道经验 | add | 三千大道.大道列表.[道名].当前经验 | 50 |
| 任务状态 | set | 任务系统.activeTasks.[任务ID].status | "completed" |
`.trim();

export const NSFW_CONTENT_RULES = `
# 规则：NSFW内容生成与更新

## 1. 生成规则
- **触发条件**: 创建NPC时，若 \`nsfwMode=true\` 且NPC性别符合 \`nsfwGenderFilter\`，则**必须**生成完整的 \`私密信息\` 对象。
- **数据源**: 字段的结构、类型和可选值，**唯一参考 \`dataDefinitions.ts\` 文件**。本文件只定义行为规则，不定义数据结构。

## 2. 玩家身体部位开发
- **触发条件**: 角色初始化时，若 \`nsfwMode=true\`，必须为玩家生成3-5个私密敏感部位。
- **存储位置**: \`身体部位开发\` (根级别字段)。
- **数据结构**: \`{"部位名": {"特征描述": "..."}}\`。
- **重要**: 玩家不使用 \`私密信息\` 对象，只使用此字段。

## 3. 女性角色描写指导原则

### 避免负面刻板描写
**严禁**在性爱场景中出现以下极端负面反应：
- 绝望：禁止女性角色在性爱后或性爱中表现出无理由的、深沉的绝望感
- 麻木/无反应：禁止将女性描绘为完全麻木、没有生理或情感反应的工具
- 对未来失去希望：避免将性爱场景与女性角色对未来完全失去希望、人生崩溃的情节直接挂钩
- 不分场合：无论背景设定如何，都应避免上述极端负面反应成为常态或默认描写

### 鼓励真实多元描写
**鼓励**展现女性角色的以下特质：
- 情感复杂性：描写真实、复杂情感（愉悦/激情/犹豫/好奇/羞涩/依赖/爱意/探索/适度紧张或困惑，但非绝望）
- 生理反应：描写合理的生理反应和愉悦体验
- 人物弧光：即使性爱场景伴随挑战，也应保持角色对未来的希望和能动性，允许其成长或寻找解决方案
- 情境合理性：任何情绪或反应都应与具体情境、人物性格和故事发展逻辑相符
- 自主性与生命力：专注于展现女性角色的自主性、情感深度和生命力

## 4. 更新规则
**核心原则：发生性相关互动时，必须实时更新NPC的私密信息！**

### 处女状态变更 (唯一条件)
- 仅当发生**导致处女膜破裂的插入式性行为**时，\`是否为处女\`才**必须**设为 \`false\`。
- 任何其他形式的互动（如抚摸、口交、非插入式摩擦）**严禁**改变 \`是否为处女\` 状态。
- **逻辑一致性**: \`是否为处女=true\` 必须对应 \`性交总次数=0\` 和 \`性伴侣名单=[]\`。

### 行为与字段更新映射
- **【破处插入式性行为】**:
  - \`是否为处女\` -> \`false\` (set)
  - \`性交总次数\` -> +1 (add)
  - \`性伴侣名单\` -> 添加伴侣 (push)
  - \`最近一次性行为时间\` -> 更新 (set)
  - \`身体部位\` -> 开发度/敏感度增加 (set)
  - \`当前性状态\`, \`体液分泌状态\`, \`性渴望程度\` -> 根据互动更新 (set)
- **【非破处插入式性行为】**:
  - 更新除 \`是否为处女\` 之外的上述所有字段。
- **【非插入式亲密互动】**:
  - 只更新 \`当前性状态\`, \`体液分泌状态\`, \`性渴望程度\` 和少量 \`身体部位\` 开发度/敏感度。
  - **严禁**更新 \`是否为处女\`, \`性交总次数\`, \`性伴侣名单\`。

### 状态与数值更新细则

- "当前性状态" 更新指南:
  - 互动前或无互动时，应为 "平静"。
  - 发生亲密互动或前戏时，应更新为 "兴奋"。
  - 性高潮或满足后，应更新为 "已满足"。
  - 受特殊体质或丹药影响时，可更新为 "发情期"。

- "体液分泌状态" 更新指南:
  - 当 "当前性状态" 为 "平静" 时，应为 "干燥"。
  - 当 "当前性状态" 为 "兴奋" 时，应为 "湿润" 或 "爱液横流" (取决于渴望程度)。
  - 当 "当前性状态" 为 "已满足" 时，应逐渐恢复为 "干燥"。

- "性渴望程度" (0-100) 更新指南:
  - 满足后，数值减少 20-50。
  - 未满足或被挑逗时，数值增加 5-30。

- "身体部位" 更新指南:
  - 开发度: 每次互动增加 1-5。
  - 敏感度: 每次互动增加 1-10。
`.trim()

