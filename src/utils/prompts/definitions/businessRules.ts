/**
 * @fileoverview 游戏业务逻辑规则
 *
 * 【职责】
 * - 境界系统规则
 * - 三千大道体系规则
 * - 玩家意图与判定系统
 * - NPC相关规则
 * - NSFW内容生成规则
 *
 * 【设计原则】
 * - 游戏玩法相关
 * - 业务逻辑约束
 * - 内容生成规范
 */

export const REALM_SYSTEM_RULES = `
# 规则：境界与阶段

## 1. 基础规则
- **境界顺序**：凡人 → 炼气 → 筑基 → 金丹 → 元婴 → 化神 → 炼虚 → 合体 → 渡劫
- **阶段划分**：每个境界分为初期、中期、后期、圆满、极境(罕见)
- **属性提升**：境界突破时，必须用 \`add\` 增加气血、灵气、神识的上限

## 2. 境界突破所需经验标准（必须遵守）

### 境界内小阶段突破（同一境界内）
| 当前阶段 | 下一阶段 | 所需经验 | 说明 |
|---------|---------|---------|------|
| 初期 | 中期 | 基础值 × 1 | 基础突破 |
| 中期 | 后期 | 基础值 × 2 | 难度提升 |
| 后期 | 圆满 | 基础值 × 3 | 接近圆满 |
| 圆满 | 极境 | 基础值 × 10 | 逆天而行 |

### 各境界基础值（用于计算小阶段突破）
| 境界 | 基础值 | 初期→中期 | 中期→后期 | 后期→圆满 | 圆满→极境 |
|------|--------|----------|----------|----------|----------|
| 炼气 | 1000 | 1000 | 2000 | 3000 | 10000 |
| 筑基 | 5000 | 5000 | 10000 | 15000 | 50000 |
| 金丹 | 20000 | 20000 | 40000 | 60000 | 200000 |
| 元婴 | 100000 | 100000 | 200000 | 300000 | 1000000 |
| 化神 | 500000 | 500000 | 1000000 | 1500000 | 5000000 |
| 炼虚 | 2000000 | 2000000 | 4000000 | 6000000 | 20000000 |
| 合体 | 10000000 | 10000000 | 20000000 | 30000000 | 100000000 |
| 渡劫 | 50000000 | 50000000 | 100000000 | 150000000 | 500000000 |

### 大境界突破（跨境界）
| 当前境界 | 下一境界 | 所需经验 | 说明 |
|---------|---------|---------|------|
| 炼气圆满 | 筑基初期 | 10000 | 脱凡入道 |
| 筑基圆满 | 金丹初期 | 50000 | 结丹之劫 |
| 金丹圆满 | 元婴初期 | 200000 | 丹碎婴生 |
| 元婴圆满 | 化神初期 | 1000000 | 神游太虚 |
| 化神圆满 | 炼虚初期 | 5000000 | 身融虚空 |
| 炼虚圆满 | 合体初期 | 20000000 | 法则归体 |
| 合体圆满 | 渡劫初期 | 100000000 | 叩问天道 |

## 2. 重要注意事项
- 🔴 **必须严格遵守上述经验数值标准**，不得随意设定
- 🔴 突破到新阶段时，"当前进度"必须重置为0
- 🔴 "下一级所需"必须根据上表设定，不能凭空编造
- 🔴 大境界突破时，必须同时增加气血、灵气、神识上限
- 极境突破难度极高，需要特殊机缘，不能轻易达成
`.trim()

export const THREE_THOUSAND_DAOS_RULES = `
# 规则：三千大道体系

## 核心概念
- "三千大道"是辅助修炼体系，记录玩家领悟的各种道路（如剑道、丹道、武道等）。
- "境界"（炼气、筑基等）是主修的仙道进度。
- 境界是主修，大道是辅修感悟，两者相辅相成。

## 数据结构与指令规则
- **解锁大道**: 必须使用 \`set\` 指令，并设置 \`"是否解锁": true\`。
- **阶段列表**: \`阶段列表\` 必须是包含至少2个阶段对象的数组。
- **阶段对象**: 每个阶段对象必须包含 \`名称\`, \`描述\`, \`所需进度\` 字段。
- **进度更新**: 使用 \`add\` 指令增加 \`当前进度\`。
- **示例结构**:
  \`\`\`json
  "剑道": {
    "是否解锁": true,
    "当前阶段": "初窥门径",
    "当前进度": 0,
    "阶段列表": [
      {"名称": "初窥门径", "描述": "...", "所需进度": "所需进度值"},
      {"名称": "小有所成", "描述": "...", "所需进度": "所需进度值"},
      ...
    ]
  }
  \`\`\`
`.trim()

export const NPC_RULES = `
# 规则：NPC相关规则

## 1. 玩家与NPC数据结构差异
**核心要求：** NPC的境界对象只有 \`名称\` 和 \`阶段\` 2个字段。
**严禁操作：** 不得为NPC添加 \`当前进度\`, \`下一级所需\`, \`突破描述\` 等玩家专属字段。

## 2. NPC记忆更新
**核心规则：** 每次与NPC交互（对话、战斗、赠礼等），或NPC在场景中出现/被提及，都必须用 \`push\` 操作为其添加一条新的记忆。
**记忆格式：** \`"【游戏时间】10-30字中文事件描述"\`
**记忆内容要求：**
- 必须包含游戏时间（年月日）。
- 必须记录关键事件、对话内容、情感变化、以及对玩家的印象变化。

## 3. NPC关系动态更新（重要）
**核心规则：** NPC的 \`与玩家关系\` 和 \`好感度\` 必须根据互动内容实时更新，不能一直停留在初始状态。

**更新时机：**
- 每次对话、互动、赠礼、战斗后，必须评估是否需要更新关系和好感度
- 关系发生实质性变化时（从陌生到熟悉、从中立到友好/敌对等），必须及时更新关系描述
- 发生重大事件（结拜、成为道侣、师徒关系等）时，必须立即更新

**操作方式：**
- 好感度：使用 \`add\` 操作增减，如 \`{"action":"add","key":"人物关系.张三.好感度","value":10}\`
- 关系描述：使用 \`set\` 操作更新，如 \`{"action":"set","key":"人物关系.张三.与玩家关系","value":"朋友"}\`
`.trim()

export const SKILL_AND_SPELL_USAGE_RULES = `
# 规则：技能、法术、神通使用与消耗

## 🔴 核心强制规则
**任何使用修行手段的行为，都必须消耗对应的修行状态！**

### 适用范围（必须消耗）
- ✅ 使用掌握的技能（如御剑术、炼丹术）
- ✅ 施展法术、术法（如火球术、冰封术）
- ✅ 动用神通、秘术（如遁术、幻术）
- ✅ 使用法宝、灵器的特殊能力
- ✅ 施展阵法、符咒
- ✅ 任何需要调动灵气或神识的修行行为

### 不需要消耗的情况
- ❌ 普通物理攻击（拳脚、兵器）
- ❌ 日常对话、移动
- ❌ 被动天赋效果
- ❌ 装备提供的常驻加成
`.trim()

export const COMMAND_PATH_CONSTRUCTION_RULES = `
# 规则：命令路径构建方法 - 核心技能

## 1. 路径构建三大原则

### 原则1：从顶层到目标，逐层连接
**公式**：\`顶层字段.子字段.目标字段\`

示例：
- ✅ \`玩家角色状态.境界.当前进度\` - 完整路径
- ✅ \`背包.灵石.下品\` - 完整路径
- ❌ \`境界.当前进度\` - 缺少顶层
- ❌ \`灵石.下品\` - 缺少顶层

### 原则2：动态数据用名称/ID拼接
**公式**：\`顶层.动态键.目标\`

当遇到NPC名字、物品ID、大道名称等动态数据时，直接拼接：
- \`人物关系.[NPC名字].好感度\` → \`人物关系.张三.好感度\`
- \`背包.物品.[物品ID].数量\` → \`背包.物品.item_001.数量\`
- \`三千大道.大道列表.[大道名].当前经验\` → \`三千大道.大道列表.剑道.当前经验\`

### 原则3：数组访问用索引或push
**索引访问**（修改特定元素）：
- \`玩家角色状态.状态效果[0].持续时间分钟\`
- \`任务系统.当前任务列表[2].目标列表[0].当前进度\`

**push操作**（添加新元素）：
- key: \`玩家角色状态.状态效果\`
- value: {完整状态对象}

## 2. 快速路径构建流程

**步骤1**：确定数据在哪个顶层分类
- 角色基础信息 → \`角色基础信息.*\` (只读，除后天六司)
- 玩家角色状态 → \`玩家角色状态.*\` (境界、气血、灵气、神识、寿命、位置、状态效果等)
- 背包 → \`背包.*\` (灵石、物品)
- 装备栏 → \`装备栏.*\` (只读，系统自动计算)
- 人物关系 → \`人物关系.*\` (NPC档案、动态键为NPC名字)
- 记忆 → \`记忆.*\` (只读，系统自动管理)
- 游戏时间 → \`游戏时间.*\` (年、月、日、小时、分钟)
- 世界信息 → \`世界信息.*\` (地图、大陆信息、势力信息、地点信息)
- 三千大道 → \`三千大道.大道列表.*\` (动态键为大道名称)
- 任务系统 → \`任务系统.*\` (配置、当前任务列表、任务统计)
- 修炼功法 → \`修炼功法.*\` (只读引用，实际数据在背包中)
- 掌握技能 → \`掌握技能\` (只读，系统自动计算)
- 系统 → \`系统.*\` (只读配置，nsfwMode等)
- 叙事历史 → \`叙事历史\` (只读，系统自动维护)
- 身体部位开发 → \`身体部位开发.*\` (角色NSFW模式专属)

**步骤2**：识别动态部分（如果有）
- 是NPC数据吗？ → 插入NPC名字
- 是物品数据吗？ → 插入物品ID
- 是大道数据吗？ → 插入大道名称

**步骤3**：定位到具体目标字段
- 想改数值？ → 找到具体数值字段（如\`.当前\`、\`.上限\`、\`.数量\`）
- 想改关系？ → 找到关系字段（如\`.与玩家关系\`、\`.好感度\`）
- 想加记忆？ → 找到\`.记忆\`数组

## 3. 常见错误与修正

| 错误 | 原因 | 正确做法 |
|------|------|---------|
| \`境界.当前进度\` | 缺少顶层 | \`玩家角色状态.境界.当前进度\` |
| \`人物关系.记忆\` | 缺少NPC名 | \`人物关系.张三.记忆\` |
| \`物品.item_001\` | 缺少顶层 | \`背包.物品.item_001\` |
| \`大道列表.剑道\` | 缺少顶层 | \`三千大道.大道列表.剑道\` |

## 4. 常用操作速查表

| 操作场景 | action | key（完整路径） | value示例 | 注意事项 |
|---------|--------|----------------|----------|---------|
| 增加修为 | add | 玩家角色状态.境界.当前进度 | 100 | 数值类型 |
| 扣除气血 | add | 玩家角色状态.气血.当前 | -50 | 负数扣除 |
| 增加灵石 | add | 背包.灵石.下品 | 500 | 灵石有4个等级 |
| 获得物品 | set | 背包.物品.[物品ID] | {完整对象} | ID动态生成 |
| 物品数量 | add | 背包.物品.[物品ID].数量 | ±5 | 可增可减 |
| 删除物品 | delete | 背包.物品.[物品ID] | - | 无需value |
| 推进时间 | add | 游戏时间.分钟 | 30 | 自动进位 |
| 添加状态 | push | 玩家角色状态.状态效果 | {完整对象} | 必含5必填字段 |
| NPC好感 | add | 人物关系.[NPC名].好感度 | ±10 | -100~100 |
| NPC记忆 | push | 人物关系.[NPC名].记忆 | "事件" | 自动加时间前缀 |
| NPC关系 | set | 人物关系.[NPC名].与玩家关系 | "朋友" | 描述性文本 |
| 解锁大道 | set | 三千大道.大道列表.[道名] | {完整对象} | 必含阶段列表 |
| 大道经验 | add | 三千大道.大道列表.[道名].当前经验 | 50 | 用于突破 |
| 功法进度 | add | 背包.物品.[功法ID].修炼进度 | 10 | 不在修炼功法字段 |
| 解锁技能 | push | 背包.物品.[功法ID].已解锁技能 | "技能名" | 不在掌握技能字段 |
| 任务进度 | add | 任务系统.当前任务列表[索引].目标列表[索引].当前进度 | 1 | 双层数组 |
| 改变位置 | set | 玩家角色状态.位置 | {描述,x,y} | 三字段同时设 |

## 5. 实战思维模板

遇到修改需求时，这样思考：
1. **数据类型** → 确定顶层字段
2. **动态部分** → 识别并拼接名称/ID
3. **目标字段** → 定位到要修改的具体字段
4. **操作类型** → 选择set/add/push/delete

**例1：给张三增加好感度**
1. 数据类型：NPC关系 → \`人物关系\`
2. 动态部分：NPC名字 → \`张三\`
3. 目标字段：好感度 → \`.好感度\`
4. 操作类型：数值增加 → \`add\`
5. 最终：\`{"action":"add","key":"人物关系.张三.好感度","value":10}\`

**例2：玩家修炼剑道功法**
1. 功法在背包 → \`背包.物品\`
2. 功法ID → \`gongfa_jiandao_001\`
3. 增加进度 → \`.修炼进度\`
4. 数值增加 → \`add\`
5. 最终：\`{"action":"add","key":"背包.物品.gongfa_jiandao_001.修炼进度","value":10}\`

**例3：文本中有突破境界内容（多指令组合）**
\`\`\`json
[
  {"action":"set","key":"玩家角色状态.境界","value":{"名称":"筑基","阶段":"初期","当前进度":0,"下一级所需":10000,"突破描述":"..."}},
  {"action":"add","key":"玩家角色状态.气血.上限","value":500},
  {"action":"add","key":"玩家角色状态.灵气.上限","value":1000}
]
\`\`\`
`.trim();

export const NSFW_CONTENT_RULES = `
# 规则：NSFW内容生成

当 \`系统.nsfwMode\` 为 \`true\` 时，必须严格遵守以下规则：

## 1. NPC私密信息（完整结构）

- 触发条件：创建NPC时，若 \`nsfwMode=true\` 且NPC性别符合 \`nsfwGenderFilter\`("all"|"female"|"male")，则必须生成完整的\`私密信息\`对象
- 存储位置：\`人物关系.{NPC名字}.私密信息\`
- 字段完整性：\`私密信息\`对象必须包含所有12个必填字段，缺一不可
- 逻辑一致性：\`是否为处女/处男=true\` 必须对应 \`性交总次数=0\`, \`性伴侣名单=[]\`
- 身体部位结构：身体部位必须是对象数组，每个对象包含 \`部位名称\`, \`开发度\`, \`敏感度\`, \`特征描述\`, \`特殊印记\` 五个字段
- 性伴侣名单规则：
  - 必须使用具体人名：["张三", "李四", "王五"]
  - 已故或失踪在人名后注明：["张三(已故)", "李四(失踪)"]
  - 空数组表示无性伴侣：[]

## 2. 玩家身体部位开发（NSFW专属）

- 触发条件：角色初始化时，若 \`nsfwMode=true\`，必须为玩家生成3-5个私密敏感部位
- 存储位置：\`身体部位开发\` (SaveData根级别字段)
- 数据结构：\`{"部位名": {"特征描述": "..."}}\`
- 部位类型：仅限NSFW私密部位，如：胸部、乳头、小穴、菊穴、阴蒂等性敏感区域
- 重要：玩家只使用 \`身体部位开发\` 字段，不使用 \`玩家角色状态.私密信息\` 字段
`.trim()
