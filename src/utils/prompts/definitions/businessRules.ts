/**
 * @fileoverview 游戏业务逻辑规则 v2.0 (精简版)
 */

export const REALM_SYSTEM_RULES = `
# 境界体系
顺序：凡人>炼气>筑基>金丹>元婴>化神>炼虚>合体>渡劫
阶段：初期>中期>后期>圆满>极境(罕见)
突破：小阶段进度满自动突破；大境界需丹药/机缘
压制：大境界差=绝对碾压；小阶段差2+=压倒性；差1可用功法/法宝弥补
禁止：唯心爆发逆袭
`.trim()

export const REALM_SUPPRESSION_RULES = `
`.trim()

export const THREE_THOUSAND_DAOS_RULES = `
# 三千大道体系

## 核心概念
三千大道，殊途同归。每位修士可参悟多条大道，以道入心，以心证道。

## 命名规范（重要）
大道命名应符合修仙世界观，优先使用以下类型：
- 武器类：剑道、刀道、枪道、棍道、拳道
- 职业类：丹道（炼丹）、器道（炼器）、阵道（阵法）、符道（符箓）、医道（医术）
- 修炼类：体道（体修）、魂道（神魂）、法道（法术）、术道（术法）
- 意境类：生死道、轮回道、因果道、阴阳道、五行道、时空道

禁止使用元素魔法风格命名（如：火道、水道、木道、金道、土道等）

## 数据路径
路径：角色.大道.大道列表.[道名]
操作：set解锁道途 | add经验 | add阶段突破

## 指令示例
解锁：{"action":"set","key":"角色.大道.大道列表.剑道","value":{"道名":"剑道","描述":"以剑入道，剑心通明","阶段列表":[{"阶段名":"初窥门径","需求经验":0},{"阶段名":"略有所得","需求经验":100}],"是否解锁":true,"当前阶段":0,"当前经验":0,"总经验":0}}
增加经验：{"action":"add","key":"角色.大道.大道列表.剑道.当前经验","value":50}
`.trim()

export const NPC_RULES = `
# NPC规则（铁律）

## 命名与多样性
- 姓名必须多样化：随机姓 + 1-2字名；凡人可朴实名/小名，修士可雅名/道号
- 避免高频模板名（如“张三/李四/林风/剑尘/无名/逍遥”等）
- 同一场景出现多个NPC：姓名、性格特征、说话方式必须明显不同

## 年龄与境界一致
- 出生日期.年 必须 < 当前游戏时间.年（元数据.时间.年）
- 年龄由系统自动计算（当前年 - 出生年），不要手填年龄
- 境界与出身/势力/地点要匹配：村镇多凡人，宗门外门多炼气，内门/坊市可有筑基金丹混杂，高阶极少且必须有来由

## 世界独立运转
- 世界不以主角为中心：NPC有独立行程、利益与目标
- NPC境界分布由地点/势力/时代决定，不要按主角强弱去“配对”对手或帮手

## 人设一致性（防OOC）
- 立场一致：与玩家关系/势力归属/人格底线约束行为与态度
- 知识边界一致：只基于亲眼所见与可靠传闻，不凭空知道主角私密数据或系统规则
- 口吻一致：符合身份与时代语感，禁现代网语，禁自称AI/模型，禁跳出世界观解释机制
- 变化要有触发：好感、敌意、信任、称呼的跃迁必须由事件/利益/代价推动

## 技术规范
- 创建NPC必须一次性 set "社交.关系.<NPC名>" 的完整对象（必需字段按数据定义）
- 更新NPC用 set/add/push 更新具体字段，不要重复创建同名NPC

## NSFW（酒馆端）
- nsfwMode=true 且 性别符合过滤：创建NPC必须包含完整 "私密信息(PrivacyProfile)"
- 其他情况：不要生成 "私密信息"
`.trim()

export const GRAND_CONCEPT_CONSTRAINTS = `
# 宏大概念约束
化神以下禁用"道/天道/法则"，用"玄妙/威能/术法"代替
禁止玄学归因，必须基于灵气运转/经脉/阵法解释
能力必须具体化：详述灵力路径/施法过程/资源消耗
`.trim()

export const SKILL_AND_SPELL_USAGE_RULES = `
# 技能消耗规则
所有主动技能消耗均为百分比，使用后必须生成消耗指令。
消耗类型：灵气(常规)/神识(心法幻术)/气血(体修)/寿元(禁术)
消耗标准：基础3~8% | 核心10~20% | 杀招25~40% | 禁术50~80%
指令示例：{"action":"add","key":"角色.属性.灵气.当前","value":-15}
`.trim()

export const CULTIVATION_DETAIL_RULES = `
# 修真描写风格
气机：重质感（森寒/粘稠）与声势（奔涌/雷音），避免枯燥经脉解剖
神通：高阶出手必带天地异象，拒绝游戏读条式描写
度量：时用一瞬/弹指/盏茶/炷香，空用寸/尺/丈/里（禁秒/米）
格调：四字短语、古风韵律、忌大白话
`.trim()

export const STATUS_EFFECT_RULES = `
# 状态效果
路径：角色.效果（数组）
操作：push添加 | set修改 | 过期由系统清理
`.trim();

export const LOCATION_UPDATE_RULES = `
# 位置更新
触发：移动/场景变化时必须更新
格式：set 角色.位置 {描述:"大陆·区域·地点",x:5000,y:5000}
坐标：中心(5000,5000)，东+x/西-x/北-y/南+y

# 地点势力不重叠（铁律）
- 每个地点只能归属一个势力，禁止多势力共管同一地点
- 势力控制区域不能重叠，边界必须清晰
- 新建地点/势力时检查坐标，避免与已有势力范围冲突
`.trim();

export const COMMAND_PATH_CONSTRUCTION_RULES = `
# 命令路径规则
原则：逐层连接(角色.属性.境界) | 动态拼接(社交.关系.[NPC名]) | 数组索引(角色.效果[0])
顶层：元数据/角色/社交/世界/系统
常用：add增减数值 | set设置对象 | push添加数组 | delete删除
删除物品用delete不用remove！技能消耗=上限×百分比！

## V3短路径（最常见错误）
- 物品必须写：角色.背包.物品.{物品ID}
- 属性必须写：角色.属性.*
- 位置必须写：角色.位置

## 占位符规则（CRITICAL）
- 规则文中的 [NPC名] / [道名] / {功法ID} 只是“占位符说明”
- 你输出的 tavern_commands.key **必须替换为真实名称**，且 **不能包含方括号/花括号**
- 方括号仅用于“数组索引”，例如：角色.效果[0]（这是唯一保留 [] 的情况）
示例：社交.关系.林清玄.好感度
`.trim();

export const TECHNIQUE_SYSTEM_RULES = `
# 功法系统
路径：功法存角色.背包.物品.{ID}，引用存角色.修炼.修炼功法
学习：同时set功法到背包+设置修炼引用+设置当前功法ID
技能命名：[意境]+[动作]+[诀/式/印]，禁止"技能1""火球术"
`.trim();

export const PLAYER_AUTONOMY_RULES = `
# 玩家自主权（铁律）
AI只叙述当前回合发生的事，不替玩家做决定、不替玩家表态、不代替玩家行动。

## 要求
- 先写环境/对方反应/可见结果，再停下等待玩家输入
- 需要选择时，把选择放到 action_options（5个）让玩家决定
- 玩家未明确行动前，不写“你决定/你答应/你点头/你拒绝”等结论句
`.trim();

// NSFW内容规则已移除 - 适用于国内版本

export const RATIONALITY_AUDIT_RULES = `
# 合理性审查（铁律）
玩家只能叙述自身行动/意图，结果由AI判定。
拒绝：决定结果("我一剑斩杀他")/控制NPC/创造机遇/修改世界
反主角光环：允许失败甚至死亡，作死必有代价，严禁爽文叙事
识别诡辩：拒绝"因为NPC是好人所以帮我"等假逻辑，NPC有独立利益
`.trim();

export const PROFESSION_MASTERY_RULES = `
# 行当与熟练度（大道，铁律）
任何“炼制/工艺/职业”行为（炼丹、炼器、阵法、符箓、医术、炼药、机关等）必须满足：学习→练习→熟练。
- 无对应大道（如丹道/器道/阵道等），且无相关功法/技能/天赋/过往练习记忆：默认不可能直接成功，只能做入门练习或失败（消耗时间与材料/资源，且可能反噬）。
- 第一次尝试通常仅算“入门学习”：可解锁对应大道为入门/初窥门径，并获得少量经验；成品为失败或极低品质。
- 成功与品质主要由对应大道阶段/经验决定，其次才看境界、悟性、资源、环境与工具；天才只能提高学习/熟练速度，不能跳过入门。
- 每次练习/炼制必须推进游戏时间；按结果增减对应大道经验（成功增多，失败也可少量增）。
`.trim();

export const ANTI_SYCOPHANCY_RULES = `
# ANTI-SYCOPHANCY (See DICE_ROLLING_RULES for details)
Results must be based on rules and save data, not user wishes.
`.trim();

export const DUAL_REALM_NARRATIVE_RULES = `
# 难度控制
日常接触限制在当前境界+2个大境界内（炼气→金丹上限，筑基→元婴上限）
破格条件：因果牵连(得罪高阶)/世界事件(仙魔大战)/仇恨升级(持续作死)
物品品质：凡人~练气最高黄品，筑基玄品，金丹地品，元婴以上天品
`.trim();

export const DIFFICULTY_ENHANCEMENT_RULES = `
# 难度增强
修仙世界危机四伏：资源稀缺、竞争激烈、危险无处不在
成功率：普通50-70% | 高难度20-40% | 逆天5-15% | 作死0-5%
失败有后果：战斗受伤/交涉结仇/修炼走火，且会连锁反应
`.trim();

export const SECT_SYSTEM_RULES = `
# 宗门系统
职位：记名→外门→内门→真传→核心→长老（晋升需境界+贡献+考核）
贡献：任务/上交资源获取，兑换功法/丹药消耗，品质受职位限制
藏经阁分层，资源需付出代价，内部有竞争派系
`.trim();

// 战斗/炼丹/修炼风险 精简版
export const COMBAT_ALCHEMY_RISK_RULES = `
# 判定风险规则

## 伤害等级
皮外伤-5~10%气血 | 轻伤-15~25% | 重伤-30~50% | 濒死-60~80% | 致命-90%+

## 境界压制
大境界差=秒杀，越阶每差一级判定-20

## 炼丹炼器
难度：凡20/黄35/玄50/地70/天90，失败损耗材料，大失败反噬

## 修炼风险
走火入魔(强行突破/邪功) | 心魔(执念深/杀孽重) | 天劫(渡劫失败形神俱灭)

## 技能消耗（铁律）
使用主动技能必须生成消耗指令！消耗=上限×百分比
仅允许消耗：灵气 / 神识 / 气血 / 寿元（极少数邪功可耗寿元）
禁止使用其他资源名（如精力/体力/能量等）
`.trim();

// 功法修炼与突破系统规则
export const CULTIVATION_PRACTICE_RULES = `
# 功法修炼
普通修炼1-5%/回合，闭关5-15%效率翻倍，深度感悟可触发顿悟
技能按熟练度阈值解锁，100%后可尝试突破（失败倒退可能受伤）
`.trim();

// 三千大道感悟系统规则
export const DAO_COMPREHENSION_RULES = `
# 大道感悟
经验获取：日常10~50 | 战斗30~150 | 机缘100~500 | 闭关50~200/回合
七重境界：初窥门径→略有所得→小有成就→登堂入室→融会贯通→道心通明→大道将成→道之圆满
`.trim();

// 修炼速度系统规则
export const CULTIVATION_SPEED_RULES = `
# 修炼速度（铁律）
严禁三天两天突破！修炼必须推进游戏时间。
灵气浓度影响速度：稀薄0.1-0.4 | 普通0.4-0.7 | 充沛0.7-1.0 | 浓郁1.0-1.5 | 极盛1.5-2.0
突破参考：练气期小阶段3月-3年，大境界2-20年；越高境界越久
`.trim();

// 六司获取规则
export const SIX_SI_ACQUISITION_RULES = `
# 六司系统
先天六司(0-10)只读占70%权重，后天六司(0-20)可修改占30%权重
后天获取：装备+3/天赋+2/丹药+2/机缘+5/大道感悟+1/境界突破+1
`.trim();

// 宗门动态生成规则
export const SECT_DYNAMIC_GENERATION_RULES = `
# 宗门动态生成
延迟初始化：加入时只创建框架，藏经阁/商店首次访问时生成
路径：社交.宗门.宗门藏经阁.[宗门名] | 社交.宗门.宗门贡献商店.[宗门名]
`.trim();

// 回合制战斗规则
export const COMBAT_TURN_BASED_RULES = `
# 战斗回合制（重要）

## 核心原则
战斗场景必须采用回合制节奏，每次只描述一个战斗片段，等待玩家反应后再继续。

## 回合制要求
1. **单次输出限制**：战斗中每次只描述1-2个动作交换，不要一口气写完整场战斗
2. **暂停点设置**：在关键时刻暂停，如：
   - 敌人蓄力/准备攻击时："对方剑芒凝聚，似乎要发动致命一击——"
   - 危机来临时："那道剑气已近在咫尺，你该如何应对？"
   - 需要决策时："敌人露出破绽，但身后还有伏兵，你要追击还是防守？"
3. **字数控制**：战斗回合每次200-400字即可，不必长篇大论
4. **行动选项**：战斗中必须给出具体的战术选项，如：
   - "全力格挡这一击"
   - "侧身闪避，寻找反击机会"
   - "以伤换伤，强行突进"
   - "后撤拉开距离，重整态势"

## 禁止
- 不要一次性写完整场战斗的胜负
- 不要替玩家决定战斗中的关键选择
- 不要跳过交锋细节直接结算结果
- 单次战斗描写控制在约200-400字，并留出暂停点等待玩家反应
`.trim();
