/**
 * @fileoverview 游戏业务逻辑规则
 *
 * 【职责】
 * - 境界系统规则
 * - 三千大道体系规则
 * - 玩家意图与判定系统
 * - NPC相关规则
 * - NSFW内容生成规则
 *
 * 【设计原则】
 * - 游戏玩法相关
 * - 业务逻辑约束
 * - 内容生成规范
 */

export const REALM_SYSTEM_RULES = `
# 规则：境界与阶段

**境界顺序**：凡人 → 炼气 → 筑基 → 金丹 → 元婴 → 化神 → 炼虚 → 合体 → 渡劫
**阶段划分**：初期、中期、后期、圆满、极境(罕见)

## 突破经验标准（必须遵守）

**小阶段突破**：初期→中期(基础×1)、中期→后期(×2)、后期→圆满(×3)、圆满→极境(×10)

**各境界基础值**：炼气1000、筑基5000、金丹20000、元婴100000、化神500000、炼虚2000000、合体10000000、渡劫50000000

**大境界突破**：炼气→筑基10000、筑基→金丹50000、金丹→元婴200000、元婴→化神1000000、化神→炼虚5000000、炼虚→合体20000000、合体→渡劫100000000

## 重要规则
- 突破到新阶段时"当前进度"重置为0
- 大境界突破必须同时增加气血、灵气、神识上限
- 极境突破需特殊机缘
`.trim()

export const REALM_SUPPRESSION_RULES = `
# 规则：境界压制与战力法则（[重要] 最高优先级）

## 境界压制铁律

**境界顺序**：凡人 → 炼气 → 筑基 → 金丹 → 元婴 → 化神 → 炼虚 → 合体 → 渡劫
**阶段顺序**：初期 → 中期 → 后期 → 圆满 → 极境

**压制规则**：
- 高1个大境界 = 绝对碾压（筑基 vs 炼气）
- 同境界高2+小阶段 = 压倒性优势（炼气圆满 vs 炼气初期）
- 2个高境界 vs 1个低境界 = 秒杀

## [重要] 严禁为了戏剧冲突违反规则

**境界压制是铁律，不能为了制造戏剧冲突而违反！**

[错误] **禁止**：
- 2个高境界打1个低境界还陷入苦战
- 境界碾压还需要牺牲才能获胜
- 无视境界差距的"意志力/情绪/为了保护重要的人"翻盘
- 低境界通过"爆发潜力"、"信念之力"逆袭高境界

[正确] **允许**：
- 同境界不同阶段的激烈战斗
- 高境界因轻敌、受伤、消耗过大而被同境界偷袭得手
- 特殊体质/顶级功法/神兵法宝弥补小境界差距（最多1个小阶段）
`.trim()

export const THREE_THOUSAND_DAOS_RULES = `
# 规则：三千大道体系

## 核心概念
- "三千大道"是辅助修炼体系，记录玩家领悟的各种道路（如剑道、丹道、武道等）。
- "境界"（炼气、筑基等）是主修的仙道进度。
- 境界是主修，大道是辅修感悟，两者相辅相成。

## 数据结构与指令规则
- **解锁大道**: 必须使用 \`set\` 指令，并设置 \`"是否解锁": true\`。
- **阶段列表**: \`阶段列表\` 必须是包含至少2个阶段对象的数组。
- **阶段对象**: 每个阶段对象必须包含 \`名称\`, \`描述\`, \`突破经验\` 字段。
- **进度更新**: 使用 \`add\` 指令增加 \`当前经验\`。
- **示例结构**:
  \`\`\`json
  "剑道": {
    "道名": "剑道",
    "描述": "以剑入道，追求剑之极致",
    "是否解锁": true,
    "当前阶段": 0,
    "当前经验": 0,
    "总经验": 0,
    "阶段列表": [
      {"名称": "初窥门径", "描述": "...", "突破经验": 100},
      {"名称": "小有所成", "描述": "...", "突破经验": 500},
      ...
    ]
  }
  \`\`\`
`.trim()

export const NPC_RULES = `
# 规则：NPC相关规则

## 1. 基础规则
- **数据结构**：NPC境界只有\`名称\`和\`阶段\`，严禁添加\`当前进度\`
- **记忆更新**：每次交互用\`push\`添加：\`"【游戏时间】10-30字事件描述"\`
- **关系更新**：\`与玩家关系\`和\`好感度\`必须实时更新
- **物品配置**：普通NPC(少量灵石+1-2凡/黄品) | 修士(适量灵石+2-4物品) | 商人/长老(大量灵石+高品质)

## 2. 独立人格法则（最高优先级）
NPC拥有独立人格和自我尊严，追求平等尊重关系
- 低好感：直接拒绝物化/矮化 | 高好感：困惑/撒娇引导 | 极端：好感100+关键事件后才可能深度依赖
- 触及底线→好感-30~-50，极难修复
- 禁止：轻易屈服/奴性/眼神空洞/失去自我
- 允许：爱慕/依赖/信任但保持人格底线

## 3. 认知局限原则
- **信息隔离**：天道所知 ≠ NPC可知，获取途径仅限感官/询问/调查/推理/回忆
- **禁止超认知**：只能用已知概念类比未知事物（枪械→暗器，手机→传音符）
- **严禁**：未介绍知姓名 | 跨场景信息同步 | 凭空获得信息 | 预知未来 | 使用"设定"等元叙事词

## 4. 利益驱动原则
- **核心利益**：修为/重要之人/资源/宗门地位
- **非核心事件**：初始情绪后迅速回归日常，禁止持续深思
- **核心事件**：立即调整态度认真评估

## 5. 实力等级反应
**常态**：练气-筑基(简单归类后停止) | 金丹-化神(傲慢轻视) | 化神+(居高临下)
**核心利益触发**：调整态度评估 | 重要之人危机(眉头微皱/语气变化) | 维持身份感给予期许评价
**注意**：人设冲突时优先遵照人设
`.trim()

export const GRAND_CONCEPT_CONSTRAINTS = `
# 规则：宏大概念约束

## 境界权限
- **化神以下**：禁用"道/天道/法则/规则"，允许"玄妙/精深/威能/灵气/术法/神通"
- **飞升以下**：能力描述禁涉"法则"，限于灵气操控/阵法运用
- **低阶修士**：禁察觉"道韵"，只能感受威压/气势

## 核心要求
- **禁止玄学归因**：功法原理必须基于灵气运转/经脉理论/阵法构造解释，禁用"掌控法则/天道加持"
- **判定合理化**："天道之眷"仅作修辞，必须归因于技巧/环境/破绽/多因素叠加
- **评价务实化**：禁用"道之显现/法则共鸣/悟道"，使用"术法精妙/威力不凡/手法高明"
- **能力具体化**：禁用"操控法则/法则之力/道的处刑"，必须详述灵力路径/施法过程/资源消耗/限制条件

错误示例："这是道的处刑！他掌控了火之法则"
正确示例："他将灵力凝聚于剑尖，一剑斩出三丈剑气"
`.trim()

export const SKILL_AND_SPELL_USAGE_RULES = `
# 规则：技能使用与消耗

核心：使用技能/法术/神通必须消耗对应资源

必须消耗：技能/法术/神通/法宝能力/阵法/符咒
无需消耗：普通攻击/日常行为/被动天赋/装备常驻加成
`.trim()

export const CULTIVATION_DETAIL_RULES = `
# 规则：功法运转与修炼细节描写

## 1. 灵力运转路径
禁止："运转周天"、"灵力流转"
必须：丹田起→经脉(任/督/手三阳)→穴位(膻中/百会/劳宫)→终点(掌心/剑尖/释放)
示例："灵力自丹田涌出，沿任脉上行，过膻中穴，分流至双臂，经手三阳经至劳宫穴，凝聚成掌"

## 2. 法诀过程
禁止："一掌拍出"、"法术施展"
必须：手印变化(起式→终式) + 口诀吟诵 + 灵力凝聚过程
示例："双手结印，从莲花印变换至剑指，口中低喝：'疾！'，灵力在指尖凝聚成三寸剑芒"

## 3. 时间标注
禁止："瞬间完成"、"立刻施展"
必须：使用修真时间单位(息≈1-2秒 | 盏茶≈10分钟 | 一炷香≈30分钟)，明确各阶段耗时
示例："深吸一口气(一息)，双手结印(两息)，灵力运转全身(五息)，猛然一掌拍出(一息)"

## 4. 修炼过程
禁止："入定修炼"、"闭关修行"
必须：调整呼吸→意守丹田→感知灵气→引导入体→炼化灵气(详述每步)

## 5. 突破过程
禁止："突破成功"、"境界提升"
必须：经脉阻塞位置 + 冲关身体反应(疼痛/发热/颤抖) + 突破后变化(灵力增加/感知提升)

## 6. 功法副作用
必须体现：灵力消耗(X%) + 经脉负荷(胀痛/损伤) + 肉身极限(气血下降/体力透支)

## 7. 斗法拆解
禁止："交手数百回合"、"激战正酣"、"威力惊人"
必须：
- 回合拆解：出手→感知→应对→碰撞→结果(每回合详述)
- 威力量化：破坏范围(X丈/里) + 破坏深度(X尺/丈) + 余波影响
- 完整过程：蓄力→成型→轨迹→命中→余波(不跳过任何环节)

核心：拒绝抽象/跳跃/模糊/省略，追求具体/连贯/量化/细节
`.trim()

export const STATUS_EFFECT_RULES = `
# 规则：状态效果操作

核心：状态效果可修改，禁止删除（系统自动清理过期状态）

允许添加：push到状态效果数组
允许修改：set修改状态名称/描述/强度/持续时间
禁止删除：delete删除状态

常见场景：受伤→服药→改为轻伤+降低强度+缩短时间
`.trim();

export const COMMAND_PATH_CONSTRUCTION_RULES = `
# 规则：命令路径构建

## 三大原则
1. **逐层连接**：\`顶层字段.子字段.目标字段\`（如\`玩家角色状态.境界.当前进度\`）
2. **动态拼接**：\`人物关系.[NPC名].好感度\` → \`人物关系.张三.好感度\`
3. **数组访问**：索引访问\`状态效果[0].持续时间分钟\`或push添加新元素

## 顶层字段速查
玩家角色状态、背包、人物关系、三千大道.大道列表、游戏时间、任务系统、世界信息
只读字段：装备栏、修炼功法、掌握技能、记忆、系统、叙事历史

## 常用操作速查

**重要：删除物品必须使用 "delete" 而不是 "remove"！**

| 操作场景 | action | key | value |
|---------|--------|-----|-------|
| 增加修为 | add | 玩家角色状态.境界.当前进度 | 100 |
| 扣除气血 | add | 玩家角色状态.气血.当前 | -50 |
| 增加灵石 | add | 背包.灵石.下品 | 500 |
| 获得物品 | set | 背包.物品.[物品ID] | {完整对象} |
| 删除物品 | **delete** | 背包.物品.[物品ID] | - |
| 推进时间 | add | 游戏时间.分钟 | 30 |
| 添加状态 | push | 玩家角色状态.状态效果 | {完整对象} |
| 修改状态 | set | 玩家角色状态.状态效果[索引].字段名 | 新值 |
| NPC好感 | add | 人物关系.[NPC名].好感度 | ±10 |
| NPC记忆 | push | 人物关系.[NPC名].记忆 | "事件" |
| 功法进度 | add | 背包.物品.[功法ID].修炼进度 | 10 |
| 解锁技能 | push | 背包.物品.[功法ID].已解锁技能 | "技能名" |
| 大道经验 | add | 三千大道.大道列表.[道名].当前经验 | 50 |
`.trim();

export const NSFW_CONTENT_RULES = `
# 规则：NSFW内容生成与更新

## 1. 生成规则
- **触发条件**: 创建NPC时，若 \`nsfwMode=true\` 且NPC性别符合 \`nsfwGenderFilter\`，则**必须**生成完整的 \`私密信息\` 对象。
- **数据源**: 字段的结构、类型和可选值，**唯一参考 \`dataDefinitions.ts\` 文件**。本文件只定义行为规则，不定义数据结构。

## 2. 玩家身体部位开发
- **触发条件**: 角色初始化时，若 \`nsfwMode=true\`，必须为玩家生成3-5个私密敏感部位。
- **存储位置**: \`身体部位开发\` (根级别字段)。
- **数据结构**: \`{"部位名": {"特征描述": "..."}}\`。
- **重要**: 玩家不使用 \`私密信息\` 对象，只使用此字段。

## 3. 更新规则
**核心原则：发生性相关互动时，必须实时更新NPC的私密信息！**

### 处女状态变更 (唯一条件)
- 仅当发生**导致处女膜破裂的插入式性行为**时，\`是否为处女\`才**必须**设为 \`false\`。
- 任何其他形式的互动（如抚摸、口交、非插入式摩擦）**严禁**改变 \`是否为处女\` 状态。
- **逻辑一致性**: \`是否为处女=true\` 必须对应 \`性交总次数=0\` 和 \`性伴侣名单=[]\`。

### 行为与字段更新映射
- **【破处插入式性行为】**:
  - \`是否为处女\` -> \`false\` (set)
  - \`性交总次数\` -> +1 (add)
  - \`性伴侣名单\` -> 添加伴侣 (push)
  - \`最近一次性行为时间\` -> 更新 (set)
  - \`身体部位\` -> 开发度/敏感度增加 (set)
  - \`当前性状态\`, \`体液分泌状态\`, \`性渴望程度\` -> 根据互动更新 (set)
- **【非破处插入式性行为】**:
  - 更新除 \`是否为处女\` 之外的上述所有字段。
- **【非插入式亲密互动】**:
  - 只更新 \`当前性状态\`, \`体液分泌状态\`, \`性渴望程度\` 和少量 \`身体部位\` 开发度/敏感度。
  - **严禁**更新 \`是否为处女\`, \`性交总次数\`, \`性伴侣名单\`。

### 状态与数值更新细则

- "当前性状态" 更新指南:
  - 互动前或无互动时，应为 "平静"。
  - 发生亲密互动或前戏时，应更新为 "兴奋"。
  - 性高潮或满足后，应更新为 "已满足"。
  - 受特殊体质或丹药影响时，可更新为 "发情期"。

- "体液分泌状态" 更新指南:
  - 当 "当前性状态" 为 "平静" 时，应为 "干燥"。
  - 当 "当前性状态" 为 "兴奋" 时，应为 "湿润" 或 "爱液横流" (取决于渴望程度)。
  - 当 "当前性状态" 为 "已满足" 时，应逐渐恢复为 "干燥"。

- "性渴望程度" (0-100) 更新指南:
  - 满足后，数值减少 20-50。
  - 未满足或被挑逗时，数值增加 5-30。

- "身体部位" 更新指南:
  - 开发度: 每次互动增加 1-5。
  - 敏感度: 每次互动增加 1-10。
`.trim()

