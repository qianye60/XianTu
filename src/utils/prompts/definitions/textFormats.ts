/**
 * @fileoverview 文本格式规范
 *
 * 【职责】
 * - 文本格式标记（环境、内心、对话、判定）
 * - 命名约定（物品ID、位置、品质）
 * - 判定系统规则
 *
 * 【设计原则】
 * - 纯格式规范
 * - 命名标准
 * - 文本表现形式
 */

export const TEXT_FORMAT_MARKERS = `
# 文本格式标记

- 环境描写: \`【...】\`
- 内心思考: \`\`...\`\`
- 角色对话: \`"..."\`
- 系统判定: \`〖...〗\`

## 系统判定格式

### 统一格式
\`〖判定类型:结果,字段1:值1,字段2:值2,...〗\`

### 可用字段列表

**核心字段（必须）：**
- **判定类型**：战斗判定、修炼判定、技艺判定、社交判定、探索判定等
- **结果**：大失败、失败、成功、大成功、完美
- **判定值**：最终判定值（所有加成+骰点的总和）
- **难度**：目标难度值，**必须带等级**，格式：\`数值(等级)\`，如 \`30(普通)\` \`50(困难)\`
- **骰点**：1d20随机骰点（1-20）

**基础计算字段（强烈推荐，必须注明来源）：**
- **先天**：先天六司加成（权重100%），格式：\`数值(来源)\`，如 \`14(根骨×100%)\`
- **后天**：后天六司加成（权重20%），格式：\`数值(来源)\`，如 \`3(后天根骨×20%)\`
- **境界**：境界等级加成，格式：\`数值(境界名)\`，如 \`5(炼气期)\` \`12(筑基初期)\`
- **装备**：装备法器加成，格式：\`数值(装备名)\`，如 \`8(玄铁剑)\`
- **功法**：功法技能加成，格式：\`数值(功法名)\`，如 \`10(基础剑诀)\`
- **状态**：buff/debuff加成，格式：\`数值(状态名)\`，如 \`-2(疲惫)\` \`5(凝神静气)\`

**扩展字段（有显著影响时添加，值≥3）：**
- **大道**：大道相关（如大道阶段加成、大道感悟判定、大道冲突等）
- **灵根**：灵根相关（如灵根属性加成、灵根品级影响、灵根觉醒判定等）
- **天赋**：天赋相关（如特殊天赋加成、天赋触发、天赋觉醒判定等）
- **天资**：天资相关（如天资等级影响、天资判定等）
- **种族**：种族相关（如种族特性加成、种族天赋、种族压制等）
- **出生**：出生相关（如出身背景加成、家族资源、出身影响等）
- **气血**：气血相关（如气血充盈提升、受伤降低、气血对抗、气血恢复判定等）
- **灵气**：灵气相关（如灵气充沛提升、灵气不足降低、灵气对抗、灵气吸收判定等）
- **神识**：神识相关（如神识强大提升、神识不足降低、神识比拼、神识探查判定等）
- **寿命**：寿命相关（如寿命充足加成、寿命将尽降低、寿命延长判定等）
- **声望**：声望相关（如声望加成、声望判定、声望影响等）
- **宗门**：宗门相关（如宗门职位加成、宗门贡献、宗门资源、宗门任务判定等）
- **好感度**：好感度相关（如NPC好感影响、好感判定、关系变化等）
- **位置**：位置相关（如特殊地点加成、地形影响、位置判定等）

**特殊字段（根据判定结果添加）：**
- **新境界**：境界突破后的新境界（如"筑基初期"）
- **造成伤害**：战斗伤害值
- **剩余气血**：战斗后剩余气血（格式：当前/上限）
- **获得物品**：获得的物品（如"聚气丹×3"）
- 以及其他任何合理的自定义字段

### 字段使用原则
1. 字段顺序：核心字段 → 基础字段 → 扩展字段 → 特殊字段
2. 字段名可具体化：如"剑道"代替"大道"，"火灵根"代替"灵根"
3. 可合并相似影响：如"天赋+天资:5"
4. 格式规则：字段名:值，字段间用逗号分隔

### 示例

**修炼判定：**
\`〖修炼判定:成功,判定值:52,难度:35(普通),骰点:15,先天:14(悟性×100%),后天:2(后天悟性×20%),境界:7(炼气后期),装备:0,功法:8(基础炼体诀),状态:6(凝神静气)〗\`

**战斗判定：**
\`〖攻击判定:大成功,判定值:68,难度:35(普通),骰点:18,先天:16(根骨×100%),后天:3(后天根骨×20%),境界:12(筑基初期),装备:8(玄铁剑),功法:10(基础剑诀),状态:5(战意高昂)〗\`
\`〖伤害结算:命中,造成伤害:156,剩余气血:344/500〗\`

**技艺判定：**
\`〖炼丹判定:成功,判定值:47,难度:25(简单),骰点:14,先天:12(悟性×100%),后天:1(后天悟性×20%),境界:7(炼气后期),装备:3(炼丹炉),功法:8(基础丹诀),状态:2(心神宁静)〗\`

**境界突破：**
\`〖突破判定:成功,判定值:58,难度:50(困难),骰点:16,先天:12(悟性×100%),后天:4(后天悟性×20%),境界:7(炼气圆满),装备:3(聚灵阵),功法:12(青云诀),状态:4(灵气充沛),新境界:筑基初期〗\`

### 核心规则
1. 判定类型和结果之间只有一个冒号
2. 字段之间用逗号分隔
3. 字段名和值之间用冒号分隔
4. 结果等级：大失败、失败、成功、大成功、完美
5. **难度必须带等级**：格式 \`数值(等级)\`，如 \`30(普通)\`
6. **加成必须注明来源**：格式 \`数值(来源)\`，如 \`14(根骨×100%)\` \`5(炼气期)\`

### 判定触发原则
**需要判定：**
- 战斗对抗（攻击、防御、施法）
- 修炼突破（境界、功法、大道）
- 技能使用（炼丹、炼器、阵法、符箓）
- 社交博弈（说服、欺骗、威慑，对方有抵抗意图）
- 探索冒险（寻宝、破阵、解谜、危险环境）
- 资源竞争（拍卖、争夺、机缘）

**不需判定：**
- 日常对话、闲聊
- 正常移动、走路、飞行（无危险）
- 休息、睡觉、打坐、冥想
- 购买物品、交易（价格明确）
- 查看信息、阅读、观察
- 使用已掌握的基础技能（无挑战性）
`.trim()

export const JUDGMENT_RULES = `
# 判定系统规则

## 难度等级

| 等级 | 数值范围 | 场景 | 成功率 |
|-----|---------|------|--------|
| 极易 | ≤10 | 日常小事 | 95%+ |
| 简单 | 11-20 | 可控挑战 | 70-80% |
| 普通 | 21-35 | 需认真对待 | 50-60% |
| 困难 | 36-50 | 较大风险 | 30-40% |
| 艰难 | 51-70 | 极限挑战 | 10-20% |
| 极难 | 71-90 | 需要奇迹 | <5% |
| 几乎不可能 | >90 | 几乎无望 | <1% |

**难度调整：** 境界压制每高/低1大境界±30难度，境界压制每高/低1小阶段±5难度

**输出格式：** 难度值后必须带括号注明等级，如 \`30(普通)\` \`50(困难)\` \`70(艰难)\`

## 判定值计算

### 基础公式
\`\`\`
判定值 = 先天 + 后天 + 境界 + 装备 + 功法 + 状态 + 骰点(1d20) + [扩展因素]
\`\`\`

### 先天加成
根据判定类型加权计算：
- 战斗：根骨×0.5 + 灵性×0.3 + 气运×0.2
- 修炼：悟性×0.5 + 灵性×0.3 + 心性×0.2
- 技艺：悟性×0.5 + 根骨×0.3 + 灵性×0.2
- 社交：魅力×0.5 + 悟性×0.3 + 心性×0.2
- 探索：气运×0.5 + 灵性×0.3 + 悟性×0.2

### 后天加成
对应后天六司加权计算 ÷ 5

### 境界加成
凡人0 | 炼气5 | 筑基12 | 金丹20 | 元婴30 | 化神42 | 炼虚56 | 合体72 | 渡劫90
阶段：初期+0 | 中期+2 | 后期+4 | 圆满+6 | 极境+8

### 装备加成
从装备栏读取"装备增幅"相关属性之和

### 功法加成
品质：凡2 | 黄5 | 玄10 | 地18 | 天28 | 仙40 | 神55
熟练度：入门0 | 熟练3 | 精通6 | 大师10 | 宗师15

### 状态加成
\`\`\`
状态加成 = Σ(buff强度) - Σ(debuff强度)
\`\`\`

### 扩展因素
大道、灵根、天赋、天资、种族、出生、气血、灵气、神识、寿命、声望、宗门、好感度、位置等（值≥3时添加）

## 结果判定

| 结果 | 条件 | 效果 |
|-----|------|------|
| 大失败 | 骰点1-2 | 必败+负面后果 |
| 失败 | 判定值 < 难度 | 未达成 |
| 成功 | 判定值 ≥ 难度 | 达成目标 |
| 大成功 | 判定值 ≥ 难度+15 | 超额+额外收益 |
| 完美 | 骰点19-20 | 必成+额外奖励 |

## 战斗伤害计算
\`\`\`
基础伤害 = (根骨 + 灵性) × 境界系数 + 武器伤害
实际伤害 = 基础伤害 - (对方根骨 + 护甲) × 境界系数
境界系数：炼气1 | 筑基2 | 金丹4 | 元婴8 | 化神15 | 炼虚25 | 合体40 | 渡劫60
\`\`\`
`.trim()

export const NAMING_CONVENTIONS = `
# 命名约定

物品ID:\`类型_数字\` | 位置:\`大陆·地点\` | 品质:\`{"quality":"凡~神","grade":0-10}\`
`.trim()

export const TEXT_FORMATS = `
# 【文本格式与命名】

${TEXT_FORMAT_MARKERS}

${JUDGMENT_RULES}

${NAMING_CONVENTIONS}
`.trim()
