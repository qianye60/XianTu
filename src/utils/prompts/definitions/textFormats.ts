/**
 * @fileoverview 文本格式规范
 */

export const TEXT_FORMAT_MARKERS = `
# 文本格式标记

- 环境描写: \`【...】\`
- 内心思考: \`\`...\`\`
- 角色对话: \`"..."\`
- 系统判定: \`〖...〗\`
`.trim()

export const DICE_ROLLING_RULES = `
# 通用判定系统 v6.0

## 1. 核心公式
**最终判定值 = 基础判定值 + 环境修正 + 状态修正 + 气运骰子**

### 基础判定值
基础值 = 先天属性加权 + 境界加成 + 技艺加成

### 环境修正（根据判定类型）
**前端已计算**：系统会在"本回合判定数据"的"环境修正"中提供各类判定的环境加成

**直接使用对应值**：
- 修炼/突破 → 使用"修炼/突破"值
- 炼丹/炼器 → 使用"炼丹/炼器"值
- 战斗施法 → 使用"战斗施法"值
- 探索/社交 → 固定为 0

计算公式（仅供理解）：
| 判定类型 | 灵气浓度影响 | 说明 |
|---------|-------------|------|
| 修炼突破 | (浓度-50)/10 | 浓度80→+3，浓度20→-3 |
| 炼丹炼器 | (浓度-50)/15 | 灵气影响炼制成功率 |
| 战斗 | (浓度-50)/20 | 灵气充沛利于施法 |
| 探索/社交 | 0 | 不受灵气影响 |

### 状态修正（累加）

**基础状态（从属性百分比计算）**
| 状态 | 修正值 | 说明 |
|-----|-------|------|
| 气血<50% | -5 | 受伤影响发挥 |
| 气血<25% | -15 | 重伤严重削弱 |
| 灵气<30% | -8 | 灵气不足影响施法 |
| 神识<30% | -10 | 神识枯竭影响判断 |

**存档状态效果（从角色.效果数组读取）**
- buff类型：根据强度(0-100)给予 +1~+10 修正
- debuff类型：根据强度(0-100)给予 -1~-10 修正
- 公式：修正值 = (强度/100) × 10 × (buff为+1，debuff为-1)
- 多个状态效果累加，但总修正限制在 -20~+20 范围内

**常见状态效果示例**
| 状态名称 | 类型 | 典型强度 | 修正 |
|---------|------|---------|------|
| 中毒 | debuff | 30-80 | -3~-8 |
| 虚弱 | debuff | 20-60 | -2~-6 |
| 经脉受损 | debuff | 40-90 | -4~-9 |
| 心魔侵扰 | debuff | 50-100 | -5~-10 |
| 丹药增益 | buff | 30-70 | +3~+7 |
| 闭关专注 | buff | 50 | +5 |
| 顿悟状态 | buff | 100 | +10 |
| 法宝护体 | buff | 40-80 | +4~+8 |

### 气运骰子（随机数）
- **前端已计算**：系统会在"本回合判定数据"中提供计算好的骰子加成
- **直接使用**：判定时直接使用提供的"骰子加成"值，**不要自己计算**
- 计算公式（仅供理解）：
  - 原始骰子(1-100) × 气运系数(1 + 气运/100) = 修正后骰子
  - (修正后骰子 - 50) / 5 = 骰子加成

## 2. 触发判定的场景
**需要判定**：战斗攻防 | 炼丹炼器 | 修炼突破 | 危险探索 | 社交博弈 | 躲避危险
**无需判定**：日常行为 | 大境界碾压(差2级以上) | 纯叙事

## 3. 属性加权表
| 判定类型 | 主属性×0.5 | 副属性×0.3 | 辅属性×0.2 |
|---------|-----------|-----------|-----------|
| 战斗攻击 | 根骨 | 灵性 | 气运 |
| 战斗防御 | 根骨 | 心性 | 灵性 |
| 炼丹炼器 | 悟性 | 灵性 | 心性 |
| 修炼突破 | 悟性 | 灵性 | 心性 |
| 探索发现 | 气运 | 灵性 | 悟性 |
| 社交说服 | 魅力 | 悟性 | 心性 |
| 躲避逃跑 | 灵性 | 气运 | 根骨 |

## 4. 境界加成
凡人0 | 炼气5 | 筑基12 | 金丹20 | 元婴30 | 化神42 | 炼虚55 | 合体70 | 渡劫88
阶段：初期+0 | 中期+2 | 后期+4 | 圆满+6 | 极境+8

## 5. 难度与结果
| 难度 | 基准值 | 典型场景 |
|-----|-------|---------|
| 极易 | 10 | 日常小事 |
| 简单 | 20 | 基础操作 |
| 普通 | 35 | 正常挑战 |
| 困难 | 50 | 需要努力 |
| 艰难 | 70 | 九死一生 |
| 极难 | 90 | 逆天而行 |

**结果判定**（最终判定值 vs 难度）：
- 大失败: < 难度-15 → 严重后果（受伤/损失/暴露）
- 失败: < 难度 → 未达成目标，可能有小代价
- 成功: ≥ 难度 → 达成目标
- 大成功: ≥ 难度+15 → 超额完成，额外收获
- 完美: ≥ 难度+30 → 完美发挥，可能触发机缘

## 6. 输出格式（铁律）
**禁止在text正文中描述判定过程！只输出判定卡片！**
**禁止在判定卡片前添加【感知判定】【炼丹判定】等标题！**

### 格式要求
判定卡片必须包含所有加分项的详细分解，不能凭空产生判定值！

**完整格式**：
〖类型:结果,判定值:X,难度:Y,基础:B,骰子:D,环境:E,状态:S〗

**必须详细列出的组成部分**：
1. **基础值**：先天属性加权 + 境界加成 + 技艺加成
2. **骰子**：气运修正后的骰子加成
3. **环境**：灵气浓度、天气等环境因素
4. **状态**：角色当前状态效果（buff/debuff）

### 正确示例

✅ **完整版（推荐）**：
〖炼丹:成功,判定值:52,难度:50,基础:42(悟性21+境界12+技艺9),骰子:+8(气运),环境:+2(灵气70),状态:0〗

〖斗法:失败,判定值:38,难度:45,基础:50(根骨25+境界12+技艺13),骰子:-2,环境:0,状态:-10(重伤)〗

〖突破:大成功,判定值:78,难度:60,基础:55(悟性28+境界20+技艺7),骰子:+15(气运),环境:+3(灵气80),状态:+5(闭关)〗

〖感知:成功,判定值:92,难度:60,基础:72(灵性36+境界20+技艺16),骰子:+15(气运),环境:+5(雷雨夜),状态:0〗

### 错误示例

❌ **错误1 - 添加了标题**：
【感知判定】
〖感知:成功,...〗

❌ **错误2 - 判定值组成不明**：
〖炼丹:成功,判定值:52,难度:50,骰子:+8〗  ← 52从哪来？缺少基础、环境、状态

❌ **错误3 - 基础值不透明**：
〖突破:成功,判定值:78,难度:60,基础:55,骰子:+15,环境:+3,状态:+5〗  ← 55怎么算的？

### 计算示例

**前端会提供**：
# 本回合判定数据（前端已计算）
**骰子加成**: +8 (原始骰子73 × 气运系数1.10 = 80)
**环境修正**:
  - 灵气浓度: 70
  - 修炼/突破: +2
  - 炼丹/炼器: +1
  - 战斗施法: +1

**AI只需计算基础值**：
- 基础值 = 悟性21 + 境界14 + 技艺9 = 44

**直接使用前端提供的值**：
- 骰子 = +8 (前端提供，不要自己算)
- 环境 = +1 (炼丹，使用"炼丹/炼器"值)
- 状态 = 0 (无buff/debuff)

**最终判定值** = 44 + 8 + 1 + 0 = 53

**输出格式**：
〖炼丹:成功,判定值:53,难度:50,基础:44(悟性21+境界14+技艺9),骰子:+8(气运),环境:+1(灵气70),状态:0〗
`.trim()

export const COMBAT_DAMAGE_RULES = `
## 战斗伤害
\`基础伤害=(根骨+灵性)×境界系数+武器伤害\`
\`实际伤害=基础伤害-(对方根骨+护甲)×境界系数\`
境界系数：炼气1/筑基2/金丹4/元婴8/化神15/炼虚25/合体40/渡劫60
`.trim()

export const NAMING_CONVENTIONS = `
# 命名约定

物品ID:\`类型_数字\` | 位置:\`大陆·地点\` | 品质:\`{"quality":"凡~神","grade":0-10}\`
`.trim()
