/**
 * å¢å¼ºçš„ä¸–ç•Œç”Ÿæˆæç¤ºè¯ç³»ç»Ÿ
 * è§£å†³åŠ¿åŠ›é‡å¤ã€å‘½åå›ºåŒ–ã€è§„æ¨¡ä¸åˆç†ç­‰é—®é¢˜
 * æ”¯æŒä¸åŒä¿®ä»™ä¸–ç•ŒèƒŒæ™¯é€‚é…
 */

export interface WorldPromptConfig {
  factionCount: number;
  totalLocations: number;
  secretRealms: number;
  characterBackground?: string;
  worldBackground?: string;
  worldEra?: string;
  worldName?: string;
}

export class EnhancedWorldPromptBuilder {
  /**
   * æ ¹æ®ä¸–ç•ŒèƒŒæ™¯è·å–å‘½åé£æ ¼
   */
  private static getWorldStyle(worldBackground?: string): string {
    if (!worldBackground) {
      return 'ä¼ ç»Ÿå¤é£ä¿®ä»™';
    }
    
    const background = worldBackground.toLowerCase();
    
    if (background.includes('éƒ½å¸‚') || background.includes('ç°ä»£') || background.includes('åŸå¸‚')) {
      return 'ç°ä»£éƒ½å¸‚ä¿®ä»™';
    }
    
    if (background.includes('ç§‘å¹»') || background.includes('æ˜Ÿé™…') || background.includes('æœªæ¥')) {
      return 'ç§‘å¹»æœªæ¥ä¿®ä»™';
    }
    
    if (background.includes('æ­¦ä¾ ') || background.includes('æ±Ÿæ¹–')) {
      return 'æ­¦ä¾ æ±Ÿæ¹–ä¿®ä»™';
    }
    
    if (background.includes('ç¥è¯') || background.includes('ä¸Šå¤') || background.includes('æ´ªè’')) {
      return 'ç¥è¯å¤å…¸ä¿®ä»™';
    }
    
    return 'ä¼ ç»Ÿå¤é£ä¿®ä»™';
  }

  static buildPrompt(config: WorldPromptConfig): string {
    // æ ¹æ®ä¸–ç•ŒèƒŒæ™¯è°ƒæ•´å‘½åé£æ ¼
    const worldBackgroundStyle = this.getWorldStyle(config.worldBackground);
    
    // ä½¿ç”¨ç”¨æˆ·é…ç½®çš„ç²¾ç¡®æ•°é‡ï¼Œä¸æ·»åŠ éšæœºå˜åŒ–é¿å…æ•°é‡å¤±æ§
    // ä¸¥æ ¼æŒ‰ç…§é…ç½®å€¼ç”Ÿæˆï¼Œç¡®ä¿AIçœ‹åˆ°çš„æ•°å­—æ˜¯æ­£ç¡®çš„
    const finalFactionCount = config.factionCount;
    const finalLocationCount = config.totalLocations; 
    const finalSecretRealmCount = Math.min(config.secretRealms, finalLocationCount); // ç‰¹æ®Šå±æ€§ä¸èƒ½è¶…è¿‡æ€»åœ°ç‚¹æ•°
    
    // åˆ é™¤å›ºå®šçš„åŠ¿åŠ›åˆ†çº§é™åˆ¶ï¼Œè®©AIè‡ªç„¶ç”Ÿæˆæœ‰å½±å“åŠ›çš„å¤§åŠ¿åŠ›
    
    // åŠ¨æ€è®¡ç®—åœ°ç‚¹åˆ†å¸ƒ
    const headquarters = finalFactionCount; // æ¯ä¸ªåŠ¿åŠ›ä¸€ä¸ªæ€»éƒ¨
    const remainingLocations = finalLocationCount - headquarters;
    const cities = Math.floor(remainingLocations * (0.2 + Math.random() * 0.3)); // 20%-50%
    const specialSites = Math.floor(remainingLocations * (0.15 + Math.random() * 0.25)); // 15%-40%
    const dangerZones = Math.floor(remainingLocations * (0.1 + Math.random() * 0.2)); // 10%-30%
    const otherSites = Math.max(0, remainingLocations - cities - specialSites - dangerZones);
    
    // åŠ¨æ€è®¡ç®—ç‰¹æ®Šå±æ€§åˆ†å¸ƒ
    const opportunityRealms = Math.floor(finalSecretRealmCount * (0.3 + Math.random() * 0.3)); // 30%-60%
    const heritageRealms = Math.floor(finalSecretRealmCount * (0.2 + Math.random() * 0.3)); // 20%-50%
    const dangerousRealms = Math.max(0, finalSecretRealmCount - opportunityRealms - heritageRealms);
    
    const backgroundInfo = config.characterBackground ? 
      `\nè§’è‰²å‡ºèº«: ${config.characterBackground}` : '';
    
    // ä¸–ç•ŒèƒŒæ™¯ä¿¡æ¯
    const worldBackgroundInfo = config.worldBackground ? 
      `\nä¸–ç•ŒèƒŒæ™¯: ${config.worldBackground}` : '';
    const worldEraInfo = config.worldEra ? 
      `\nä¸–ç•Œæ—¶ä»£: ${config.worldEra}` : '';
    const worldNameInfo = config.worldName ? 
      `\nä¸–ç•Œåç§°: ${config.worldName}` : '';

    // ç”Ÿæˆå”¯ä¸€çš„éšæœºç§å­ç¡®ä¿æ¯æ¬¡éƒ½ä¸åŒ
    const uniqueSeed = Date.now() + Math.floor(Math.random() * 1000000);
    const sessionId = Math.random().toString(36).substring(7);

    // è°ƒè¯•æ—¥å¿—
    console.log('[å¢å¼ºä¸–ç•Œç”Ÿæˆå™¨] æœ€ç»ˆæ•°é‡ - åŠ¿åŠ›:', finalFactionCount, 'åœ°ç‚¹:', finalLocationCount, 'ç‰¹æ®Šå±æ€§:', finalSecretRealmCount);
    console.log('[å¢å¼ºä¸–ç•Œç”Ÿæˆå™¨] ç”Ÿæˆç§å­:', uniqueSeed, 'ä¼šè¯ID:', sessionId);

    return `
# è¯¸å¤©ä¸‡ç•ŒåŠ¿åŠ›åœ°å›¾ç”Ÿæˆä»»åŠ¡

**ç”Ÿæˆä¼šè¯ID**: ${sessionId}
**éšæœºç§å­**: ${uniqueSeed}
**å…³é”®è¦æ±‚**: åˆ›é€ ç‹¬ç‰¹å¤šæ ·çš„ä¿®ä»™ä¸–ç•Œï¼Œæ¯æ¬¡ç”Ÿæˆå¿…é¡»æ˜¾è‘—ä¸åŒï¼Œé¿å…é‡å¤å›ºåŒ–çš„åŠ¿åŠ›å’Œåœ°å
**æ•°é‡é™åˆ¶**: ä¸¥æ ¼æŒ‰ç…§é…ç½®ç”Ÿæˆï¼ŒåŠ¿åŠ›${finalFactionCount}ä¸ªã€åœ°ç‚¹${finalLocationCount}ä¸ªï¼Œç»ä¸å¯è¶…å‡ºæ­¤æ•°é‡

## ä¸–ç•Œè®¾å®šä¿¡æ¯
${backgroundInfo}${worldBackgroundInfo}${worldEraInfo}${worldNameInfo}

## ğŸ¯ æ ¸å¿ƒç”ŸæˆåŸåˆ™

### 1. ã€ä¿®ä»™ä¸–ç•Œé€‚é…ã€‘- ${worldBackgroundStyle}é£æ ¼

å½“å‰ä¸–ç•ŒèƒŒæ™¯ä¸º**${worldBackgroundStyle}**ï¼Œæ‰€æœ‰ç”Ÿæˆå†…å®¹å¿…é¡»ç¬¦åˆä¿®ä»™ä½“ç³»å¹¶ç»“åˆèƒŒæ™¯ç‰¹è‰²ï¼š
- **æ ¸å¿ƒä½“ç³»**: ä¿®ä»™ã€å¢ƒç•Œã€åŠŸæ³•ã€ä¸¹è¯ã€æ³•å®ç­‰ä¼ ç»Ÿä¿®ä»™å…ƒç´ 
- **èƒŒæ™¯èåˆ**: æ ¹æ®ä¸–ç•ŒèƒŒæ™¯è°ƒæ•´åŠ¿åŠ›ç±»å‹å’Œåœ°ç‚¹é£æ ¼
- **å‘½åé£æ ¼**: ç¬¦åˆèƒŒæ™¯è®¾å®šçš„å‘½åæ–¹å¼
- **æƒåŠ›ç»“æ„**: å¼ºè€…ä¸ºå°Šçš„ä¿®ä»™ä¸–ç•Œç­‰çº§ç§©åº

### 2. ã€å¤šæ ·æ€§ç¬¬ä¸€ã€‘- é¿å…å›ºåŒ–æ¨¡å¼
- **åŠ¿åŠ›å¤šæ ·åŒ–**: æ¯æ¬¡ç”Ÿæˆä¸åŒç±»å‹çš„åŠ¿åŠ›ç»„åˆï¼Œé¿å…æ€»æ˜¯"é’äº‘å®—ã€å¤©å‰‘é—¨ã€ä¸‡èŠ±è°·"ç­‰é‡å¤åç§°
- **åœ°ååˆ›æ–°**: å®Œå…¨é¿å…ä½¿ç”¨æ¨¡æ¿åŒ–åœ°åï¼Œæ¯ä¸ªåç§°éƒ½è¦æœ‰ç‰¹è‰²ä¸”ç‹¬ä¸€æ— äºŒ
- **è§„æ¨¡å¹³è¡¡**: ä¿®ä»™ä¸–ç•Œä¸­å®—é—¨ä¸ºä¸»ï¼Œä½†è¦æ ¹æ®èƒŒæ™¯è°ƒæ•´è¡¨ç°å½¢å¼

### 3. ã€åŠ¿åŠ›è§„æ¨¡ã€‘- ç¬¦åˆä¿®ä»™ä½“ç³»è®¾å®š
æ ¹æ®ä¿®ä»™ä¸–ç•Œçš„åŸºæœ¬è§„å¾‹å’Œä¸–ç•ŒèƒŒæ™¯è°ƒæ•´åŠ¿åŠ›åˆ†å¸ƒï¼š

**ä¿®ä»™ä¸–ç•Œçš„åˆç†åŠ¿åŠ›åˆ†å¸ƒ**:
- ğŸ”ï¸ **å„å¤§å®—é—¨** (40-50%): ä¿®ä»™ä¸–ç•Œçš„ä¸»ä½“åŠ¿åŠ›
- ğŸ›ï¸ **ä¿®ä»™ä¸–å®¶** (20-30%): è¡€è„‰ä¼ æ‰¿ï¼Œåº•è•´æ·±åš
- âš”ï¸ **é­”é“åŠ¿åŠ›** (10-20%): ä¸æ­£é“å¯¹ç«‹çš„é»‘æš—åŠ›é‡
- ğŸ® **æ•£ä¿®è”ç›Ÿ** (10-15%): è‡ªç”±ä¿®å£«çš„æ¾æ•£ç»„ç»‡
- ğŸ’° **å•†ä¼šç»„ç»‡** (5-15%): è´¸æ˜“æµé€šï¼Œä¸­ç«‹åŠ¿åŠ›
- ğŸŒ¿ **å¦–æ—éƒ¨è½** (5-10%): éäººç§æ—ï¼Œè‡ªç„¶åŠ¿åŠ›

**é‡è¦**: æ ¹æ®ä¸–ç•ŒèƒŒæ™¯è°ƒæ•´å…·ä½“è¡¨ç°å½¢å¼ï¼Œä½†ä¿æŒä¿®ä»™ä½“ç³»çš„æ ¸å¿ƒï¼

## ğŸŒ åœ°ç†å±‚çº§ç»“æ„

### å¤§æ´²çº§åˆ«åŒºåŸŸ
ä¸ºäº†è¥é€ æ›´å®å¤§çš„ä¸–ç•Œè§‚ï¼Œéœ€è¦åˆ›é€ 2-8ä¸ªå¤§æ´²çº§åˆ«çš„åœ°ç†åŒºåŸŸæ¥åŒ…è£¹å„ä¸ªåŠ¿åŠ›ï¼š

**å¤§æ´²åˆ›é€ è¦æ±‚**ï¼š
- **æ•°é‡éšæœº**: æ ¹æ®åŠ¿åŠ›æ•°é‡å’Œä¸–ç•ŒèƒŒæ™¯ï¼Œè‡ªç”±å†³å®šåˆ›é€ 2-8ä¸ªå¤§æ´²
- **å‘½ååˆ›æ–°**: æ ¹æ®${worldBackgroundStyle}é£æ ¼åˆ›é€ ç‹¬ç‰¹çš„å¤§æ´²åç§°ï¼Œé¿å…ä½¿ç”¨"ä¸œè¥¿å—åŒ—"ç­‰æ–¹ä½è¯
- **åœ°ç†ç‰¹è‰²**: æ¯ä¸ªå¤§æ´²è¦æœ‰ç‹¬ç‰¹çš„åœ°ç†ç‰¹å¾ï¼ˆå¦‚ï¼šé›ªåŸŸã€æ²™æ¼ ã€æ£®æ—ã€æµ·å²›ç­‰ï¼‰
- **åŠ¿åŠ›åˆ†å¸ƒ**: æ¯ä¸ªå¤§æ´²åŒ…å«1-3ä¸ªä¸»è¦åŠ¿åŠ›ï¼Œå½¢æˆåœ°ç¼˜æ”¿æ²»æ ¼å±€
- **è¾¹ç•Œè®¾è®¡**: å¤§æ´²è¾¹ç•Œç”¨å¤§å‹ä¸è§„åˆ™å¤šè¾¹å½¢è¡¨ç¤ºï¼ˆ8-15ä¸ªåæ ‡ç‚¹ï¼‰ï¼Œå½¢çŠ¶è¦æœ‰å˜åŒ–
- **å±éšœè®¾ç½®**: å¤§æ´²ä¹‹é—´è¦æœ‰å¤©ç„¶å±éšœï¼ˆå±±è„‰ã€æµ·å³¡ã€ç˜´æ°”ã€ç»“ç•Œç­‰ï¼‰

**å¤§æ´²ç¤ºä¾‹é£æ ¼**ï¼š
- ä¼ ç»Ÿä¿®ä»™ï¼šå¦‚"é’éœå¤§é™†"ã€"ç´«è–‡æ˜ŸåŸŸ"ã€"ä¹å¤©ç„å¢ƒ"
- éƒ½å¸‚ä¿®ä»™ï¼šå¦‚"ä¸œäºšä¿®ä»™åŒº"ã€"æ¬§æ´²çµèƒ½å¸¦"ã€"ç¾æ´²è§‰é†’åœ°å¸¦"
- ç¥è¯å¤å…¸ï¼šå¦‚"å¤ªå¤ç¥åŸŸ"ã€"æ´ªè’å¤§åœ°"ã€"æ··æ²Œè¾¹ç–†"

## ğŸ“Š æœ¬æ¬¡ç”Ÿæˆå‚æ•° (ä¸¥æ ¼æŒ‰ç…§é…ç½®)
- **åŠ¿åŠ›æ€»æ•°**: å¿…é¡»ç²¾ç¡®ç”Ÿæˆ${finalFactionCount}ä¸ªåŠ¿åŠ›ï¼Œä¸å¤šä¸å°‘
- **åœ°ç‚¹æ€»æ•°**: å¿…é¡»ç²¾ç¡®ç”Ÿæˆ${finalLocationCount}ä¸ªåœ°ç‚¹ï¼Œä¸å¤šä¸å°‘  
- **ç‰¹æ®Šå±æ€§**: ä»${finalLocationCount}ä¸ªåœ°ç‚¹ä¸­é€‰æ‹©${finalSecretRealmCount}ä¸ªæ·»åŠ ç‰¹æ®Šå±æ€§

**é‡è¦**: factionsæ•°ç»„å¿…é¡»åŒ…å«${finalFactionCount}ä¸ªå¯¹è±¡ï¼Œlocationsæ•°ç»„å¿…é¡»åŒ…å«${finalLocationCount}ä¸ªå¯¹è±¡ï¼

### ğŸ›ï¸ åŠ¿åŠ›ç”Ÿæˆè¦æ±‚ (${finalFactionCount}ä¸ª)

**åŠ¿åŠ›å®åŠ›åŸåˆ™**:
- èƒ½å¤Ÿè½½å…¥ä¸–ç•Œå²å†Œçš„åŠ¿åŠ›æœ¬èº«å°±åº”è¯¥æœ‰ç›¸å½“å®åŠ›
- ä¸å¼ºåˆ¶å›ºå®šåˆ†çº§æ¯”ä¾‹ï¼Œè®©åŠ¿åŠ›å®åŠ›è‡ªç„¶åˆ†å¸ƒ
- å®åŠ›èŒƒå›´å»ºè®®70-100åˆ†ï¼Œä½“ç°è¿™äº›éƒ½æ˜¯æœ‰å½±å“åŠ›çš„å¤§åŠ¿åŠ›
- å¯ä»¥æœ‰1-2ä¸ªç»é¡¶åŠ¿åŠ›(95-100åˆ†)ï¼Œå…¶ä½™åŠ¿åŠ›å®åŠ›è‡ªç„¶åˆ†å¸ƒ

**åŠ¿åŠ›ç±»å‹å’Œå®åŠ›è¦æ±‚**:
1. **èƒŒæ™¯é€‚é…**: æ‰€æœ‰åŠ¿åŠ›ç±»å‹å¿…é¡»ç¬¦åˆ${worldBackgroundStyle}ï¼Œä½†ä¿æŒä¿®ä»™æœ¬è´¨
2. **é¿å…é‡å¤**: ç»å¯¹ä¸èƒ½ç”Ÿæˆç›¸åŒæˆ–ç›¸ä¼¼çš„åŠ¿åŠ›åç§°
3. **é£æ ¼ç»Ÿä¸€**: é‡‡ç”¨ç¬¦åˆä¸–ç•ŒèƒŒæ™¯çš„å‘½åé£æ ¼
4. **ä¿®ä»™æ ¸å¿ƒ**: æ‰€æœ‰åŠ¿åŠ›éƒ½è¦æœ‰ä¿®ä»™ä½“ç³»ç›¸å…³çš„ä¸“é•¿å’Œç‰¹è‰²
5. **å®åŠ›ä½“ç°**: ä½œä¸ºçŸ¥ååŠ¿åŠ›ï¼Œå®åŠ›åº”è¯¥ä½“ç°å…¶å½±å“åŠ›å’Œåœ°ä½
6. **åŠ¿åŠ›è¾¹ç•Œ**: æ¯ä¸ªåŠ¿åŠ›å¿…é¡»æœ‰territory_boundså®šä¹‰å…¶æ§åˆ¶èŒƒå›´ï¼Œç”Ÿæˆè§„æ•´åˆç†çš„è¾¹ç•Œå½¢çŠ¶ï¼š
   - å¤§åŠ¿åŠ›ï¼š5-7ä¸ªåæ ‡ç‚¹ï¼Œå½¢æˆç›¸å¯¹è§„æ•´çš„å¤šè¾¹å½¢ï¼ˆå¦‚æ¤­åœ†å½¢ã€çŸ©å½¢ã€å…­è¾¹å½¢ç­‰ï¼‰
   - ä¸­ç­‰åŠ¿åŠ›ï¼š4-6ä¸ªåæ ‡ç‚¹ï¼Œå½¢æˆè§„æ•´çš„å››è¾¹å½¢ã€äº”è¾¹å½¢ã€å…­è¾¹å½¢
   - å°åŠ¿åŠ›ï¼š4-5ä¸ªåæ ‡ç‚¹ï¼Œå½¢æˆç®€å•çš„çŸ©å½¢ã€è±å½¢ç­‰è§„æ•´å½¢çŠ¶
   - **é‡è¦**ï¼šé¿å…å¥‡å½¢æ€ªçŠ¶çš„è¾¹ç•Œï¼Œä¼˜å…ˆç”Ÿæˆåœ†å½¢ã€æ¤­åœ†å½¢ã€çŸ©å½¢ã€å…­è¾¹å½¢ç­‰å¸¸è§è§„æ•´å½¢çŠ¶

### ğŸ—ºï¸ åœ°ç‚¹ç”Ÿæˆè¦æ±‚ (${finalLocationCount}ä¸ª)

**åœ°ç‚¹åˆ†å¸ƒ**:
- ğŸ¯ **åŠ¿åŠ›æ€»éƒ¨**: ${headquarters}ä¸ª (å¯¹åº”å„åŠ¿åŠ›)
- ğŸ˜ï¸ **åŸé•‡åŠå¸‚**: ${cities}ä¸ª
- âš¡ **ç‰¹æ®Šåœ°ç‚¹**: ${specialSites}ä¸ª
- âš ï¸ **å±é™©åŒºåŸŸ**: ${dangerZones}ä¸ª
- ğŸŒ„ **è‡ªç„¶æ™¯è§‚**: ${otherSites}ä¸ª

**åœ°ç‚¹ç±»å‹** (å¿…é¡»ä½¿ç”¨ä»¥ä¸‹7ç§æ ‡å‡†ç±»å‹ï¼Œä½†å†…å®¹è¦ç¬¦åˆ${worldBackgroundStyle}):
1. **natural_landmark** - ğŸ”ï¸ è‡ªç„¶åœ°æ ‡ (ç¬¦åˆèƒŒæ™¯çš„è‡ªç„¶æ™¯è§‚)
2. **sect_power** - ğŸ¯ åŠ¿åŠ›æ€»éƒ¨ (å„ä¿®ä»™åŠ¿åŠ›çš„æ€»éƒ¨)
3. **city_town** - ğŸ˜ï¸ åŸé•‡èšå±…åœ° (ç¬¦åˆèƒŒæ™¯é£æ ¼çš„åŸé•‡)  
4. **blessed_land** - â›©ï¸ ä¿®ç‚¼åœ£åœ° (é€‚åˆä¿®ä»™çš„çµæ°”å……æ²›ä¹‹åœ°)
5. **treasure_land** - ğŸ’ èµ„æºå®åœ° (å¤©æåœ°å®ã€çµçŸ³çŸ¿è„‰ç­‰)
6. **dangerous_area** - âš”ï¸ å±é™©åŒºåŸŸ (å‡¶å…½å·¢ç©´ã€é­”åŸŸé™©åœ°ç­‰)
7. **special_other** - ğŸŒŸ ç‰¹æ®Šåœ°ç‚¹ (ä¼ é€é˜µã€ç§˜å¢ƒå…¥å£ç­‰)

### âœ¨ ç‰¹æ®Šå±æ€§å¢å¼º (${finalSecretRealmCount}ä¸ªåœ°ç‚¹)

ä»åŸºç¡€åœ°ç‚¹ä¸­é€‰æ‹©${finalSecretRealmCount}ä¸ªæ·»åŠ ç‰¹æ®Šå±æ€§:
- ğŸ¯ **æœºé‡ä¹‹åœ°**: ${opportunityRealms}ä¸ª
- ğŸ“œ **ä¼ æ‰¿é—è¿¹**: ${heritageRealms}ä¸ª  
- â˜ ï¸ **å±é™©ç¦åœ°**: ${dangerousRealms}ä¸ª

## ğŸ¨ åˆ›æ–°å˜åŒ–è¦æ±‚

**æ¯æ¬¡ç”Ÿæˆå¿…é¡»ä¸åŒ**:
1. **åŠ¿åŠ›ç»„åˆ**: ä¸åŒçš„åŠ¿åŠ›ç±»å‹æ­é…
2. **å‘½åé£æ ¼**: å˜åŒ–å‘½åçš„æ–‡åŒ–èƒŒæ™¯å’Œé£æ ¼ç‰¹è‰²
3. **åœ°ç†å¸ƒå±€**: ä¸åŒçš„åŠ¿åŠ›åˆ†å¸ƒæ¨¡å¼
4. **ä¸“é•¿é‡ç‚¹**: ç›¸åŒç±»å‹åŠ¿åŠ›ä¹Ÿè¦æœ‰ä¸åŒçš„ä¸“é•¿ä¾§é‡
5. **å†²çªå…³ç³»**: å„åŠ¿åŠ›é—´çš„æ©æ€¨æƒ…ä»‡è¦æœ‰å˜åŒ–

## ğŸ“‹ JSONè¾“å‡ºæ ¼å¼ (ä¸¥æ ¼æ•°é‡æ§åˆ¶)

**æ•°é‡æ£€æŸ¥æ¸…å•**:
- âœ… continentsæ•°ç»„åŒ…å«2-8ä¸ªå¤§æ´²å¯¹è±¡
- âœ… factionsæ•°ç»„åŒ…å«${finalFactionCount}ä¸ªåŠ¿åŠ›å¯¹è±¡
- âœ… locationsæ•°ç»„åŒ…å«${finalLocationCount}ä¸ªåœ°ç‚¹å¯¹è±¡
- âœ… å…¶ä¸­${finalSecretRealmCount}ä¸ªåœ°ç‚¹æœ‰special_attributes
- âœ… æ¯ä¸ªåŠ¿åŠ›éƒ½åˆ†é…åˆ°æŸä¸ªå¤§æ´²

**é‡è¦æé†’**: factionsæ•°ç»„å¿…é¡»æ°å¥½åŒ…å«${finalFactionCount}ä¸ªå…ƒç´ ï¼Œlocationsæ•°ç»„å¿…é¡»æ°å¥½åŒ…å«${finalLocationCount}ä¸ªå…ƒç´ ï¼

\`\`\`json
{
  "generation_info": {
    "session_id": "${sessionId}",
    "seed": ${uniqueSeed},
    "world_type": "${worldBackgroundStyle}",
    "generation_notes": "æœ¬æ¬¡ç”Ÿæˆçš„ç‹¬ç‰¹ç‰¹è‰²å’Œåˆ›æ–°ç‚¹"
  },
  "continents": [
    {
      "id": "continent_1",
      "name": "ç¬¦åˆ${worldBackgroundStyle}çš„å¤§æ´²åç§°",
      "description": "å¤§æ´²åœ°ç†ç‰¹å¾å’Œæ–‡åŒ–æè¿°",
      "climate": "æ°”å€™ç±»å‹",
      "terrain_features": ["ä¸»è¦åœ°è²Œç‰¹å¾"],
      "natural_barriers": ["ä¸å…¶ä»–å¤§æ´²çš„å¤©ç„¶å±éšœ"],
      "continent_bounds": [
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0}
      ],
      "dominant_factions": ["åœ¨æ­¤å¤§æ´²çš„ä¸»è¦åŠ¿åŠ›IDåˆ—è¡¨"]
    }
  ],
  "factions": [
    {
      "id": "faction_1",
      "name": "ç¬¦åˆ${worldBackgroundStyle}çš„åŠ¿åŠ›åç§°",
      "type": "åŠ¿åŠ›ç±»å‹",
      "description": "åŠ¿åŠ›èƒŒæ™¯æè¿°ï¼Œä½“ç°ç‹¬ç‰¹æ–‡åŒ–",
      "territory": "æ§åˆ¶çš„åœ°åŸŸèŒƒå›´",
      "strength": 60-100,
      "leader": "é¢†å¯¼è€…ç§°è°“",
      "specialties": ["ç‹¬ç‰¹ä¸“é•¿1", "ç‹¬ç‰¹ä¸“é•¿2"],
      "culture_notes": "è¯¥åŠ¿åŠ›çš„æ–‡åŒ–ç‰¹è‰²",
      "continent_id": "æ‰€å±å¤§æ´²çš„ID",
      "headquarters": {
        "name": "æ€»éƒ¨åç§°",
        "coordinates": {"longitude": 102.0-109.0, "latitude": 27.5-33.0}
      },
      "territory_bounds": [
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
        {"longitude": 102.0-109.0, "latitude": 27.5-33.0}
      ]
    }
  ],
  "locations": [
    {
      "id": "loc_1",
      "name": "ç¬¦åˆ${worldBackgroundStyle}çš„åœ°ç‚¹åç§°",
      "type": "7ç§æ ‡å‡†ç±»å‹ä¹‹ä¸€",
      "coordinates": {"longitude": 102.0-109.0, "latitude": 27.5-33.0},
      "description": "åœ°ç‚¹è¯¦ç»†æè¿°", 
      "danger_level": "å®‰å…¨/æ™®é€š/å±é™©/æå±é™©",
      "suitable_for": ["é€‚åˆç¾¤ä½“"],
      "controlled_by": "æ§åˆ¶åŠ¿åŠ›(å¯é€‰)",
      "special_features": ["åœ°ç‚¹ç‰¹è‰²"],
      "special_attributes": ["ç‰¹æ®Šå±æ€§(å¯é€‰)"]
    }
  ]
}
\`\`\`

## âš ï¸ æœ€ç»ˆæ£€æŸ¥è¦æ±‚
- âœ… æ‰€æœ‰åç§°å®Œå…¨ç¬¦åˆ${worldBackgroundStyle}é£æ ¼
- âœ… é¿å…é‡å¤æˆ–ç›¸ä¼¼çš„åŠ¿åŠ›/åœ°ç‚¹åç§°
- âœ… ä¿æŒä¿®ä»™ä½“ç³»æ ¸å¿ƒï¼Œå¼ºè€…ä¸ºå°Š
- âœ… åŠ¿åŠ›ç±»å‹å’Œä¸“é•¿ç¬¦åˆä¿®ä»™èƒŒæ™¯
- âœ… JSONæ ¼å¼å®Œæ•´ï¼Œåæ ‡åœ¨æŒ‡å®šèŒƒå›´å†… (ç»åº¦102.0-109.0ï¼Œçº¬åº¦27.5-33.0)

**æ ¸å¿ƒç›®æ ‡**: åˆ›é€ ä¸€ä¸ªç‹¬ä¸€æ— äºŒã€ç¬¦åˆ${worldBackgroundStyle}ã€ä¿æŒä¿®ä»™æœ¬è´¨çš„ä¸–ç•Œï¼
`;
  }
}