本文档旨在记录“朝天大陆”AI双向交互框架的开发进度、核心技术栈，并为未来的开发指明方向。
claude --dangerously-skip-permissions
---

## 一、 技术栈与核心工具 (Tech Stack & Core Tools)

此方世界的构建，依托于以下几项核心神通法宝：

- **前端框架 (Frontend Framework):** `Vue 3`
  - **核心心法:** 全面采用组合式API (`Composition API`) 与 `<script setup lang="ts">` 语法，确保代码的响应性与可维护性。
- **后端框架 (Backend Framework):** `FastAPI`
  - **核心优势:** 基于Python的现代、高性能Web框架，用于构建我们的云端天宫。
- **数据库 (Database):** `MySQL`
  - **核心作用:** 作为数据灵脉的根基，持久化存储所有用户、世界及角色数据。
- **核心开发语言 (Languages):** `TypeScript` (前端), `Python` (后端)
- **地图系统 (Map System):** `Leaflet.js` & `leaflet-draw`
  - **未来核心:** 即将用于构建“坤舆图志”交互式地图系统的核心法宝。
- **状态管理 (State Management):** `Pinia` (规划中) / 自定义 `Composables`
  - **当前实现:** 通过自定义的Vue Composables (`useAuth`, `useWorlds` 等) 进行模块化状态管理。
- **样式方案 (Styling):** 原子化CSS (`UnoCSS`/`Tailwind CSS` 理念) + `:root` 设计灵脉
  - **设计哲学:** 遵循“万法自然”的原则，通过CSS变量和功能类构建统一、可复用的视觉体系。

---

## 二、 第一阶段：重铸乾坤（已完成）

此阶段我们完成了从一个简单前端页面到云端一体化应用框架的蜕变。

1.  **后端天宫已立**: 我们从零开始，使用 `FastAPI` 和 `MySQL` 构建了一个强大的云端后台。
    - **数据库**: 设计并实现了用户 (`users`)、世界 (`worlds`)、角色/存档 (`characters`) 的数据库表，结构清晰，可扩展性强。
    - **核心API**: 架设了用户注册 (`/register`)、世界列表 (`/worlds`)、云端存档 (`/characters`) 等关键API，并经过了完整测试。
    - **默认世界**: 实现了服务器启动时自动创建“朝天大陆”的默认世界，为所有玩家提供了一个共同的起点。

2.  **前端灵脉已通**: 前端 `Vue` 应用已完成接入后端的核心改造。
    - **双模架构**: “单机闭关”与“联机共修”模式已彻底分离，互不干扰。
    - **用户系统**: 创建了 `LoginView.vue` 登录/注册视图，以及 `useAuth.ts` 来管理用户状态，实现了完整的用户认证流程。
    - **世界之门**: 创建了 `WorldSelector.vue` 视图，用于在登录后展示和选择不同的修仙世界。
    - **状态路由**: 重构了主组件 `App.vue`，使其成为一个状态驱动的“乾坤镜”，能根据 **模式选择 -> 登录状态 -> 世界选择** 自动切换到正确的功能视图。

---

## 三、 第二阶段：开辟坤舆（未来规划）

下一阶段，我们的核心目标是将修仙世界“可视化”，从抽象的数据变为一个可供探索的、生动的地图。我们将以 **“坤舆图志 (Leaflet.js)”** 为核心法宝，展开以下工作：

1.  **命盘与世界的绑定**:
    - **目标**: 当用户在 `WorldSelector` 中选择一个世界后，我们需要处理“角色”的逻辑。是为这个世界**创建新角色**，还是加载已存在于该世界的**旧角色**？这将是我们需要实现的下一个选择界面。

2.  **坤舆图景 (Map View)**:
    - **目标**: 这是未来在线模式的核心。当角色确定后，将进入一个基于 `Leaflet` 的全屏交互式地图。
    - **实现**:
      - 创建 `MapView.vue` 作为主视图。
      - 使用 `Leaflet` 加载一个基础的世界地图瓦片（可以是美术创作的古风地图，或程序生成的风格化地图）。
      - 将从后端获取的地点、秘境、城镇等数据，以**标记 (Markers)** 的形式渲染在地图上。

3.  **神识交互 (Map Interaction)**:
    - **目标**: 地图不仅是看的，更是用来“神识探索”的。
    - **实现**:
      - **点击交互**: 点击地图上的标记（如一个门派、一座古城），可以弹出信息窗口，显示详细描述，并提供“进入”、“传送”等操作。
      - **区域绘制**: 使用 `leaflet-draw` 插件，未来可以允许玩家（或GM）在地图上绘制自己的势力范围、标记洞府位置、规划探索路线等。
      - **事件触发**: 角色在地图上移动，可以触发区域性事件，遭遇奇遇或敌人。

作者口语化表达的想法：

# 联机机制
- 写几套难的文风，设定，最高权限
- 联机模式可以穿梭世界，但是要不要限制境界什么的呢（进入别人世界自动切换超难文风），怎么筛选呢，需要点代价
- 被别人打死会怎么样，会不会掉装备，掉境界
- 可以弄个系统报仇
- 联网事件系统，下线留言AI代理
- 共享大世界，大世界服务器
- 每次对话更新将关键信息提交服务器，然后位置和计算好的神识范围也上交，通过服务器判定是否碰到人，如果碰到看看是不是立即更新返回地图更新人物红点或
者是看看要不要经过AI或者下次对话出现
- 如果同步将使用云端API进行审核申请然后同步

- 物品分为品质神(稀有度:举世无有)、仙(顶级圣地至宝、隐世宗门)、天(顶级圣地、超级势力、超级组织、超级世家、隐式宗门)、地、玄、黄、凡，每个品级分为0-10级，其中0为残缺，1-3为下品，4-6为中品，7-9为上品，10为极品，这两个属性作为背包武器服饰，法宝，功法、丹药、符箓、阵法等的重要属性，再加上词条系统，除了物品栏还有财务栏、杂物栏，杂物蓝可以装一些特殊的没有等级的物品
- 地图（超清超全）
- 世界书装世界背景，文字风格，长期记忆
- 变量管理装中期记忆，还有角色属性等等。联机模式要不要做加密放更改机制呢

设想请求内容：
{
  记忆信息（短期、中期、长期，所有NPC互动记忆）
  //世界书内容自动发送（世界背景文风）
  人物境界属性数值，
  弄一套计算基础属性的公式，然后弄出几个方面的数值，然后弄一个随机数偏差随机微调，发送并带上气运，特殊词条体质和天赋灵根发给AI，弄一套合理的判定提示词，让AI决定，甚至有的不是生死战能被美貌诱惑从而胜利
  合理性审查提示词（最高权限）：三种难度随意切换(普通、中等、困难)，困难后面出的联机模式如果进入别人的地图直接强制困难，并且合理性审查为最高权限，需要用合理方式多次插入提醒AI，防止用户对AI使用不合理的提示词导致不公平、不真实，
  位置信息，
  AI需要关注的信息:位置偏移，地图更新，背包更新，属性更新，机制判定，人物好感，宗门变化，周围环境，
  AI更新各种东西的格式，地图物品，人物...
}



设想AI返回内容：
{
  "text":"",//正文内容，用于短期记忆
  "text_min":"",//缩减内容，用于中期记忆，需要一个能表述关键时间地点人物事件情感等方面的格式
  "around":"周围大致人物、环境、一些声音、对角色的想法，对其他的想法"
  "update":{
    增、删、改
    游戏属性
    NPC互动记录
    地图
  }  
}

此番规划，将彻底改变应用的交互模式，从传统的文字MUD，进化为一个拥有“真实”地理概念的、可供道友们“神游太虚”的沙盘世界。