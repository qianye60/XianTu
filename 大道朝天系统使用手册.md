# 大道朝天修仙游戏系统使用手册

## 📖 项目概述

大道朝天是一个基于Vue 3 + FastAPI的修仙主题游戏管理系统，包含玩家角色创建系统和完整的后台管理功能。

## 🏗️ 系统架构

### 前端技术栈
- **Vue 3** - 现代化的前端框架
- **TypeScript** - 类型安全的JavaScript
- **Vite** - 快速的构建工具
- **Pinia** - 状态管理

### 后端技术栈
- **FastAPI** - 高性能的Python Web框架
- **Tortoise ORM** - 异步数据库ORM
- **MySQL** - 关系型数据库
- **JWT** - 身份验证

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Node.js 16+
- MySQL 8.0+

### 后端启动

1. **安装依赖**
```bash
cd server
pip install -r requirements.txt
```

2. **配置数据库**
编辑 `server/core/config.py` 中的数据库连接配置：
```python
DATABASE_URL = "mysql://用户名:密码@localhost:3306/数据库名"
```

3. **初始化数据库**
```bash
cd server
aerich init -t server.main.TORTOISE_ORM
aerich init-db
```

4. **启动服务器**
```bash
python -m uvicorn server.main:app --host 127.0.0.1 --port 12345 --reload
```

### 前端启动

1. **安装依赖**
```bash
npm install
```

2. **启动开发服务器**
```bash
npm run dev
```

3. **访问应用**
- 前端应用：http://localhost:5173
- 后端管理：http://127.0.0.1:12345/admin
- API文档：http://127.0.0.1:12345/docs

## 🎮 玩家系统使用指南

### 角色创建流程

#### 第一步：世界选择
- 选择修仙世界背景
- 每个世界有不同的时代设定和规则

#### 第二步：天资选择
- **废柴** (60点) - 白色 - 最容易获得
- **普通** (70点) - 绿色 - 常见
- **优秀** (80点) - 蓝色 - 较为稀有
- **天才** (90点) - 紫色 - 稀有
- **妖孽** (100点) - 橙色 - 极为稀有
- **逆天** (120点) - 红色 - 传说级稀有

#### 第三步：出身选择
- 不同出身提供属性加成
- 部分出身需要消耗天赋点数
- 影响角色的初始背景故事

#### 第四步：灵根选择
- 决定修炼速度的基础倍率
- 高品质灵根需要更多天赋点数
- 影响角色的修炼效率

#### 第五步：天赋选择
- 使用天赋点数购买特殊能力
- 天赋点数由天资等级决定
- 需要合理分配点数

#### 第六步：属性分配
先天六司：
- **根骨** - 决定气血、体质和寿命
- **灵性** - 决定灵气上限和吸收效率
- **悟性** - 决定神识和学习能力
- **福缘** - 决定奇遇概率和物品品质
- **魅力** - 决定社交能力和好感度
- **心性** - 决定道心坚韧和意志力

### 兑换码使用

1. **获取兑换码**
   - 通过活动获得
   - 管理员生成的天机符箓

2. **使用方式**
   - 在角色创建界面输入兑换码
   - 可获得特殊世界、天资、出身、灵根或天赋

3. **兑换码类型**
   - `world` - 世界通行证
   - `talent_tier` - 天资卷轴
   - `origin` - 出身令牌
   - `spirit_root` - 灵根玉简
   - `talent` - 天赋秘籍

## 🛠️ 管理员系统使用指南

### 登录管理后台

1. **访问地址**
   ```
   http://127.0.0.1:12345/admin
   ```

2. **默认管理员账号**
   - 道号：`admin`
   - 凭证：`admin`
   - **⚠️ 首次登录后请立即修改密码！**

### 功能模块详解

#### 🧑‍💼 玩家管理
- **查看所有玩家**：显示用户名、创建时间、封禁状态、角色数量
- **编辑玩家信息**：修改用户名、密码、封禁状态（超级管理员权限）
- **封禁/解封玩家**：支持临时封禁和永久封禁
- **删除玩家账号**：彻底删除玩家数据（超级管理员权限）

#### 🎭 角色管理
- **查看所有角色**：显示角色名、所属玩家、世界、状态等
- **角色详情查看**：包含基础信息、六司属性、游戏状态
- **删除/恢复角色**：软删除机制，可恢复误删角色

#### 🚫 封号管理
- **查看封号记录**：所有封禁历史和状态
- **执行封号操作**：
  - 临时封号：设置结束时间
  - 永久封号：无结束时间
  - 详细原因记录
- **解除封号**：提前解除封禁

#### 📝 申诉管理
- **处理封号申诉**：玩家可申诉不公正的封号
- **审核申诉**：管理员可批准或拒绝申诉
- **申诉记录**：完整的申诉处理历史

#### 👨‍💼 仙官管理（超级管理员专用）
- **添加新管理员**：创建普通管理员或超级管理员
- **编辑管理员信息**：修改道号、密码、权限等级
- **删除管理员**：移除管理员权限

#### 🌍 世界管理（超级管理员专用）
- **创建新世界**：设置世界名称、时代背景、描述
- **编辑世界信息**：修改世界设定
- **删除世界**：移除世界（需确保无角色使用）

#### 👑 出身管理（超级管理员专用）
- **添加新出身**：设置名称、稀有度、属性加成、天赋点消耗
- **编辑出身**：修改出身属性和效果
- **删除出身**：移除不需要的出身

#### 💎 天赋管理（超级管理员专用）
- **添加新天赋**：设置名称、稀有度、效果、消耗点数
- **编辑天赋**：修改天赋属性和效果
- **删除天赋**：移除天赋

#### ⭐ 天资管理（超级管理员专用）
- **添加新天资等级**：设置名称、总点数、稀有度、颜色
- **编辑天资**：修改天资属性
- **删除天资**：移除天资等级

#### 🌟 灵根管理（超级管理员专用）
- **添加新灵根**：设置名称、基础倍率、天赋点消耗
- **编辑灵根**：修改灵根属性
- **删除灵根**：移除灵根类型

#### 🎫 兑换码管理
- **生成天机符箓**：创建各类型兑换码
  - 设置类型（世界、天资、出身、灵根、天赋）
  - 设置使用次数限制
  - 自动生成唯一兑换码
- **管理现有兑换码**：查看使用情况、编辑、删除

### 权限系统

#### 超级管理员（super_admin）
- 拥有所有管理权限
- 可以管理其他管理员
- 可以创建和修改游戏内容（世界、出身、天赋等）
- 可以生成兑换码

#### 普通管理员（admin）
- 可以管理玩家（查看、封禁）
- 可以管理角色（查看、删除）
- 可以处理申诉
- 可以生成兑换码
- 无法管理其他管理员
- 无法修改游戏基础内容

## 🔧 故障排除

### 常见问题

#### 1. 数据库连接失败
- 检查MySQL服务是否启动
- 验证数据库连接配置
- 确认数据库用户权限

#### 2. 后端无法启动
```bash
# 检查依赖是否完整安装
pip install -r requirements.txt

# 检查端口是否被占用
netstat -an | findstr :12345
```

#### 3. 前端无法访问后端
- 检查CORS配置
- 验证API基础URL设置
- 确认后端服务正常运行

#### 4. 角色创建失败（HTTP 422）
- 检查天赋点数分配是否超出限制
- 验证选择的出身、灵根、天赋是否存在
- 确认先天六司属性分配合理

#### 5. 管理后台加载失败
- 清除浏览器缓存
- 检查网络连接
- 验证管理员令牌有效性

### 调试方法

#### 后端调试
```bash
# 查看详细日志
python -m uvicorn server.main:app --host 127.0.0.1 --port 12345 --log-level debug

# 检查数据库状态
aerich heads
```

#### 前端调试
- 打开浏览器开发者工具
- 检查控制台错误信息
- 查看网络请求状态

## 📚 API文档

### 自动生成的API文档
访问 `http://127.0.0.1:12345/docs` 可查看完整的API文档，包括：
- 所有端点说明
- 请求/响应格式
- 参数说明
- 在线测试功能

### 主要API端点

#### 认证相关
- `POST /api/v1/token` - 玩家登录
- `POST /api/v1/admin/token` - 管理员登录
- `POST /api/v1/register` - 玩家注册

#### 角色系统
- `GET /api/v1/characters/creation_data` - 获取创建数据
- `POST /api/v1/characters/create` - 创建角色
- `GET /api/v1/characters/my` - 获取我的角色
- `GET /api/v1/characters/all` - 获取所有角色（管理员）

#### 管理功能
- `GET /api/v1/users/` - 获取所有用户（管理员）
- `PUT /api/v1/users/{user_id}` - 更新用户信息（超级管理员）
- `POST /api/v1/ban/ban_player` - 封禁玩家
- `GET /api/v1/ban/ban_records` - 获取封号记录

## 🔐 安全建议

### 生产环境配置

1. **修改默认密码**
   - 立即更改默认管理员密码
   - 使用强密码策略

2. **数据库安全**
   - 创建专用数据库用户
   - 限制数据库访问权限
   - 定期备份数据

3. **网络安全**
   - 配置防火墙规则
   - 使用HTTPS协议
   - 限制管理后台访问IP

4. **定期维护**
   - 更新依赖包版本
   - 监控系统日志
   - 清理临时文件

## 📈 性能优化

### 数据库优化
- 定期清理过期数据
- 优化查询索引
- 监控慢查询

### 应用优化
- 启用Redis缓存
- 配置CDN加速
- 使用负载均衡

## 🤝 贡献指南

### 开发环境设置
1. Fork项目仓库
2. 创建功能分支
3. 提交代码变更
4. 创建Pull Request

### 代码规范
- 遵循PEP 8（Python）
- 使用ESLint（JavaScript/TypeScript）
- 编写单元测试
- 添加代码注释

## 📞 技术支持

如遇到技术问题，请：
1. 查阅本使用手册
2. 检查GitHub Issues
3. 联系项目维护者

---

**祝您在大道朝天的修仙之旅中一帆风顺！** 🌟