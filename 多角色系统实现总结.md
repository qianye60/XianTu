# 大道朝天 - 多角色游戏状态管理与封号系统

## 🎯 项目概述

成功实现了完整的多角色游戏状态管理系统，支持一个账号创建多个角色，以及完善的封号管理功能。

## 🚀 核心功能

### 1. 多角色管理系统
- ✅ 每个账号最多可创建5个角色
- ✅ 支持角色激活/切换（同时只能激活一个）
- ✅ 角色软删除机制
- ✅ 游戏时长统计
- ✅ 最后游戏时间记录

### 2. 游戏状态云同步
- ✅ 实时游戏状态存储（修炼进度、物品、位置等）
- ✅ 版本控制和冲突检测
- ✅ 手动/自动同步机制
- ✅ 批量同步支持
- ✅ 同步状态监控

### 3. 封号管理系统
- ✅ 临时封号/永久封号
- ✅ 封号后所有角色失效
- ✅ 申诉系统
- ✅ 管理员审核功能
- ✅ 自动解封到期账号

### 4. 管理员后台
- ✅ 角色管理：查看所有角色详情、删除/恢复
- ✅ 封号管理：批量封禁、查看封号记录
- ✅ 申诉处理：批准/拒绝玩家申诉
- ✅ 实时数据监控

## 📊 数据库架构

### 新增模型

#### CharacterBase (扩展)
```python
- is_active: 是否为激活角色
- is_deleted: 软删除标记
- last_played: 最后游戏时间
- play_time_minutes: 总游戏时长
- is_accessible: 计算属性（账号未封且角色未删除）
```

#### CharacterGameState (新增)
```python
- 修炼状态：当前境界、进度、经验
- 位置信息：当前位置、场景
- 资源状态：灵石、生命值、灵力
- 物品背包：装备、道具
- 技能功法：已学技能、修炼方法
- 社交关系：人物关系、门派声望
- 任务成就：进行中任务、已完成任务
- 同步控制：版本号、脏数据标记
```

#### PlayerBanRecord (新增)
```python
- 封号信息：类型、原因、时间范围
- 申诉系统：申诉理由、状态、处理人
- 管理功能：创建者、生效状态
```

## 🔗 API接口

### 角色管理 (`/api/v1/characters/`)
- `GET /my` - 获取我的角色列表
- `POST /create` - 创建新角色
- `POST /{id}/activate` - 激活角色
- `DELETE /{id}` - 删除角色
- `GET /{id}` - 获取角色详情
- `GET /{id}/game_state` - 获取游戏状态
- `PUT /{id}/game_state` - 更新游戏状态

### 游戏同步 (`/api/v1/characters/`)
- `POST /{id}/sync` - 手动同步
- `POST /{id}/auto_save` - 自动保存
- `GET /{id}/sync_status` - 同步状态
- `POST /batch_sync` - 批量同步

### 封号管理 (`/api/v1/ban/`)
- `POST /ban_player` - 封禁玩家
- `POST /unban_player/{id}` - 解封玩家
- `GET /ban_records` - 封号记录
- `POST /appeal` - 提交申诉
- `POST /handle_appeal/{id}` - 处理申诉
- `GET /check_ban_status` - 检查封号状态

### 管理员专用 (`/api/v1/characters/`)
- `GET /all` - 获取所有角色（管理员）

## 🎨 前端界面

### 角色管理界面
- **CharacterManagement.vue**: 角色列表、状态监控
- **CharacterDetailsModal.vue**: 详细信息、游戏状态
- **CharacterCreationModal.vue**: 分步骤创建流程

### 管理员后台
- **完整的Web管理界面**: `/static/admin/index.html`
- **新增标签页**: 角色管理、封号管理、申诉管理
- **实时数据**: 自动刷新、状态监控

## 🛡️ 安全机制

### 权限控制
- 玩家只能管理自己的角色
- 封号后无法访问任何角色
- 管理员分级权限（普通/超级）

### 数据保护
- 软删除防止数据丢失
- 版本控制防止冲突
- 事务性操作保证一致性

### 封号系统
- 临时/永久封号支持
- 申诉流程完整
- 自动过期处理

## 🔄 使用流程

### 玩家流程
1. **登录** → 查看角色列表
2. **创建角色** → 5步引导流程
3. **激活角色** → 开始游戏
4. **游戏进行** → 自动同步状态
5. **角色切换** → 保存当前，激活新角色

### 管理员流程
1. **登录后台** → 访问管理面板
2. **监控角色** → 查看所有角色状态
3. **处理违规** → 封禁玩家账号
4. **申诉审核** → 批准/拒绝申诉

## 📈 系统特点

### 高可用性
- 实时数据同步
- 故障恢复机制
- 版本控制系统

### 用户体验
- 多角色支持不同玩法
- 无缝切换角色
- 云端数据保护

### 管理便利
- 完整的Web后台
- 批量操作支持
- 实时监控面板

## 🎯 技术实现

### 后端技术栈
- **FastAPI**: 高性能API框架
- **Tortoise ORM**: 异步数据库操作
- **JWT**: 身份认证
- **Pydantic**: 数据验证

### 前端技术栈
- **Vue 3**: 响应式框架
- **TypeScript**: 类型安全
- **Composition API**: 组合式API

### 数据库
- **SQLite**: 开发环境
- **关系型设计**: 支持复杂查询
- **索引优化**: 提升查询性能

## 🚦 部署状态

✅ 数据库迁移已完成
✅ 后端服务正常运行
✅ 前端组件已就绪
✅ 管理后台功能完整

项目现已完全支持多角色游戏体验和完善的管理功能！