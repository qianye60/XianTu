# 更新日志

## V3.2 正式版 (2025-11-11)

### 🚀 重大更新

- **重构全新地图系统**：朝天大陆游戏地图正式上线！
  - 新增 [`GameMapPanel.vue`](src/components/dashboard/GameMapPanel.vue) 游戏地图面板组件（914行新代码）
  - 新增 [`gameMapManager.ts`](src/utils/gameMapManager.ts) 地图管理器（1057行）
  - 新增 [`coordinateConverter.ts`](src/utils/coordinateConverter.ts) 坐标转换工具
  - 新增 [`gameMap.ts`](src/types/gameMap.ts) 地图类型定义
  - 支持地图缩放、拖拽、地点交互等功能
  - 精美的SVG图标（洞府/宗门/城镇/秘境）
  - 完整的地点信息展示和交互系统

### 🎯 系统优化

- **角色创建流程优化**

  - 优化世界选择界面（Step1）
  - 改进天赋档次选择逻辑（Step2）
  - 重构出生地选择界面（Step3，+167行）
  - 优化灵根选择流程（Step4，+55行）
  - 改进天赋选择界面（Step5，+58行）
- **提示词系统强化**

  - **任务系统开关控制**：新增 [`questSystemRules.ts`](src/utils/prompts/definitions/questSystemRules.ts)（92行）
  - **行动选项规范**：优化行动选项生成逻辑和数量控制
  - **CoT思维链**：改进核心思维链提示词（+41行修改）
  - **业务规则**：完善业务规则定义（+19行修改）
  - **角色初始化**：优化角色初始化提示词（+45行修改）
  - **世界生成**：重构世界生成提示词（+197行修改）
- **灵石系统修复**

  - 移除不合理的验证限制
  - 新增执行保护，防止灵石变成负数
  - 优化装备加成应用逻辑（+29行修改）
- **数据验证增强**

  - 改进指令验证器逻辑
  - 优化命令格式检查

### ✨ 功能增强

- **预设系统**：新增"【大道朝天】专用预设.json"（1072行）
- **路由优化**：改进路由配置
- **地点类型扩展**：完善地点类型定义（+42行）

### 🐛 Bug修复

- 修复灵石可能变成负数的问题
- 修复AI可能忽略行动选项数量要求的问题
- 修复任务系统关闭时仍可能生成任务的问题
- 修复角色创建流程中的多个bug
- 修复装备加成计算错误

### 📦 依赖更新

- 更新 package.json 和 package-lock.json
- 优化项目依赖配置

### 📝 文档完善

- 新增"地图系统重构计划.md"（679行）
- 更新游戏介绍页面

---

## V3.1.5 正式版 (2025-11-11)

### 🎯 核心优化

- **提示词系统重构**：大幅精简CoT思维链结构，优化业务规则和数据定义
- **游戏变量面板增强**：改进数据编辑和显示逻辑
- **物品系统优化**：完善物品栏交互和数据处理
- **主游戏面板改进**：优化游戏流程和用户体验

### 🐛 Bug修复

- 修复游戏变量面板数据同步问题
- 修复物品栏显示和操作相关bug
- 修复提示词结构导致的AI响应异常
- 修复数据定义和格式化相关问题
- 清理冗余预设文件

### 📝 文档更新

- 更新CHANGELOG记录所有版本变更

---

## V3.1 正式版 (2025-11-09)

### 🚀 核心更新

- **判定系统重构**：移除骰点，完全基于属性、境界和加成
- **记忆系统优化**：改进记忆总结流程和存储机制
- **预设系统增强**：优化预设保存和加载机制
- **思维链优化**：精简CoT提示词结构，提升AI响应效率
- **文本格式精简**：优化文本格式定义，提升渲染性能

### 🐛 Bug修复

- 修复判定逻辑错误
- 修复文本解析和渲染问题
- 修复预设加载失败问题
- 修复记忆总结数据污染

---

## V3.0.8 正式版 (2025-11-09)

- 精简CoT提示词结构，减少代码冗余
- 优化文本格式定义和FormattedText组件
- 修复文本解析和判定卡片显示问题

---

## V3.0 正式版 (2025-11-08)

### 🚀 核心更新

- **思维链系统**：引入CoT v3.0，简化思维链流程
- **判定系统**：完全基于属性、境界和加成，移除随机性
- **提示词优化**：新增600+行业务规则(境界压制/NPC人格/宏大概念约束/修炼细节等)
- **AI系统增强**：容错解析、流式传输、指令验证、记忆总结Raw模式

### ✨ 功能增强

- 关系网络面板重构，支持NPC记忆总结和关系可视化
- 记忆中心优化，支持导出小说格式
- 存档系统改进，增强验证和修复机制
- 游戏变量面板支持数据编辑
- FormattedText组件重构，新增判定规则帮助

### 🐛 Bug修复

- 修复指令执行导致的存档损坏
- 修复NPC数据结构、记忆总结污染、状态效果移除等问题
- 修复技能掌握度、时间推进、装备加成计算错误

---

## V2.8 正式版 (2025-10-29)

### 🚀 核心亮点：开放性与智能化

- **开放性预设导入/导出**：游戏从业界领先的单机体验，正式升级为**开放式社区创作平台**。玩家现在可以自由地分享、导入和导出包含世界观、文风、规则的完整游戏预设，开启无限可能的社区创作时代！
- **思维链内核 (CoT) 驱动**：重构了底层的提示词引擎，引入**思维链（Chain of Thought）**机制。AI的决策逻辑不再是简单的指令响应，而是模拟“思考”过程，使其行为更合理、更智能、更符合逻辑。
- **【大道朝天 3.0】预设实装**：游戏内容内核迎来“大版本”迭代，实装全新的 3.0 预设，带来更丰富的世界观、更完善的规则和更具沉浸感的叙事风格。

### ✨ 功能与体验增强

- **真·流式响应**：重构AI响应机制，实现真正的逐字流式输出，剧情生成如丝般顺滑，告别长时间等待。
- **指令安全验证系统**：引入强大的指令验证与修复模块，AI生成的所有指令在执行前都会经过严格校验，极大地提升了游戏稳定性，杜绝了因AI指令错误导致的存档损坏问题。
- **核心RPG系统增强**：
  - **记忆中心**：功能全面升级，玩家可更精细地管理角色记忆。
  - **关系网络**：功能增强，更直观地展示NPC间的复杂关系。
  - **判定系统优化**：判定更加规范和强大，完全基于角色实力。
- **行动队列优化**：优化了玩家连续指令的处理逻辑，响应更高效、更稳定。
- **任务系统**：增加任务删除按钮，管理更便捷。
- **开局流程**：删除了开局时无效的自定义选项，流程更顺畅。

### 🧹 项目维护

- **文档清理**：移除了过时的架构计划文档，标志着项目重构工作的圆满完成。

---

## V2.6.8 正式版 (2025-10-26)

- 修复开局出生种族选择
- 修复开局某些中转API生成失败
- 修复随机灵根、随机出生不被替换
- 修复状态效果不被移除
- 修复身体部位开发不显示描述
- 修复功法技能不解锁
- 修复NPC 私密资料几个显示错误
- 修复记忆转化问题
- 修复存档无法新建
- 增加记忆中心导出为小说模式
- 增加存档数据可以任意修改变量
- 优化任务系统，尊重用户选择，不强制做任务
- 优化提示词
- ...

---

## V2.6 正式版 (2025-10-26)

- 修复bug，优化游戏体验

---

## V2.5 正式版 (2025-10-24)

- 重构代码逻辑，抛弃酒馆变量
- 预设加载
- 任务系统
- 开局选项扩展
- 玩家NSFW信息

---

## V2.0 Beta (2025-10-15)

- 修复物品丢弃失败等bug...
- 优化提示词结构、强化JSON结构生成
- 其他...

---

## V1.9 Beta (2025-10-13)

- 修复已知bug
- 优化提示词结构、强化JSON结构生成
- 其他...

---

## V1.8 Beta (2025-10-10)

- 修复bug
- 优化提示词结构
- 增加适配预设

---

## V1.6 Beta (2025-10-09)

- 修复所有已知bug
- 增加角色管理页面导入存档

---

## V1.5 Beta (2025-10-08)

- 修复已知所有bug，增强命令提示词
- 增加重Roll、人物18+模块
- 将本地localstore存储改为浏览器IndexedDB，加快速度，存储空间

---

## V1.0 Beta (2025-10-04)

- 完整的角色创建系统
- 智能判定系统（含境界、装备、大道、功法加成）
- 自动存档+上次对话备份
- 三千大道系统
- 动态剧情生成
- 格式化文本渲染（环境、心理、对话、判定卡片）

---

## V0.1 Alpha (2025-09-18)

- 完善基础框架
- 初始化选择界面
- 各种数据类型格式
- UI设计
- 游戏主体搭建
