from typing import List, Dict, Any
from server.models import World, AdminAccount

# 从seed.py整合过来的完整世界数据
DEFAULT_WORLDS: List[Dict[str, Any]] = [
    {
        "name": '朝天大陆',
        "description": """
        # 朝天大陆世界书：修仙世界观设定
            ## 【壹】世界总纲

            ### 天道秩序
            - **朝天大陆**：此方世界名为"朝天大陆"，乃是一处天道完整、灵气充沛的上善之地
            - **核心法则**："万灵竞渡，一步登天"——无论是人、妖、精、怪，皆有缘法踏上修行之路，叩问长生
            - **天道权威**：天道至公至正，不偏不倚。天才所引天劫愈烈，平庸之辈反而劫数较轻。修士突破大境界必渡天劫，境界越高劫雷越凶险，稍有不慎便是身死道消

            ### 仙凡之别
            - **生命层次**：凡人寿不过百载，受生老病死之苦；修士一旦踏入道途，便能吞吐天地灵气，淬炼己身，寿元动辄千载，更有大能者与天地同寿
            - **时间感知**：凡俗王朝更迭，于修士而言不过弹指一瞬。一次闭关，便可能见证数个皇朝兴衰
            - **力量差距**：在凡人眼中，修士是高悬于九天的仙神，一言可定一国兴衰，一念可引风雷雷霆
            - **天道制衡**：修士若无故以大法力干涉凡俗王朝更迭、屠戮凡人，便会与此方天地结下因果，在日后渡劫时引来更强大的天劫

            ### 大道争锋
            - **修行本质**：此界奉行"大道争锋"的铁则，天道予万物机缘，却也降下无尽凶险
            - **争夺根源**：灵脉宝地、神功秘法、天材地宝，皆是有缘者居之，而"缘"字背后，往往是血与火的洗礼
            - **修士常态**：修士之间为求道途精进，争斗乃是常态。同门可能反目，挚友亦会背叛，杀人夺宝、斩草除根之事屡见不鲜
            - **自由代价**：这是一个极度自由的世界，你可以选择成为守护一方的善仙，亦可成为肆虐八荒的魔头，但自由的背后是无处不在的危险，一步踏错，便是万劫不复，身死道消

            ### 天劫种类
            - **三九小天劫**：共二十七道劫雷，针对道基平庸，侥幸抵达渡劫期的修士
            - **六九中天劫**：共五十四道劫雷，附带风火大劫，针对道基扎实，天资卓越之辈，如各大宗门的真传弟子
            - **九九重天劫**：共八十一道紫霄神雷，更伴随心魔劫、因果劫，唯有万古不出的天骄，身负大气运者方能引动。渡过者，飞升后亦是仙中强者
            - **混沌天罚**：传说中的劫数，针对修行了禁忌功法、身负滔天业力的修士（如某些魔道巨擘）。此劫非为考验，而是抹杀，几乎无人能渡

            ## 【贰】万族生灵

            ### 人族
            - **修行主流**：朝天大陆的修行主体，天赋多样，从伪灵根到仙灵根资质层次分明
            - **道途广阔**：正道、魔道、佛门、儒道、剑修、体修、艺道修行皆有传承
            - **社会结构**：建立了完善的宗门、家族、王朝体系

            ### 妖族
            - **修行特色**：妖兽开启灵智，修炼成妖，本体形态具有天然优势，与人族同阶战斗往往更强
            - **化形门槛**：多需修至元婴方可化形为人，但保留本体神通
            - **种族天赋**：不同妖族拥有独特的血脉神通，如龙族掌控风雨，凤族掌握涅槃重生
            - **修炼漫长**：修炼过程十分漫长，起点比人类低了很多，但寿命更长

            ### 精怪一族
            - **草木成精**：千年古树、万年灵芝等植物修炼成精
            - **器物成灵**：上古法宝诞生器灵，自主修炼
            - **山石得道**：名山大川的山神、河神等

            ### 鬼修异类
            - **亡魂修炼**：死后不散，以鬼魂之身踏入修行路
            - **幽冥之道**：修炼阴气鬼火，擅长精神攻击
            - **天生劣势**：被天地排斥，修行艰难，但成就者往往诡异强大

            ## 【叁】万道昌荣

            ### 正道修行
            - **理念**：顺天应道，守护苍生，追求与天地和谐
            - **特点**：道基稳固，功法正大光明，但进境相对较慢
            - **宗门形式**：占据名山大川和上等灵脉，等级森严，广收门徒
            - **修士风范**：多有悲天悯人之心，但也有迂腐固执之辈

            ### 魔道修行
            - **理念**：顺心而为，唯我独尊，不尊天地不敬鬼神，道心种魔，掠夺万物以补自身
            - **手段**：吞噬、血祭、炼魂等霸道手段，为求力量不择手段，甚至献祭一城生命
            - **特点**：进境神速，战力诡异强大，但根基不稳，心魔丛生，极易引来混沌天罚
            - **内部争斗**：弱肉强食，同门相残，师徒背叛是家常便饭
            - **正道公敌**：被所有正道修士视为必杀之敌

            ### 佛门之道
            - **理念**：慈悲为舟，普度众生，见众生苦而发菩提心
            - **修行方式**：不结金丹而凝舍利子，不修元婴而证丈六金身
            - **功德体系**：诵经可积累宏愿之力，佛光对魔气、鬼物有天然克制
            - **特色**：善于防御、净化、超度，生存能力极强，且克制诸多邪门歪道

            ### 儒家正道
            - **理念**：立德立言，为天地立心，为生民立命。修身、齐家、治国、平天下
            - **修行方式**：不吐纳灵气，而读圣贤书，养胸中一口"浩然正气"
            - **文宝神通**：以春秋笔、惊堂木、圣人字帖等文宝施展神通，言出法随，口诛笔伐
            - **特色**：浩然正气破邪除秽，大儒一声喝斥可令山河变色，鬼神退避

            ### 剑修之道
            - **理念**：一剑破万法，吾道唯一，吾剑唯一。舍弃万般神通，只求极致的攻击力
            - **修行特色**：不重法力浑厚，而重剑意凝练，以身养剑，以神御剑，最终人剑合一
            - **剑意等级**：剑气、剑丝、剑芒、剑域
            - **特点**：杀伐第一，同阶无敌，一位元婴剑修足以越阶挑战寻常化神道君
            - **风险**：防御薄弱，心性极端，易遭反噬

            ### 体修炼体
            - **理念**：将身体如武器般进行锤炼，不假外物，将肉身炼成人形法宝
            - **修炼特色**：修炼过程十分辛苦，对身体体质要求颇为严格
            - **炼体境界**：铜皮、铁骨、银筋、金血、玉髓等
            - **特点**：个人战斗力强大，无论攻击性还是防御性都很强，但修炼的人很少
            - **成就者**：能进行体修的都是狠人，成就后可肉身撼天地

            ### 艺道修行
            - **琴修**：以音杀人，以乐疗伤，一曲《高山流水》可化解心魔，一曲《十面埋伏》可化作千军万马
            - **棋修**：以天地为棋盘，以众生为棋子，布下棋局可困敌于幻境，逆乱一方时空
            - **书修**：以字为阵，以文为法，书写"镇"字可封印妖魔，挥洒一篇战诗可召唤兵戈
            - **画修**：笔下山水可成一方小世界，画中猛虎可跃出伤人，至高境界可画地为牢，一念成界

            ## 【肆】修仙百艺

            ### 四大主艺
            - **丹道**：炼制丹药，辅助修炼疗伤突破。丹药皆有三分毒性，长期服用会积累丹毒，影响道基
            - **器道**：打造法宝，从法器到通天灵宝。高阶法宝可生器灵，自主修炼
            - **符道**：制符储术，方便施法。一张灵符就是一道法术，为低阶修士常用斗法手段
            - **阵道**：布阵掌控环境，护山困杀。高阶阵法可引动天地之力，甚至整个朝天大陆本身，就是一座无上神阵

            ### 其他技艺
            - **卜算推演**：推算天机，预知祸福，但窥探天机必有代价
            - **炼毒制蛊**：邪门手段，炼制剧毒蛊虫，正道多不齿
            - **御兽驯妖**：与灵兽妖兽沟通，签订契约共同战斗
            - **傀儡机关**：制作机关兽，机关武器，邪恶者会炼制生物傀儡

            ## 【伍】势力格局

            ### 正道宗门
            - **组织形式**：占据名山大川和上等灵脉，等级森严，从外门弟子到内门、真传、长老、太上长老
            - **核心理念**：广收门徒，有事弟子服其劳，传承有序
            - **内部矛盾**：表面和谐，实则暗流涌动，长老之间、峰主之间、弟子之间皆有争夺

            ### 修仙家族
            - **血脉纽带**：以血脉为纽带的势力，底蕴深厚
            - **传承特色**：功法秘术不外传，相比宗门更加团结也更加排外
            - **世代传承**：根深蒂固，往往有数万年传承历史

            ### 魔道势力
            - **隐秘组织**：隐于暗处，被正道视为公敌
            - **残酷手段**：手段残忍，为力量不择手段，内部争斗激烈
            - **弱肉强食**：实力为尊，师父杀徒弟、徒弟弑师父都是常事

            ### 散修联盟
            - **自由修士**：无门无派的修士联合，互通有无，抱团取暖
            - **聚集地**：多聚于仙城坊市，三教九流汇聚
            - **生存艰难**：缺乏资源和传承，大多修为有限

            ### 凡俗王朝
            - **修仙苗圃**：修仙宗门的"苗圃"，提供有灵根弟子和凡俗资源
            - **双重统治**：表面帝王称尊，实则皇权之上更有仙权
            - **朝代更迭**：在修士眼中如过眼云烟，朝代兴衰不过一瞬

            ### 隐世大能
            - **超然存在**：臻至上境，不问世事的合体、渡劫期存在
            - **定海神针**：他们是世界的定海神针，轻易不出，一出则天地变色
            - **因果关联**：每一个大能的存在都稳定着一方天域的法则

            ## 【陆】天道规则与因果

            ### 因果业力
            - **善因**：救人护道，斩妖除魔，功德深厚者天劫较轻
            - **恶因**：滥杀无辜，破坏天理，业力深重者引混沌天罚
            - **因果纠缠**：恩怨情仇会影响突破和渡劫，了结因果是修行必经路

            ### 天人感应
            - **突破异象**：大境界突破引天地异象，修为越高异象越盛
            - **干涉凡俗**：修士若无故干涉凡俗王朝，会结下因果，渡劫时天劫更烈
            - **天道制衡**：屠戮凡人会在日后冲击更高境界、渡劫飞升时，引来更强大的天劫

            ### 誓言与心魔
            - **道心誓言**：以道心起誓，违背必遭反噬
            - **心魔劫**：每个大境界都有心魔考验，执念过重会生心魔
            - **道心坚定**：道心坚定者可逆天改命，道心不稳者易走火入魔

            ## 【柒】世界特色与氛围

            ### 古风韵味
            - **科技水平**：科技文明不发达，崇尚返璞归真，追求与天地合一
            - **建筑风格**：多为古典宫殿、楼阁、洞府，飞檐斗拱，气势恢宏
            - **服饰文化**：修士衣着华美飘逸，法袍云纹广袖，头饰腰饰精美

            ### 沧桑感
            - **时间流逝**：一个修士的闭关可能跨越数个王朝，见证沧海桑田
            - **上古遗迹**：散落各处的上古遗迹，承载着万古沧桑和失落文明
            - **大能心境**：高阶修士心境淡然如古井，世间荣辱不入眼

            ### 宏伟感
            - **个人伟力**：一人一剑可开山断江，法宝神通移山倒海
            - **天地异象**：渡劫时雷云万里，天地变色，山河震动
            - **规模宏大**：动辄千里万里的神识覆盖，跨越数个王朝的宗门领地

            ### 人性复杂
            - **光明面**：有舍身救人的义士，守护一方的善仙，悲天悯人的圣者
            - **黑暗面**：为夺宝兄弟反目，为资源师徒相残，为力量献祭无辜生命
            - **人心险恶**：同门暗算，挚友背叛，表面仁义道德，暗地里争名夺利
            - **道德挣扎**：在力量与道德之间的选择，在生存与良知之间的煎熬

            ### 修心为本
            - **修仙本质**：修仙不仅是修炼力量，更是修炼心性，完善人格
            - **道心重要**：道心坚定者可逆天改命，道心不正者终将自取灭亡
            - **心境变化**：随着修为提升，心境也会发生变化，有人变得超然物外，有人变得冷漠无情

            ### 核心精神
            **仙路浩渺，朝天则至！**

            踏上修仙路就不回头的决心，面对无尽艰险依然勇往直前的道心，追求与天地同寿、与日月同辉的宏伟理想。这就是朝天大陆修士的精神内核，也是这个世界最动人的魅力所在。
""",
        "era": '朝天历元年'
    }
]

async def seed():
    """
    使用 Tortoise-ORM 将预设的世界背景数据填充到数据库中。
    """
    print("--- [Worlds] 开始播种世界数据 (ORM)... ---")
    
    # 确保 admin 用户存在，作为作者（不创建重复用户）
    admin_user = await AdminAccount.get_or_none(user_name="admin")
    if not admin_user:
        # 如果admin不存在，检查是否有super_admin
        admin_user = await AdminAccount.filter(role="super_admin").first()
        if not admin_user:
            # 如果没有任何超级管理员，创建一个
            admin_user = await AdminAccount.create(
                user_name="admin",
                password="hashed_password_placeholder", 
                role="super_admin"
            )

    for world_data in DEFAULT_WORLDS:
        existing_world = await World.get_or_none(name=world_data["name"])
        
        if existing_world:
            # 更新描述
            if existing_world.description != world_data["description"]:
                existing_world.description = world_data["description"]
                existing_world.era = world_data.get("era")
                await existing_world.save()
                print(f"--- [Worlds] 成功更新世界: '{existing_world.name}' ---")
            else:
                print(f"--- [Worlds] 世界 '{existing_world.name}' 已是最新，无需更新。 ---")
        else:
            # 创建世界
            await World.create(
                name=world_data["name"],
                description=world_data["description"],
                era=world_data.get("era"),
                creator=admin_user
            )
            print(f"--- [Worlds] 成功创建世界: '{world_data['name']}' ---")

    print("--- [Worlds] 世界数据播种完毕 (ORM)。 ---")

if __name__ == '__main__':
    import asyncio
    from tortoise import Tortoise
    from server.main import TORTOISE_ORM

    async def run():
        await Tortoise.init(config=TORTOISE_ORM)
        await Tortoise.generate_schemas()
        await seed()
        await Tortoise.close_connections()

    asyncio.run(run())